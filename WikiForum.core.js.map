{"version":3,"sources":["webpack://mediawiki-wikiforum/./module/actionGet.js","webpack://mediawiki-wikiforum/./module/log.js","webpack://mediawiki-wikiforum/./module/mw.js","webpack://mediawiki-wikiforum/./module/parser.js","webpack://mediawiki-wikiforum/./module/renderer.js","webpack://mediawiki-wikiforum/./module/updater.js","webpack://mediawiki-wikiforum/webpack/bootstrap","webpack://mediawiki-wikiforum/./index.js"],"names":["require","api","conf","module","exports","page","wgPageName","$","get","format","action","prop","log","data","console","info","warn","error","err","mw","util","wikiScript","config","editToken","user","tokens","hook","parseForums","code","title","$root","forums","hasClass","find","each","index","forum","push","id","String","meta","threads","parseThreads","prefix","$forum","$threads","getThreads","thread","threadObj","content","getContent","getMeta","length","$thread","$content","html","$data","getUser","author","last","getTime","publish","modify","fromApi","wikitext","parse","text","$wikitext","$html","Obj","window","WikiForum","cache","pages","fromHtml","$code","actionGet","getThread","forumEl","forumid","threadid","Number","split","item","_","ctx","renderAllForums","theme","allForumsContainer","append","renderForum","_forum","forumContainer","newThreadArea","getNewThreadArea","firstThread","fn","newReplyArea","getNewReplyArea","normalThread","ctx1","$replyBtn","href","$modifyBtn","$deleteBtn","$textArea","$submitBtn","$container","JSON","stringify","click","val","newThread","fromPage","target","then","obj","toPage","toHtml","fire","newThreadStruc","meta1","key","replace","toLowerCase","attr","hasThread","res","ret","isComplex","makeWikitext","updateThread","findAndUpdate","base","allThreads","userLast","wgUserName","timeModify","Date","toISOString","addThread","now","timestamp","addReply","loader","using","Core","parser","renderer","updater","extend"],"mappings":"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","file":"WikiForum.core.js","sourcesContent":["const { api, conf } = require('./mw')\n\nmodule.exports = (page = conf.wgPageName) => {\n  return $.get(api, {\n    format: 'json',\n    action: 'parse',\n    prop: 'text|wikitext',\n    page,\n  })\n}\n","function log(...data) {\r\n  console.info('[WikiForum] [INFO]', ...data)\r\n}\r\n\r\nfunction warn(...data) {\r\n  console.warn('[WikiForum] [WARN]', ...data)\r\n}\r\n\r\nfunction error(...data) {\r\n  console.error('[WikiForum] [ERR]', ...data)\r\n}\r\n\r\nmodule.exports = {\r\n  log,\r\n  info: log,\r\n  warn,\r\n  error,\r\n  err: error,\r\n}\r\n","module.exports = {\r\n  api: mw.util.wikiScript('api'),\r\n  conf: mw.config.get(),\r\n  editToken: mw.user.tokens.get('editToken'),\r\n  hook: mw.hook,\r\n  util: mw.util,\r\n}\r\n","/**\r\n * @function parseForums 从源代码解析可能存在的全部主题\r\n * @param {Element} code\r\n * @param {String} title\r\n */\r\nfunction parseForums(code, title) {\r\n  var $root = $(code)\r\n  var forums = []\r\n\r\n  if (!$root.hasClass('wiki-forum')) {\r\n    $root = $root.find('.wiki-forum')\r\n  }\r\n  $root.each((index, forum) => {\r\n    forums.push({\r\n      id: String(index + 1),\r\n      meta: $(forum).data(),\r\n      threads: parseThreads(forum),\r\n    })\r\n  })\r\n  return forums\r\n}\r\n\r\n/**\r\n * @function parseThreads 递归全部的帖子\r\n * @param {Element} forum\r\n * @param {String} prefix\r\n */\r\nfunction parseThreads(forum, prefix = '') {\r\n  var $forum = $(forum)\r\n  if (prefix) prefix += '-'\r\n  var threads = []\r\n  $threads = getThreads($forum)\r\n  $.each($threads, (index, thread) => {\r\n    var threadObj = {\r\n      id: String(prefix + (index + 1)),\r\n      content: getContent(thread),\r\n      meta: getMeta(thread),\r\n    }\r\n    if (getThreads(thread).length > 0) {\r\n      threadObj.threads = parseThreads(thread, threadObj.id)\r\n    }\r\n    threads.push(threadObj)\r\n  })\r\n  return threads\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子可能存在的回复的结构\r\n * @param {Element} thread\r\n */\r\nfunction getThreads(thread) {\r\n  var $thread = $(thread)\r\n  return $thread.find('> .forum-thread')\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子内容\r\n * @param {Element} thread\r\n */\r\nfunction getContent(thread) {\r\n  var $thread = $(thread)\r\n  var $content = $thread.find('> .forum-content').html() || ''\r\n  return $content\r\n}\r\n\r\n/**\r\n * @function getMeta 获取帖子的源信息\r\n * @param {Element} thread\r\n */\r\nfunction getMeta(thread) {\r\n  var $thread = $(thread)\r\n  var $data = $thread.data()\r\n\r\n  return $data\r\n}\r\n\r\n/**\r\n * @function getUser 获取帖子发帖者信息\r\n * @param {Element} thread\r\n */\r\nfunction getUser(thread) {\r\n  var $thread = $(thread)\r\n  var author = $thread.data('userAuthor') || ''\r\n  var last = $thread.data('userLast') || author\r\n  return { author, last }\r\n}\r\n\r\n/**\r\n * @function getTime 获取帖子发帖时间信息\r\n * @param {Element} thread\r\n */\r\nfunction getTime(thread) {\r\n  var $thread = $(thread)\r\n  var publish = $thread.data('timePublish') || ''\r\n  var modify = $thread.data('timeModify') || publish\r\n  return { publish, modify }\r\n}\r\n\r\n/**\r\n * @module fromApi 解析 MediaWiki API 返回的信息\r\n * @param {Object} data 来自 API 的结果：api.php?action=parse&prop=wikitext|text&page=<pageName>\r\n */\r\nfunction fromApi(data) {\r\n  var { title } = data\r\n  var wikitext = data.parse.wikitext['*']\r\n  var html = data.parse.text['*']\r\n\r\n  // 防止输出没有根元素\r\n  var $wikitext = $('<div>' + wikitext + '</div>')\r\n  var $html = $('<div>' + html + '</div>')\r\n\r\n  // 高版本输出自带根元素，低版本没有\r\n  if ($html.find('> .mw-parser-output').length > 0) {\r\n    $html = $html.find('> .mw-parser-output')\r\n  }\r\n\r\n  var Obj = {\r\n    wikitext: parseForums($wikitext, title),\r\n    html: parseForums($html, title),\r\n  }\r\n\r\n  // 缓存全部forum\r\n  window.WikiForum = window.WikiForum || {}\r\n  window.WikiForum.cache = window.WikiForum.cache || {}\r\n  window.WikiForum.cache.pages = window.WikiForum.cache.pages || {}\r\n  window.WikiForum.cache.pages[title] = Obj\r\n  return Obj\r\n}\r\n\r\n/**\r\n * @module fromHtml 从 HTML 源代码解析\r\n * @param {String|Element} code\r\n */\r\nfunction fromHtml(code, title = '') {\r\n  var $code = $(code)\r\n  return parseForums($code)\r\n}\r\n\r\nmodule.exports = {\r\n  fromApi,\r\n  fromHtml,\r\n}\r\n","const { fromApi } = require('./parser')\nconst actionGet = require('./actionGet')\nconst { util } = require('./mw')\nconst log = require('./log')\n\n// 获取帖子元素\nfunction getThread({ forumEl, forumid = '1', threadid }) {\n  // 将 id 调整为程序可读的 index\n  forumid = Number(forumid)\n  forumid--\n  var forum = forumEl[forumid]\n\n  threadid = threadid.split('-')\n  $.each(threadid, (index, item) => {\n    item = Number(item)\n    item--\n    threadid[index] = item\n  })\n\n  // 开始递归 threads\n  var thread = forum\n  $.each(threadid, (_, id) => {\n    log.log('thread', thread.threads[id])\n    thread = thread.threads[id]\n  })\n\n  return thread\n}\n\n// 获取帖子内容\nfunction getContent(ctx) {\n  var thread = getThread(ctx)\n  return thread.content\n}\n\n// 获取帖子元信息\nfunction getMeta(ctx) {\n  var thread = getThread(ctx)\n  return thread.meta\n}\n\n// 递归全部主题\nfunction renderAllForums({ forumEl, theme }) {\n  $root = theme.allForumsContainer()\n  $.each(forumEl, (index, forum) => {\n    $root.append(\n      renderForum({ _forum: forumEl, forumid: forum.id, forumEl: forum, theme })\n    )\n  })\n  return $root\n}\n\n// 渲染单个主题\nfunction renderForum(ctx, $root) {\n  var { _forum, forumEl, forumid, theme } = ctx\n  var threads = forumEl.threads\n  $root = $root || $(theme.forumContainer({ meta: forumEl.meta }))\n\n  var newThreadArea = getNewThreadArea({\n    forumEl: _forum,\n    forumid: _forum.meta.id,\n  })\n\n  $.each(threads, (index, item) => {\n    // 缓存帖子对象\n    var $thread\n\n    if (index === 0 && forumEl.title) {\n      // 楼主\n      $thread = theme.firstThread({\n        meta: item.meta,\n        content: item.content,\n        fn: {\n          newThreadArea,\n          newReplyArea: getNewReplyArea({\n            forumEl: _forum,\n            forumid,\n            threadid: item.id,\n          }),\n        },\n      })\n    } else {\n      // 一般楼层\n      $thread = theme.normalThread({\n        meta: item.meta,\n        content: item.content,\n        fn: {\n          newThreadArea,\n          newReplyArea: getNewReplyArea({\n            forumEl: _forum,\n            forumid,\n            threadid: item.id,\n          }),\n        },\n      })\n    }\n\n    // 如果有回复，处理回复\n    if (item.threads && item.threads.length > 0) {\n      var ctx1 = ctx\n      ctx1.forumEl = item\n      $thread.append(renderForum(ctx1, $thread))\n    }\n\n    $root.append($thread)\n  })\n\n  return $root\n}\n\n// 生成回复框\nfunction getNewReplyArea({ forumEl, forumid, threadid }) {\n  var $replyBtn = $('<a>', { text: '回复', href: 'javascript:;' })\n  var $modifyBtn = $('<a>', { text: '编辑', href: 'javascript:;' })\n  var $deleteBtn = $('<a>', { text: '删除', href: 'javascript:;' })\n  var $textArea = $('<textarea>', { class: 'forum-textarea' })\n  var $submitBtn = $('<button>', {\n    text: '提交',\n    class: 'forum-submit-btn',\n  })\n\n  var $container = $('<div>', {\n    class: 'forum-new-reply-area',\n    'data-debug': JSON.stringify({\n      forumid,\n      threadid,\n    }),\n  }).append(\n    $('<div>', { class: 'forum-modify-container' }).append(\n      $replyBtn,\n      $modifyBtn,\n      $deleteBtn\n    ),\n    $('<label>', { class: 'forum-input-container' }).append(\n      $('<div>').append($textArea),\n      $('<div>').append($submitBtn)\n    )\n  )\n\n  return $container\n}\n\n// 生成新楼框\nfunction getNewThreadArea({ forumEl, forumid }) {\n  var $textArea = $('<textarea>', { class: 'forum-textarea' })\n  var $submitBtn = $('<button>', {\n    text: '提交',\n    class: 'forum-submit-btn',\n  }).click(function() {\n    var content = $textArea.val()\n    if (!content) return\n    newThread({\n      forumEl,\n      forumid,\n      content,\n    })\n  })\n\n  var $container = $('<div>', {\n    class: 'forum-new-thread-area',\n    'data-debug': JSON.stringify({\n      forumid,\n    }),\n  }).append(\n    $('<label>', { class: 'forum-input-container' }).append(\n      $('<div>').append($textArea),\n      $('<div>').append($submitBtn)\n    )\n  )\n\n  return $container\n}\n\n// 从页面加载内容，并渲染到根元素\nfunction fromPage(page = util.wgPageName, target = '#mw-content-text') {\n  log.info('Strat to load page data', page)\n  actionGet(page).then(\n    data => {\n      log.info('Page data ready', page)\n      var obj = fromApi(data)\n      toPage(obj.html, target)\n    },\n    err => {\n      log.err('Failed to load page data', err)\n    }\n  )\n}\n\n// 渲染返回HTML对象\nfunction toHtml(forumEl) {\n  log.log('renderHTML')\n  mw.hook('WikiForum.theme').fire(theme => {\n    return renderAllForums({ forumEl, theme })\n  })\n}\n\n/**\n * @module toPage 从 WikiForum-Element 渲染到根元素\n * @param {Object} forumEl WikiForum-Element\n * @param {String|Element} target 渲染的根元素\n */\nfunction toPage(forumEl, target = '#mw-content-text') {\n  /**\n   * 触发主题函数\n   * @param {Object} ctx 传入的上下文\n   * @param {Functon} next 返回的主题渲染器\n   */\n  mw.hook('WikiForum.theme').fire(theme => {\n    $(target).html(renderAllForums({ forumEl, theme }))\n  })\n}\n\nmodule.exports = {\n  toPage,\n  toHtml,\n  fromPage,\n  getContent,\n  getMeta,\n}\n","const { conf } = require('./mw')\n\nfunction newThreadStruc({ meta, content }) {\n  // 将 fooBar 转换为 foo-bar 的形式\n  var meta1 = {}\n  $.each(meta, (key, val) => {\n    key = 'data-' + key.replace(/(.*)([A-Z])(.*)/g, '$1-$2$3').toLowerCase()\n    meta1[key] = val\n  })\n  meta = meta1\n\n  return $('<div>', { class: 'forum-thread' })\n    .attr(meta)\n    .append($('<div>', { class: 'forum-content', html: content }))\n}\n\nfunction hasThread(thread, id) {\n  var res = false\n  if (thread.id === id) ret = true\n  return res\n}\n\nfunction isComplex() {}\n\nfunction makeWikitext(obj) {}\n\nfunction updateThread({ forumEl, forumid = '1', threadid, content }) {\n  // 将 id 调整为程序可读的 index\n  forumid = Number(forumid)\n  forumid--\n  var forum = forumEl[forumid]\n\n  function findAndUpdate({ threadid, content }, base) {\n    base = base || forum\n    var allThreads = base.threads\n    $.each(allThreads, (index, item) => {\n      if (item.id === threadid) {\n        item.content = content\n        item.meta.userLast = conf.wgUserName\n        item.meta.timeModify = new Date().toISOString()\n      } else if (item.threads) {\n        findAndUpdate({ threadid, content }, item)\n      }\n    })\n  }\n\n  findAndUpdate({ threadid, content })\n\n  return forumEl\n}\n\nfunction addThread({ forumEl, forumid }) {\n  forumid = Number(forumid)\n  forumid--\n\n  var now = new Date()\n  var timestamp = now.toISOString()\n\n  forumEl[forumid].threads.push({\n    meta: {},\n  })\n}\n\nfunction addReply({ forumEl, forumid = '1', threadid }) {}\n\nmodule.exports = {\n  addReply,\n  addThread,\n  updateThread,\n  // deleteThread,\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\r\n * @name WikiForum.core\r\n * @author 机智的小鱼君 <dragon-fish@qq.com>\r\n * @url https://github.com/Wjghj-Project/Gadget-WikiForum\r\n */\r\n'use strict'\r\n\r\nconst log = require('./module/log')\r\nconst { hook } = require('./module/mw')\r\n\r\nmw.loader.using(\r\n  ['mediawiki.api', 'mediawiki.util', 'mediawiki.user'],\r\n  function() {\r\n    // init global variable\r\n    const Core = {\r\n      parser: require('./module/parser'),\r\n      renderer: require('./module/renderer'),\r\n      updater: require('./module/updater'),\r\n    }\r\n\r\n    window.WikiForum = $.extend({}, window.WikiForum, Core)\r\n    hook('WikiForum').fire(Core)\r\n    log.log('Ready!')\r\n  }\r\n)\r\n"],"sourceRoot":""}