{"version":3,"sources":["webpack://mediawiki-wikiforum/./module/actionGet.js","webpack://mediawiki-wikiforum/./module/log.js","webpack://mediawiki-wikiforum/./module/mw.js","webpack://mediawiki-wikiforum/./module/parser.js","webpack://mediawiki-wikiforum/./module/renderer.js","webpack://mediawiki-wikiforum/./module/updater.js","webpack://mediawiki-wikiforum/webpack/bootstrap","webpack://mediawiki-wikiforum/./index.js"],"names":["require","api","conf","module","exports","page","wgPageName","$","get","format","action","prop","log","data","console","info","warn","error","err","mw","util","wikiScript","config","editToken","user","tokens","hook","parseForums","code","title","$root","forums","hasClass","find","each","index","forum","push","id","String","meta","threads","parseThreads","prefix","$forum","$threads","getThreads","thread","threadObj","content","getContent","getMeta","length","$thread","$content","html","$data","getUser","author","last","getTime","publish","modify","fromApi","parse","wikitext","text","$wikitext","$html","Obj","window","WikiForum","cache","pages","fromHtml","$code","forumEl","actionGet","getThread","forumid","threadid","Number","split","item","_","ctx","renderAllForums","theme","allForumsContainer","append","renderForum","_forum","forumMeta","afterAllForums","renderThread","afterForum","forumContainer","threadContainer","fn","parser","updater","fromPage","target","then","obj","toPage","toHtml","fire","newThreadStruc","meta1","key","val","replace","toLowerCase","attr","hasThread","res","ret","isComplex","makeWikitext","updateThread","findAndUpdate","base","allThreads","userLast","wgUserName","timeModify","Date","toISOString","addThread","now","timestamp","addReply","loader","using","Core","renderer","extend"],"mappings":"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","file":"WikiForum.core.js","sourcesContent":["const { api, conf } = require('./mw')\r\n\r\nmodule.exports = (page = conf.wgPageName) => {\r\n  return $.get(api, {\r\n    format: 'json',\r\n    action: 'parse',\r\n    prop: 'text|wikitext',\r\n    page,\r\n  })\r\n}\r\n","function log(...data) {\r\n  console.info('[WikiForum] [INFO]', ...data)\r\n}\r\n\r\nfunction warn(...data) {\r\n  console.warn('[WikiForum] [WARN]', ...data)\r\n}\r\n\r\nfunction error(...data) {\r\n  console.error('[WikiForum] [ERR]', ...data)\r\n}\r\n\r\nmodule.exports = {\r\n  log,\r\n  info: log,\r\n  warn,\r\n  error,\r\n  err: error,\r\n}\r\n","module.exports = {\r\n  api: mw.util.wikiScript('api'),\r\n  conf: mw.config.get(),\r\n  editToken: mw.user.tokens.get('editToken'),\r\n  hook: mw.hook,\r\n  util: mw.util,\r\n}\r\n","const { log } = require('./log')\r\n\r\n/**\r\n * @function parseForums 从源代码解析可能存在的全部主题\r\n * @param {Element} code\r\n * @param {String} title\r\n */\r\nfunction parseForums(code, title) {\r\n  var $root = $(code)\r\n  var forums = []\r\n\r\n  if (!$root.hasClass('wiki-forum')) {\r\n    $root = $root.find('.wiki-forum')\r\n  }\r\n\r\n  log('开始解析全论坛结构')\r\n\r\n  $root.each((index, forum) => {\r\n    log('单论坛结构', { index, forum })\r\n    forums.push({\r\n      id: String(index + 1),\r\n      title,\r\n      meta: $(forum).data(),\r\n      threads: parseThreads(forum),\r\n    })\r\n  })\r\n  return forums\r\n}\r\n\r\n/**\r\n * @function parseThreads 递归全部的帖子\r\n * @param {Element} forum\r\n * @param {String} prefix\r\n */\r\nfunction parseThreads(forum, prefix = '') {\r\n  var $forum = $(forum)\r\n  if (prefix) prefix += '-'\r\n  var threads = []\r\n  $threads = getThreads($forum)\r\n  $.each($threads, (index, thread) => {\r\n    var threadObj = {\r\n      id: String(prefix + (index + 1)),\r\n      content: getContent(thread),\r\n      meta: getMeta(thread),\r\n    }\r\n    if (getThreads(thread).length > 0) {\r\n      threadObj.threads = parseThreads(thread, threadObj.id)\r\n    }\r\n    threads.push(threadObj)\r\n  })\r\n  return threads\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子可能存在的回复的结构\r\n * @param {Element} thread\r\n */\r\nfunction getThreads(thread) {\r\n  var $thread = $(thread)\r\n  return $thread.find('> .forum-thread')\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子内容\r\n * @param {Element} thread\r\n */\r\nfunction getContent(thread) {\r\n  var $thread = $(thread)\r\n  var $content = $thread.find('> .forum-content').html() || ''\r\n  return $content\r\n}\r\n\r\n/**\r\n * @function getMeta 获取帖子的源信息\r\n * @param {Element} thread\r\n */\r\nfunction getMeta(thread) {\r\n  var $thread = $(thread)\r\n  var $data = $thread.data()\r\n\r\n  return $data\r\n}\r\n\r\n/**\r\n * @function getUser 获取帖子发帖者信息\r\n * @param {Element} thread\r\n */\r\nfunction getUser(thread) {\r\n  var $thread = $(thread)\r\n  var author = $thread.data('userAuthor') || ''\r\n  var last = $thread.data('userLast') || author\r\n  return { author, last }\r\n}\r\n\r\n/**\r\n * @function getTime 获取帖子发帖时间信息\r\n * @param {Element} thread\r\n */\r\nfunction getTime(thread) {\r\n  var $thread = $(thread)\r\n  var publish = $thread.data('timePublish') || ''\r\n  var modify = $thread.data('timeModify') || publish\r\n  return { publish, modify }\r\n}\r\n\r\n/**\r\n * @module fromApi 解析 MediaWiki API 返回的信息\r\n * @param {Object} data 来自 API 的结果：api.php?action=parse&prop=wikitext|text&page=<pageName>\r\n */\r\nfunction fromApi(data) {\r\n  log('从 API 结果解析论坛结构')\r\n\r\n  var title = data.parse.title\r\n  var wikitext = data.parse.wikitext['*']\r\n  var html = data.parse.text['*']\r\n\r\n  // 防止输出没有根元素\r\n  var $wikitext = $('<div>' + wikitext + '</div>')\r\n  var $html = $('<div>' + html + '</div>')\r\n\r\n  // 高版本输出自带根元素，低版本没有\r\n  if ($html.find('> .mw-parser-output').length > 0) {\r\n    $html = $html.find('> .mw-parser-output')\r\n  }\r\n\r\n  var Obj = {\r\n    wikitext: parseForums($wikitext, title),\r\n    html: parseForums($html, title),\r\n  }\r\n\r\n  // 缓存全部forum\r\n  window.WikiForum = window.WikiForum || {}\r\n  window.WikiForum.cache = window.WikiForum.cache || {}\r\n  window.WikiForum.cache.pages = window.WikiForum.cache.pages || {}\r\n  window.WikiForum.cache.pages[title] = Obj\r\n\r\n  log('从 API 结果解析完成', Obj)\r\n  return Obj\r\n}\r\n\r\n/**\r\n * @module fromHtml 从 HTML 源代码解析\r\n * @param {String|Element} code\r\n */\r\nfunction fromHtml(code, title = '') {\r\n  var $code = $(code)\r\n  var forumEl = parseForums($code)\r\n  log('从 HTML 源代码解析完成', forumEl)\r\n  return forumEl\r\n}\r\n\r\nmodule.exports = {\r\n  fromApi,\r\n  fromHtml,\r\n}\r\n","const { fromApi } = require('./parser')\r\nconst actionGet = require('./actionGet')\r\nconst { util, hook, conf } = require('./mw')\r\nconst { log, error } = require('./log')\r\n\r\n// 获取帖子元素\r\nfunction getThread({ forumEl, forumid = '1', threadid }) {\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  var forum = forumEl[forumid]\r\n\r\n  threadid = threadid.split('-')\r\n  $.each(threadid, (index, item) => {\r\n    item = Number(item)\r\n    item--\r\n    threadid[index] = item\r\n  })\r\n\r\n  // 开始递归 threads\r\n  var thread = forum\r\n  $.each(threadid, (_, id) => {\r\n    log('thread', thread.threads[id])\r\n    thread = thread.threads[id]\r\n  })\r\n\r\n  return thread\r\n}\r\n\r\n// 获取帖子内容\r\nfunction getContent(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.content\r\n}\r\n\r\n// 获取帖子元信息\r\nfunction getMeta(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.meta\r\n}\r\n\r\n// 递归全部主题\r\nfunction renderAllForums({ forumEl, theme }) {\r\n  log('开始渲染全部论坛')\r\n  $root = theme.allForumsContainer()\r\n  $.each(forumEl, (index, forum) => {\r\n    log('递归渲染主题', `${index + 1}/${forumEl.length}`)\r\n    $root.append(\r\n      renderForum({\r\n        _forum: forumEl,\r\n        forumMeta: forum.meta,\r\n        forumid: forum.id,\r\n        forumEl: forum,\r\n        theme,\r\n      }),\r\n      theme.afterAllForums ? theme.afterAllForums() : ''\r\n    )\r\n  })\r\n  return $root\r\n}\r\n\r\n// 渲染单个主题\r\nfunction renderForum(ctx) {\r\n  var { theme } = ctx\r\n\r\n  var $root = renderThread(ctx, $root)\r\n  if (theme.afterForum) $root.append(theme.afterForum())\r\n\r\n  return $root\r\n}\r\n\r\nfunction renderThread(ctx, $root) {\r\n  var { theme, threads, forumid } = ctx\r\n  $root = theme.forumContainer({ meta: forumEl.meta })\r\n\r\n  $.each(threads, (index, item) => {\r\n    log('递归渲染贴子', { forumid, threadid: item.id })\r\n    // 缓存帖子对象\r\n    $thread = theme.threadContainer({\r\n      _forum,\r\n      forumMeta,\r\n      forumid,\r\n      id: item.id,\r\n      meta: item.meta,\r\n      content: item.content,\r\n      fn,\r\n    })\r\n\r\n    // 如果有回复，处理回复\r\n    if (item.threads && item.threads.length > 0) {\r\n      ctx.forumEl = item\r\n      $thread.append(renderThread(ctx, $thread))\r\n    }\r\n    $root.append($thread)\r\n  })\r\n\r\n  return $root\r\n}\r\n\r\nvar fn = {\r\n  parser: require('./parser'),\r\n  updater: require('./updater'),\r\n}\r\n\r\n// 从页面加载内容，并渲染到根元素\r\nfunction fromPage(page = conf.wgPageName, target = '#mw-content-text') {\r\n  log('从页面加载信息并渲染', { page, target })\r\n  actionGet(page).then(\r\n    data => {\r\n      log('成功从 API 获取源代码', page)\r\n      var obj = fromApi(data)\r\n      toPage(obj.html, target)\r\n    },\r\n    err => {\r\n      error('从 API 获取源代码失败', { page, err })\r\n    }\r\n  )\r\n}\r\n\r\n// 渲染返回HTML对象\r\nfunction toHtml(forumEl) {\r\n  log('渲染并返回 HTML')\r\n  mw.hook('WikiForum.theme').fire(theme => {\r\n    return renderAllForums({ forumEl, theme })\r\n  })\r\n}\r\n\r\n/**\r\n * @module toPage 从 WikiForum-Element 渲染到根元素\r\n * @param {Object} forumEl WikiForum-Element\r\n * @param {String|Element} target 渲染的根元素\r\n */\r\nfunction toPage(forumEl, target = '#mw-content-text') {\r\n  log('准备渲染到页面')\r\n  /**\r\n   * 触发主题函数\r\n   * @param {Functon} theme 返回的主题渲染器\r\n   */\r\n  hook('WikiForum.theme').fire(theme => {\r\n    $(target).html(renderAllForums({ forumEl, theme }))\r\n    log('页面渲染完毕')\r\n    hook('WikiForum.renderer').fire()\r\n  })\r\n}\r\n\r\nmodule.exports = {\r\n  toPage,\r\n  toHtml,\r\n  fromPage,\r\n  getContent,\r\n  getMeta,\r\n}\r\n","const { conf } = require('./mw')\r\n\r\nfunction newThreadStruc({ meta, content }) {\r\n  // 将 fooBar 转换为 foo-bar 的形式\r\n  var meta1 = {}\r\n  $.each(meta, (key, val) => {\r\n    key = 'data-' + key.replace(/(.*)([A-Z])(.*)/g, '$1-$2$3').toLowerCase()\r\n    meta1[key] = val\r\n  })\r\n  meta = meta1\r\n\r\n  return $('<div>', { class: 'forum-thread' })\r\n    .attr(meta)\r\n    .append($('<div>', { class: 'forum-content', html: content }))\r\n}\r\n\r\nfunction hasThread(thread, id) {\r\n  var res = false\r\n  if (thread.id === id) ret = true\r\n  return res\r\n}\r\n\r\nfunction isComplex() {}\r\n\r\nfunction makeWikitext(obj) {}\r\n\r\nfunction updateThread({ forumEl, forumid = '1', threadid, content }) {\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  var forum = forumEl[forumid]\r\n\r\n  function findAndUpdate({ threadid, content }, base) {\r\n    base = base || forum\r\n    var allThreads = base.threads\r\n    $.each(allThreads, (index, item) => {\r\n      if (item.id === threadid) {\r\n        item.content = content\r\n        item.meta.userLast = conf.wgUserName\r\n        item.meta.timeModify = new Date().toISOString()\r\n      } else if (item.threads) {\r\n        findAndUpdate({ threadid, content }, item)\r\n      }\r\n    })\r\n  }\r\n\r\n  findAndUpdate({ threadid, content })\r\n\r\n  return forumEl\r\n}\r\n\r\nfunction addThread({ forumEl, forumid }) {\r\n  forumid = Number(forumid)\r\n  forumid--\r\n\r\n  var now = new Date()\r\n  var timestamp = now.toISOString()\r\n\r\n  forumEl[forumid].threads.push({\r\n    meta: {},\r\n  })\r\n}\r\n\r\nfunction addReply({ forumEl, forumid = '1', threadid }) {}\r\n\r\nmodule.exports = {\r\n  addReply,\r\n  addThread,\r\n  updateThread,\r\n  // deleteThread,\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\r\n * @name WikiForum.core\r\n * @author 机智的小鱼君 <dragon-fish@qq.com>\r\n * @url https://github.com/Wjghj-Project/Gadget-WikiForum\r\n */\r\n'use strict'\r\n\r\nconst log = require('./module/log')\r\nconst { hook } = require('./module/mw')\r\n\r\nmw.loader.using(\r\n  ['mediawiki.api', 'mediawiki.util', 'mediawiki.user'],\r\n  function() {\r\n    // init global variable\r\n    const Core = {\r\n      parser: require('./module/parser'),\r\n      renderer: require('./module/renderer'),\r\n      updater: require('./module/updater'),\r\n    }\r\n\r\n    window.WikiForum = $.extend({}, window.WikiForum, Core)\r\n    hook('WikiForum').fire(Core)\r\n    log.log('Ready!')\r\n  }\r\n)\r\n"],"sourceRoot":""}