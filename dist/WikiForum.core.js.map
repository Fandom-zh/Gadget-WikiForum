{"version":3,"sources":["webpack://mediawiki-wikiforum/./module/actionGet.js","webpack://mediawiki-wikiforum/./module/log.js","webpack://mediawiki-wikiforum/./module/mw.js","webpack://mediawiki-wikiforum/./module/parser.js","webpack://mediawiki-wikiforum/./module/renderer.js","webpack://mediawiki-wikiforum/./module/updater.js","webpack://mediawiki-wikiforum/webpack/bootstrap","webpack://mediawiki-wikiforum/./index.js"],"names":["require","api","conf","module","exports","page","wgPageName","$","get","format","action","prop","log","data","console","info","warn","error","err","mw","util","wikiScript","config","editToken","user","tokens","hook","parseForums","code","title","$root","forums","hasClass","find","each","index","forum","push","forumid","String","meta","extend","pageName","threads","parseThreads","prefix","$forum","$threads","getThreads","thread","threadObj","threadid","content","getContent","getMeta","length","$thread","$content","html","$data","getUser","author","last","getTime","publish","modify","fromApi","parse","wikitext","text","$wikitext","$html","Obj","window","WikiForum","cache","pages","fromHtml","$code","forumEl","actionGet","getThread","Number","split","item","_","id","ctx","renderAllForums","theme","allForumsContainer","append","renderForum","_forum","forumMeta","afterAllForums","forumContainer","renderThread","afterForum","fn","threadContainer","parser","updater","fromPage","target","then","toPage","toHtml","fire","newThreadStruc","reply","key","val","newKey","replace","toLowerCase","metaList","join","hasThread","res","ret","isComplex","makeWikitext","obj","timeStamp","Date","toISOString","updateThread","findAndUpdate","base","allThreads","userLast","wgUserName","timeModify","handleEdit","addThread","userAuthor","timePublish","addReply","forumsNum","newReply","newThread","loader","using","Core","renderer"],"mappings":"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","file":"WikiForum.core.js","sourcesContent":["const { api, conf } = require('./mw')\r\n\r\nmodule.exports = (page = conf.wgPageName) => {\r\n  return $.get(api, {\r\n    format: 'json',\r\n    action: 'parse',\r\n    prop: 'text|wikitext',\r\n    page,\r\n  })\r\n}\r\n","function log(...data) {\r\n  console.info('[WikiForum] [INFO]', ...data)\r\n}\r\n\r\nfunction warn(...data) {\r\n  console.warn('[WikiForum] [WARN]', ...data)\r\n}\r\n\r\nfunction error(...data) {\r\n  console.error('[WikiForum] [ERR]', ...data)\r\n}\r\n\r\nmodule.exports = {\r\n  log,\r\n  info: log,\r\n  warn,\r\n  error,\r\n  err: error,\r\n}\r\n","module.exports = {\r\n  api: mw.util.wikiScript('api'),\r\n  conf: mw.config.get(),\r\n  editToken: mw.user.tokens.get('editToken'),\r\n  hook: mw.hook,\r\n  util: mw.util,\r\n}\r\n","const { log } = require('./log')\r\n\r\n/**\r\n * @function parseForums 从源代码解析可能存在的全部主题\r\n * @param {Element} code\r\n * @param {String} title\r\n */\r\nfunction parseForums(code, title) {\r\n  var $root = $(code)\r\n  var forums = []\r\n\r\n  if (!$root.hasClass('wiki-forum')) {\r\n    $root = $root.find('.wiki-forum')\r\n  }\r\n\r\n  log('开始解析全论坛结构')\r\n\r\n  $root.each((index, forum) => {\r\n    log('单论坛结构', { index, forum })\r\n    forums.push({\r\n      forumid: String(index + 1),\r\n      meta: $.extend({}, $(forum).data(), { pageName: title }),\r\n      threads: parseThreads(forum),\r\n    })\r\n  })\r\n  return forums\r\n}\r\n\r\n/**\r\n * @function parseThreads 递归全部的帖子\r\n * @param {Element} forum\r\n * @param {String} prefix\r\n */\r\nfunction parseThreads(forum, prefix = '') {\r\n  var $forum = $(forum)\r\n  if (prefix) prefix += '-'\r\n  var threads = []\r\n  $threads = getThreads($forum)\r\n  $.each($threads, (index, thread) => {\r\n    var threadObj = {\r\n      threadid: String(prefix + (index + 1)),\r\n      content: getContent(thread),\r\n      meta: getMeta(thread),\r\n    }\r\n    if (getThreads(thread).length > 0) {\r\n      threadObj.threads = parseThreads(thread, threadObj.threadid)\r\n    }\r\n    threads.push(threadObj)\r\n  })\r\n  return threads\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子可能存在的回复的结构\r\n * @param {Element} thread\r\n */\r\nfunction getThreads(thread) {\r\n  var $thread = $(thread)\r\n  return $thread.find('> .forum-thread')\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子内容\r\n * @param {Element} thread\r\n */\r\nfunction getContent(thread) {\r\n  var $thread = $(thread)\r\n  var $content = $thread.find('> .forum-content').html() || ''\r\n  return $content\r\n}\r\n\r\n/**\r\n * @function getMeta 获取帖子的源信息\r\n * @param {Element} thread\r\n */\r\nfunction getMeta(thread) {\r\n  var $thread = $(thread)\r\n  var $data = $thread.data()\r\n\r\n  return $data\r\n}\r\n\r\n/**\r\n * @function getUser 获取帖子发帖者信息\r\n * @param {Element} thread\r\n */\r\nfunction getUser(thread) {\r\n  var $thread = $(thread)\r\n  var author = $thread.data('userAuthor') || ''\r\n  var last = $thread.data('userLast') || author\r\n  return { author, last }\r\n}\r\n\r\n/**\r\n * @function getTime 获取帖子发帖时间信息\r\n * @param {Element} thread\r\n */\r\nfunction getTime(thread) {\r\n  var $thread = $(thread)\r\n  var publish = $thread.data('timePublish') || ''\r\n  var modify = $thread.data('timeModify') || publish\r\n  return { publish, modify }\r\n}\r\n\r\n/**\r\n * @module fromApi 解析 MediaWiki API 返回的信息\r\n * @param {Object} data 来自 API 的结果：api.php?action=parse&prop=wikitext|text&page=<pageName>\r\n */\r\nfunction fromApi(data) {\r\n  log('从 API 结果解析论坛结构')\r\n\r\n  var title = data.parse.title\r\n  var wikitext = data.parse.wikitext['*']\r\n  var html = data.parse.text['*']\r\n\r\n  // 防止输出没有根元素\r\n  var $wikitext = $('<div>' + wikitext + '</div>')\r\n  var $html = $('<div>' + html + '</div>')\r\n\r\n  // 高版本输出自带根元素，低版本没有\r\n  if ($html.find('> .mw-parser-output').length > 0) {\r\n    $html = $html.find('> .mw-parser-output')\r\n  }\r\n\r\n  var Obj = {\r\n    wikitext: parseForums($wikitext, title),\r\n    html: parseForums($html, title),\r\n  }\r\n\r\n  // 缓存全部forum\r\n  window.WikiForum = window.WikiForum || {}\r\n  window.WikiForum.cache = window.WikiForum.cache || {}\r\n  window.WikiForum.cache.pages = window.WikiForum.cache.pages || {}\r\n  window.WikiForum.cache.pages[title] = Obj\r\n\r\n  log('从 API 结果解析完成', Obj)\r\n  return Obj\r\n}\r\n\r\n/**\r\n * @module fromHtml 从 HTML 源代码解析\r\n * @param {String|Element} code\r\n */\r\nfunction fromHtml(code, title = '') {\r\n  var $code = $(code)\r\n  var forumEl = parseForums($code)\r\n  log('从 HTML 源代码解析完成', forumEl)\r\n  return forumEl\r\n}\r\n\r\nmodule.exports = {\r\n  fromApi,\r\n  fromHtml,\r\n}\r\n","const { fromApi } = require('./parser')\r\nconst actionGet = require('./actionGet')\r\nconst { util, hook, conf } = require('./mw')\r\nconst { log, error } = require('./log')\r\n\r\n// 获取帖子元素\r\nfunction getThread({ forumEl, forumid = '1', threadid }) {\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  var forum = forumEl[forumid]\r\n\r\n  threadid = threadid.split('-')\r\n  $.each(threadid, (index, item) => {\r\n    item = Number(item)\r\n    item--\r\n    threadid[index] = item\r\n  })\r\n\r\n  // 开始递归 threads\r\n  var thread = forum\r\n  $.each(threadid, (_, id) => {\r\n    log('thread', thread.threads[id])\r\n    thread = thread.threads[id]\r\n  })\r\n\r\n  return thread\r\n}\r\n\r\n// 获取帖子内容\r\nfunction getContent(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.content\r\n}\r\n\r\n// 获取帖子元信息\r\nfunction getMeta(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.meta\r\n}\r\n\r\n// 递归全部主题\r\nfunction renderAllForums({ Obj, theme }) {\r\n  log('开始渲染全部论坛')\r\n  $root = theme.allForumsContainer()\r\n  const { html } = Obj\r\n\r\n  $.each(html, (index, forum) => {\r\n    log('递归渲染主题', `${index + 1}/${html.length}`)\r\n    $root.append(\r\n      renderForum({\r\n        _forum: Obj,\r\n        forumMeta: forum.meta,\r\n        forumid: forum.forumid,\r\n        forum,\r\n        theme,\r\n      }),\r\n      theme.afterAllForums ? theme.afterAllForums() : ''\r\n    )\r\n  })\r\n  return $root\r\n}\r\n\r\n// 渲染单个主题\r\nfunction renderForum(ctx) {\r\n  const { _forum, forum, forumMeta, forumid, theme } = ctx\r\n  log('渲染主题', { forumid })\r\n\r\n  var $root = theme.forumContainer({ meta: forumMeta })\r\n\r\n  $.each(forum.threads, (index, thread) => {\r\n    $root.append(\r\n      renderThread({\r\n        _forum,\r\n        theme,\r\n        thread,\r\n        forumMeta,\r\n        forumid,\r\n      })\r\n    )\r\n  })\r\n\r\n  if (theme.afterForum) {\r\n    $root.append(theme.afterForum({ _forum, forumMeta, forumid, fn }))\r\n  }\r\n\r\n  return $root\r\n}\r\n\r\n// 渲染单个帖子\r\nfunction renderThread(ctx) {\r\n  const { _forum, theme, thread, forumMeta, forumid } = ctx\r\n  const { content, meta, threadid } = thread\r\n\r\n  log('渲染贴子', { forumid, threadid })\r\n\r\n  // 缓存帖子对象\r\n  let $thread = theme.threadContainer({\r\n    _forum,\r\n    forumMeta,\r\n    forumid,\r\n    threadid,\r\n    meta,\r\n    content,\r\n    fn,\r\n  })\r\n\r\n  // 如果有回复，处理回复\r\n  if (thread.threads && thread.threads.length > 0) {\r\n    $.each(thread.threads, (index, thread) => {\r\n      ctx.thread = thread\r\n      $thread.append(renderThread(ctx))\r\n    })\r\n  }\r\n\r\n  return $thread\r\n}\r\n\r\nconst fn = {\r\n  parser: require('./parser'),\r\n  updater: require('./updater'),\r\n}\r\n\r\n// 从页面加载内容，并渲染到根元素\r\nfunction fromPage(page = conf.wgPageName, target = '#mw-content-text') {\r\n  log('从页面加载信息并渲染', { page, target })\r\n  actionGet(page).then(\r\n    data => {\r\n      log('成功从 API 获取源代码', page)\r\n      var Obj = fromApi(data)\r\n      toPage(Obj, target)\r\n    },\r\n    err => {\r\n      error('从 API 获取源代码失败', { page, err })\r\n    }\r\n  )\r\n}\r\n\r\n// 渲染返回HTML对象\r\nfunction toHtml(forumEl) {\r\n  log('渲染并返回 HTML')\r\n  mw.hook('WikiForum.theme').fire(theme => {\r\n    return renderAllForums({ forumEl, theme })\r\n  })\r\n}\r\n\r\n/**\r\n * @module toPage 从 WikiForum-Element 渲染到根元素\r\n * @param {Object} forumEl WikiForum-Element\r\n * @param {String|Element} target 渲染的根元素\r\n */\r\nfunction toPage(Obj, target = '#mw-content-text') {\r\n  log('准备渲染到页面，等待主题文件……')\r\n  /**\r\n   * 触发主题函数\r\n   * @param {Functon} theme 返回的主题渲染器\r\n   */\r\n  hook('WikiForum.theme').fire(theme => {\r\n    $(target).html(renderAllForums({ Obj, theme }))\r\n    log('页面渲染完毕')\r\n    hook('WikiForum.renderer').fire()\r\n  })\r\n}\r\n\r\nmodule.exports = {\r\n  toPage,\r\n  toHtml,\r\n  fromPage,\r\n  getContent,\r\n  getMeta,\r\n}\r\n","const { conf } = require('./mw')\r\nconst { log } = require('./log')\r\n\r\nfunction newThreadStruc({ meta, content, reply = '' }) {\r\n  // 将 fooBar 转换为 foo-bar 的形式\r\n  $.each(meta, (key, val) => {\r\n    let newKey = key.replace(/(.*)([A-Z])(.*)/g, '$1-$2$3').toLowerCase()\r\n    meta[newKey] = val\r\n    delete meta[key]\r\n  })\r\n\r\n  // meta 转换为字符串\r\n  var metaList = []\r\n  $.each(meta, (key, val) => {\r\n    metaList.push(`data-${key}=\"${val}\"`)\r\n  })\r\n  metaList = metaList.join(' ')\r\n\r\n  var html = `<!-- thread -->\r\n<div class=\"forum-thread\" ${metaList}>\r\n<div class=\"forum-content\"></div>${reply ? '\\n' + reply : ''}\r\n</div>\r\n<!-- /thread -->`\r\n\r\n  return html\r\n}\r\n\r\nfunction hasThread(thread, id) {\r\n  var res = false\r\n  if (thread.id === id) ret = true\r\n  return res\r\n}\r\n\r\nfunction isComplex() {}\r\n\r\nfunction makeWikitext(obj) {}\r\n\r\nfunction timeStamp() {\r\n  return new Date().toISOString()\r\n}\r\n\r\n/**\r\n * @function updateThread 编辑内容\r\n */\r\nfunction updateThread({ forumEl, forumid = '1', threadid, content }) {\r\n  const { wikitext } = forumEl\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  const forum = wikitext[forumid]\r\n\r\n  function findAndUpdate({ threadid, content }, base) {\r\n    var allThreads = base.threads\r\n    $.each(allThreads, (index, item) => {\r\n      if (item.threadid === threadid) {\r\n        item.content = content\r\n        item.meta.userLast = conf.wgUserName\r\n        item.meta.timeModify = timeStamp()\r\n      } else if (item.threads) {\r\n        findAndUpdate({ threadid, content }, item)\r\n      }\r\n    })\r\n  }\r\n\r\n  findAndUpdate({ threadid, content }, forum)\r\n\r\n  log('Update thread', { forumid, threadid, content })\r\n  handleEdit(wikitext)\r\n}\r\n\r\n/**\r\n * @function addThread 盖新楼，回复楼主\r\n */\r\nfunction addThread({ forumEl, forumid, content }) {\r\n  const { wikitext } = forumEl\r\n  forumid = Number(forumid)\r\n  forumid--\r\n\r\n  wikitext[forumid].threads.push({\r\n    meta: {\r\n      userAuthor: conf.wgUserName,\r\n      userLast: conf.wgUserName,\r\n      timePublish: timeStamp(),\r\n      timeModify: timeStamp(),\r\n    },\r\n    content,\r\n  })\r\n\r\n  log('Add thread', { forumid, content })\r\n\r\n  handleEdit(wikitext)\r\n}\r\n\r\n/**\r\n * @function addReply 新回复，回复层主\r\n */\r\nfunction addReply({ forumEl, forumid = '1', threadid, content }) {\r\n  const { wikitext } = forumEl\r\n  // 给楼主回复其实就是盖新楼\r\n  if (threadid === '1') {\r\n    return addThread({ forumEl, forumid, content })\r\n  }\r\n\r\n  forumid = Number(forumid)\r\n  forumid--\r\n\r\n  const forum = wikitext[forumid]\r\n\r\n  function findAndUpdate({ threadid, content }, base) {\r\n    var allThreads = base.threads\r\n    $.each(allThreads, (index, item) => {\r\n      if (item.threadid === threadid) {\r\n        item.threads = item.threads || []\r\n        item.threads.push({\r\n          meta: {\r\n            userAuthor: conf.wgUserName,\r\n            userLast: conf.wgUserName,\r\n            timePublish: timeStamp(),\r\n            timeModify: timeStamp(),\r\n          },\r\n          content,\r\n        })\r\n      } else if (item.threads) {\r\n        findAndUpdate({ threadid, content }, item)\r\n      }\r\n    })\r\n  }\r\n\r\n  findAndUpdate({ threadid, content }, forum)\r\n\r\n  log('Add reply', { forumid, threadid, content })\r\n\r\n  handleEdit(wikitext)\r\n}\r\n\r\n/**\r\n * @function handleEdit 将forumEl转换为wikitext并发布\r\n * @param {Object} forumEl\r\n */\r\nfunction handleEdit(forumEl) {\r\n  log('Make edit', forumEl, {\r\n    pageName: forumEl[0].meta.pageName,\r\n    forumsNum: forumEl.length,\r\n  })\r\n}\r\n\r\nmodule.exports = {\r\n  addReply,\r\n  newReply: addReply,\r\n  addThread,\r\n  newThread: addThread,\r\n  updateThread,\r\n  // deleteThread,\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\r\n * @name WikiForum.core\r\n * @author 机智的小鱼君 <dragon-fish@qq.com>\r\n * @url https://github.com/Wjghj-Project/Gadget-WikiForum\r\n */\r\n'use strict'\r\n\r\nconst log = require('./module/log')\r\nconst { hook } = require('./module/mw')\r\n\r\nmw.loader.using(\r\n  ['mediawiki.api', 'mediawiki.util', 'mediawiki.user'],\r\n  function() {\r\n    // init global variable\r\n    const Core = {\r\n      parser: require('./module/parser'),\r\n      renderer: require('./module/renderer'),\r\n      updater: require('./module/updater'),\r\n    }\r\n\r\n    window.WikiForum = $.extend({}, window.WikiForum, Core)\r\n    hook('WikiForum').fire(Core)\r\n    log.log('Ready!')\r\n  }\r\n)\r\n"],"sourceRoot":""}