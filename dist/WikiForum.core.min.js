/*! For license information please see WikiForum.core.min.js.LICENSE.txt */
!function(){var t={946:function(t,r,e){var n=e(344),o=n.api,i=n.conf;t.exports=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.wgPageName;return $.get(o,{format:"json",action:"parse",prop:"text|wikitext",page:t})}},416:function(t){function r(){for(var t,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];(t=console).info.apply(t,["[WikiForum] [INFO]"].concat(e))}function e(){for(var t,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];(t=console).error.apply(t,["[WikiForum] [ERR]"].concat(e))}t.exports={log:r,info:r,warn:function(){for(var t,r=arguments.length,e=new Array(r),n=0;n<r;n++)e[n]=arguments[n];(t=console).warn.apply(t,["[WikiForum] [WARN]"].concat(e))},error:e,err:e}},344:function(t){t.exports={api:mw.util.wikiScript("api"),conf:mw.config.get(),editToken:mw.user.tokens.get("editToken"),hook:mw.hook,util:mw.util}},904:function(t){function r(t,r){var n=$(t),o=[];return n.hasClass("wiki-forum")||(n=n.find(".wiki-forum")),n.each((function(t,r){o.push({id:String(t+1),meta:$(r).data(),threads:e(r)})})),o}function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=$(t);r&&(r+="-");var u=[];return $threads=n(a),$.each($threads,(function(t,a){var f={id:String(r+(t+1)),content:o(a),meta:i(a)};n(a).length>0&&(f.threads=e(a,f.id)),u.push(f)})),u}function n(t){return $(t).find("> .forum-thread")}function o(t){return $(t).find("> .forum-content").html()||""}function i(t){return $(t).data()}t.exports={fromApi:function(t){var e=t.parse.title,n=t.parse.wikitext["*"],o=t.parse.text["*"],i=$("<div>"+n+"</div>"),a=$("<div>"+o+"</div>");a.find("> .mw-parser-output").length>0&&(a=a.find("> .mw-parser-output"));var u={wikitext:r(i),html:r(a)};return window.WikiForum=window.WikiForum||{},window.WikiForum.cache=window.WikiForum.cache||{},window.WikiForum.cache.pages=window.WikiForum.cache.pages||{},window.WikiForum.cache.pages[e]=u,u},fromHtml:function(t){return r($(t))}}},767:function(t,r,e){var n=e(904).fromApi,o=e(946),i=e(344),a=i.util,u=i.hook,f=e(416);function d(t){var r=t.forumEl,e=t.forumid,n=void 0===e?"1":e,o=t.threadid;n=Number(n);var i=r[--n];o=o.split("-"),$.each(o,(function(t,r){r=Number(r),r--,o[t]=r}));var a=i;return $.each(o,(function(t,r){f.log("thread",a.threads[r]),a=a.threads[r]})),a}function m(t){var r=t.forumEl,e=t.theme;return $root=e.allForumsContainer(),$.each(r,(function(t,n){$root.append(c({_forum:r,forumid:n.id,forumEl:n,theme:e}))})),$root}function c(t,r){var e=t._forum,n=t.forumEl,o=t.forumid,i=t.theme,a=n.threads;return r=r||i.forumContainer({meta:n.meta}),$.each(a,(function(n,a){var u=i.threadContainer({_forum:e,forumid:o,meta:a.meta,content:a.content,fn:h});if(a.threads&&a.threads.length>0){var f=t;f.forumEl=a,u.append(c(f,u))}r.append(u)})),r}var h={parser:e(904),updater:e(515)};function p(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#mw-content-text";u("WikiForum.theme").fire((function(e){$(r).html(m({forumEl:t,theme:e})),u("WikiForum.renderer").fire()}))}t.exports={toPage:p,toHtml:function(t){f.log("renderHTML"),mw.hook("WikiForum.theme").fire((function(r){return m({forumEl:t,theme:r})}))},fromPage:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a.wgPageName,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#mw-content-text";f.info("Strat to load page data",t),o(t).then((function(e){f.info("Page data ready",t),p(n(e).html,r)}),(function(t){f.err("Failed to load page data",t)}))},getContent:function(t){return d(t).content},getMeta:function(t){return d(t).meta}}},515:function(t,r,e){var n=e(344).conf;t.exports={addReply:function(t){t.forumEl,t.forumid,t.threadid},addThread:function(t){var r=t.forumEl,e=t.forumid;e=Number(e),e--,(new Date).toISOString(),r[e].threads.push({meta:{}})},updateThread:function(t){var r=t.forumEl,e=t.forumid,o=void 0===e?"1":e,i=t.threadid,a=t.content;o=Number(o);var u=r[--o];return function t(r,e){var o=r.threadid,i=r.content,a=(e=e||u).threads;$.each(a,(function(r,e){e.id===o?(e.content=i,e.meta.userLast=n.wgUserName,e.meta.timeModify=(new Date).toISOString()):e.threads&&t({threadid:o,content:i},e)}))}({threadid:i,content:a}),r}}}},r={};function e(n){if(r[n])return r[n].exports;var o=r[n]={exports:{}};return t[n](o,o.exports,e),o.exports}!function(){"use strict";var t=e(416),r=e(344).hook;mw.loader.using(["mediawiki.api","mediawiki.util","mediawiki.user"],(function(){var n={parser:e(904),renderer:e(767),updater:e(515)};window.WikiForum=$.extend({},window.WikiForum,n),r("WikiForum").fire(n),t.log("Ready!")}))}()}();
//# sourceMappingURL=WikiForum.core.min.js.map