{"version":3,"sources":["webpack://mediawiki-wikiforum/./module/actionGet.js","webpack://mediawiki-wikiforum/./module/log.js","webpack://mediawiki-wikiforum/./module/mw.js","webpack://mediawiki-wikiforum/./module/parser.js","webpack://mediawiki-wikiforum/./module/renderer.js","webpack://mediawiki-wikiforum/./module/updater.js","webpack://mediawiki-wikiforum/webpack/bootstrap","webpack://mediawiki-wikiforum/./index.js"],"names":["require","api","conf","module","exports","page","wgPageName","$","get","format","action","prop","log","data","console","info","error","warn","err","mw","util","wikiScript","config","editToken","user","tokens","hook","parseForums","code","title","$root","forums","hasClass","find","each","index","forum","push","id","String","meta","extend","pageName","threads","parseThreads","prefix","$forum","$threads","getThreads","thread","threadObj","content","getContent","getMeta","length","html","fromApi","parse","wikitext","text","$wikitext","$html","Obj","window","WikiForum","cache","pages","fromHtml","$code","forumEl","actionGet","getThread","forumid","threadid","Number","split","item","_","renderAllForums","theme","allForumsContainer","append","ctx","_forum","forumMeta","forumContainer","renderThread","afterForum","renderForum","afterAllForums","$thread","threadContainer","fn","thread1","parser","updater","toPage","target","fire","toHtml","fromPage","then","addReply","addThread","Date","toISOString","updateThread","findAndUpdate","base","allThreads","userLast","wgUserName","timeModify","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","loader","using","Core","renderer"],"mappings":"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","file":"WikiForum.core.min.js","sourcesContent":["const { api, conf } = require('./mw')\r\n\r\nmodule.exports = (page = conf.wgPageName) => {\r\n  return $.get(api, {\r\n    format: 'json',\r\n    action: 'parse',\r\n    prop: 'text|wikitext',\r\n    page,\r\n  })\r\n}\r\n","function log(...data) {\r\n  console.info('[WikiForum] [INFO]', ...data)\r\n}\r\n\r\nfunction warn(...data) {\r\n  console.warn('[WikiForum] [WARN]', ...data)\r\n}\r\n\r\nfunction error(...data) {\r\n  console.error('[WikiForum] [ERR]', ...data)\r\n}\r\n\r\nmodule.exports = {\r\n  log,\r\n  info: log,\r\n  warn,\r\n  error,\r\n  err: error,\r\n}\r\n","module.exports = {\r\n  api: mw.util.wikiScript('api'),\r\n  conf: mw.config.get(),\r\n  editToken: mw.user.tokens.get('editToken'),\r\n  hook: mw.hook,\r\n  util: mw.util,\r\n}\r\n","const { log } = require('./log')\r\n\r\n/**\r\n * @function parseForums 从源代码解析可能存在的全部主题\r\n * @param {Element} code\r\n * @param {String} title\r\n */\r\nfunction parseForums(code, title) {\r\n  var $root = $(code)\r\n  var forums = []\r\n\r\n  if (!$root.hasClass('wiki-forum')) {\r\n    $root = $root.find('.wiki-forum')\r\n  }\r\n\r\n  log('开始解析全论坛结构')\r\n\r\n  $root.each((index, forum) => {\r\n    log('单论坛结构', { index, forum })\r\n    forums.push({\r\n      id: String(index + 1),\r\n      meta: $.extend({}, $(forum).data(), { pageName: title }),\r\n      threads: parseThreads(forum),\r\n    })\r\n  })\r\n  return forums\r\n}\r\n\r\n/**\r\n * @function parseThreads 递归全部的帖子\r\n * @param {Element} forum\r\n * @param {String} prefix\r\n */\r\nfunction parseThreads(forum, prefix = '') {\r\n  var $forum = $(forum)\r\n  if (prefix) prefix += '-'\r\n  var threads = []\r\n  $threads = getThreads($forum)\r\n  $.each($threads, (index, thread) => {\r\n    var threadObj = {\r\n      id: String(prefix + (index + 1)),\r\n      content: getContent(thread),\r\n      meta: getMeta(thread),\r\n    }\r\n    if (getThreads(thread).length > 0) {\r\n      threadObj.threads = parseThreads(thread, threadObj.id)\r\n    }\r\n    threads.push(threadObj)\r\n  })\r\n  return threads\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子可能存在的回复的结构\r\n * @param {Element} thread\r\n */\r\nfunction getThreads(thread) {\r\n  var $thread = $(thread)\r\n  return $thread.find('> .forum-thread')\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子内容\r\n * @param {Element} thread\r\n */\r\nfunction getContent(thread) {\r\n  var $thread = $(thread)\r\n  var $content = $thread.find('> .forum-content').html() || ''\r\n  return $content\r\n}\r\n\r\n/**\r\n * @function getMeta 获取帖子的源信息\r\n * @param {Element} thread\r\n */\r\nfunction getMeta(thread) {\r\n  var $thread = $(thread)\r\n  var $data = $thread.data()\r\n\r\n  return $data\r\n}\r\n\r\n/**\r\n * @function getUser 获取帖子发帖者信息\r\n * @param {Element} thread\r\n */\r\nfunction getUser(thread) {\r\n  var $thread = $(thread)\r\n  var author = $thread.data('userAuthor') || ''\r\n  var last = $thread.data('userLast') || author\r\n  return { author, last }\r\n}\r\n\r\n/**\r\n * @function getTime 获取帖子发帖时间信息\r\n * @param {Element} thread\r\n */\r\nfunction getTime(thread) {\r\n  var $thread = $(thread)\r\n  var publish = $thread.data('timePublish') || ''\r\n  var modify = $thread.data('timeModify') || publish\r\n  return { publish, modify }\r\n}\r\n\r\n/**\r\n * @module fromApi 解析 MediaWiki API 返回的信息\r\n * @param {Object} data 来自 API 的结果：api.php?action=parse&prop=wikitext|text&page=<pageName>\r\n */\r\nfunction fromApi(data) {\r\n  log('从 API 结果解析论坛结构')\r\n\r\n  var title = data.parse.title\r\n  var wikitext = data.parse.wikitext['*']\r\n  var html = data.parse.text['*']\r\n\r\n  // 防止输出没有根元素\r\n  var $wikitext = $('<div>' + wikitext + '</div>')\r\n  var $html = $('<div>' + html + '</div>')\r\n\r\n  // 高版本输出自带根元素，低版本没有\r\n  if ($html.find('> .mw-parser-output').length > 0) {\r\n    $html = $html.find('> .mw-parser-output')\r\n  }\r\n\r\n  var Obj = {\r\n    wikitext: parseForums($wikitext, title),\r\n    html: parseForums($html, title),\r\n  }\r\n\r\n  // 缓存全部forum\r\n  window.WikiForum = window.WikiForum || {}\r\n  window.WikiForum.cache = window.WikiForum.cache || {}\r\n  window.WikiForum.cache.pages = window.WikiForum.cache.pages || {}\r\n  window.WikiForum.cache.pages[title] = Obj\r\n\r\n  log('从 API 结果解析完成', Obj)\r\n  return Obj\r\n}\r\n\r\n/**\r\n * @module fromHtml 从 HTML 源代码解析\r\n * @param {String|Element} code\r\n */\r\nfunction fromHtml(code, title = '') {\r\n  var $code = $(code)\r\n  var forumEl = parseForums($code)\r\n  log('从 HTML 源代码解析完成', forumEl)\r\n  return forumEl\r\n}\r\n\r\nmodule.exports = {\r\n  fromApi,\r\n  fromHtml,\r\n}\r\n","const { fromApi } = require('./parser')\r\nconst actionGet = require('./actionGet')\r\nconst { util, hook, conf } = require('./mw')\r\nconst { log, error } = require('./log')\r\n\r\n// 获取帖子元素\r\nfunction getThread({ forumEl, forumid = '1', threadid }) {\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  var forum = forumEl[forumid]\r\n\r\n  threadid = threadid.split('-')\r\n  $.each(threadid, (index, item) => {\r\n    item = Number(item)\r\n    item--\r\n    threadid[index] = item\r\n  })\r\n\r\n  // 开始递归 threads\r\n  var thread = forum\r\n  $.each(threadid, (_, id) => {\r\n    log('thread', thread.threads[id])\r\n    thread = thread.threads[id]\r\n  })\r\n\r\n  return thread\r\n}\r\n\r\n// 获取帖子内容\r\nfunction getContent(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.content\r\n}\r\n\r\n// 获取帖子元信息\r\nfunction getMeta(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.meta\r\n}\r\n\r\n// 递归全部主题\r\nfunction renderAllForums({ forumEl, theme }) {\r\n  log('开始渲染全部论坛')\r\n  $root = theme.allForumsContainer()\r\n  $.each(forumEl, (index, forum) => {\r\n    log('递归渲染主题', `${index + 1}/${forumEl.length}`)\r\n    $root.append(\r\n      renderForum({\r\n        _forum: forumEl,\r\n        forumMeta: forum.meta,\r\n        forumid: forum.id,\r\n        forumEl: forum,\r\n        theme,\r\n      }),\r\n      theme.afterAllForums ? theme.afterAllForums() : ''\r\n    )\r\n  })\r\n  return $root\r\n}\r\n\r\n// 渲染单个主题\r\nfunction renderForum(ctx) {\r\n  log('renderForum ctx', ctx)\r\n  var { _forum, forumEl, forumMeta, forumid, theme } = ctx\r\n\r\n  var $root = theme.forumContainer({ meta: forumEl.meta })\r\n\r\n  $.each(forumEl.threads, (index, thread) => {\r\n    log('递归渲染贴子', { forumid })\r\n    $root.append(\r\n      renderThread({\r\n        _forum,\r\n        theme,\r\n        thread,\r\n        forumMeta,\r\n        forumid,\r\n      })\r\n    )\r\n  })\r\n\r\n  if (theme.afterForum) $root.append(theme.afterForum())\r\n\r\n  return $root\r\n}\r\n\r\n// 渲染单个帖子\r\nfunction renderThread(ctx) {\r\n  var { _forum, theme, thread, forumMeta, forumid } = ctx\r\n  log('渲染贴子', { forumid, threadid: thread.id })\r\n\r\n  // 缓存帖子对象\r\n  $thread = theme.threadContainer({\r\n    _forum,\r\n    forumMeta,\r\n    forumid,\r\n    id: thread.id,\r\n    meta: thread.meta,\r\n    content: thread.content,\r\n    fn,\r\n  })\r\n\r\n  // 如果有回复，处理回复\r\n  if (thread.threads && thread.threads.length > 0) {\r\n    $.each(thread.threads, (index, thread1) => {\r\n      ctx.thread = thread1\r\n      $thread.append(renderThread(ctx))\r\n    })\r\n  }\r\n\r\n  return $thread\r\n}\r\n\r\nvar fn = {\r\n  parser: require('./parser'),\r\n  updater: require('./updater'),\r\n}\r\n\r\n// 从页面加载内容，并渲染到根元素\r\nfunction fromPage(page = conf.wgPageName, target = '#mw-content-text') {\r\n  log('从页面加载信息并渲染', { page, target })\r\n  actionGet(page).then(\r\n    data => {\r\n      log('成功从 API 获取源代码', page)\r\n      var obj = fromApi(data)\r\n      toPage(obj.html, target)\r\n    },\r\n    err => {\r\n      error('从 API 获取源代码失败', { page, err })\r\n    }\r\n  )\r\n}\r\n\r\n// 渲染返回HTML对象\r\nfunction toHtml(forumEl) {\r\n  log('渲染并返回 HTML')\r\n  mw.hook('WikiForum.theme').fire(theme => {\r\n    return renderAllForums({ forumEl, theme })\r\n  })\r\n}\r\n\r\n/**\r\n * @module toPage 从 WikiForum-Element 渲染到根元素\r\n * @param {Object} forumEl WikiForum-Element\r\n * @param {String|Element} target 渲染的根元素\r\n */\r\nfunction toPage(forumEl, target = '#mw-content-text') {\r\n  log('准备渲染到页面，等待主题文件……')\r\n  /**\r\n   * 触发主题函数\r\n   * @param {Functon} theme 返回的主题渲染器\r\n   */\r\n  hook('WikiForum.theme').fire(theme => {\r\n    $(target).html(renderAllForums({ forumEl, theme }))\r\n    log('页面渲染完毕')\r\n    hook('WikiForum.renderer').fire()\r\n  })\r\n}\r\n\r\nmodule.exports = {\r\n  toPage,\r\n  toHtml,\r\n  fromPage,\r\n  getContent,\r\n  getMeta,\r\n}\r\n","const { conf } = require('./mw')\r\n\r\nfunction newThreadStruc({ meta, content }) {\r\n  // 将 fooBar 转换为 foo-bar 的形式\r\n  var meta1 = {}\r\n  $.each(meta, (key, val) => {\r\n    key = 'data-' + key.replace(/(.*)([A-Z])(.*)/g, '$1-$2$3').toLowerCase()\r\n    meta1[key] = val\r\n  })\r\n  meta = meta1\r\n\r\n  return $('<div>', { class: 'forum-thread' })\r\n    .attr(meta)\r\n    .append($('<div>', { class: 'forum-content', html: content }))\r\n}\r\n\r\nfunction hasThread(thread, id) {\r\n  var res = false\r\n  if (thread.id === id) ret = true\r\n  return res\r\n}\r\n\r\nfunction isComplex() {}\r\n\r\nfunction makeWikitext(obj) {}\r\n\r\nfunction updateThread({ forumEl, forumid = '1', threadid, content }) {\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  var forum = forumEl[forumid]\r\n\r\n  function findAndUpdate({ threadid, content }, base) {\r\n    base = base || forum\r\n    var allThreads = base.threads\r\n    $.each(allThreads, (index, item) => {\r\n      if (item.id === threadid) {\r\n        item.content = content\r\n        item.meta.userLast = conf.wgUserName\r\n        item.meta.timeModify = new Date().toISOString()\r\n      } else if (item.threads) {\r\n        findAndUpdate({ threadid, content }, item)\r\n      }\r\n    })\r\n  }\r\n\r\n  findAndUpdate({ threadid, content })\r\n\r\n  return forumEl\r\n}\r\n\r\nfunction addThread({ forumEl, forumid }) {\r\n  forumid = Number(forumid)\r\n  forumid--\r\n\r\n  var now = new Date()\r\n  var timestamp = now.toISOString()\r\n\r\n  forumEl[forumid].threads.push({\r\n    meta: {},\r\n  })\r\n}\r\n\r\nfunction addReply({ forumEl, forumid = '1', threadid }) {}\r\n\r\nmodule.exports = {\r\n  addReply,\r\n  addThread,\r\n  updateThread,\r\n  // deleteThread,\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\r\n * @name WikiForum.core\r\n * @author 机智的小鱼君 <dragon-fish@qq.com>\r\n * @url https://github.com/Wjghj-Project/Gadget-WikiForum\r\n */\r\n'use strict'\r\n\r\nconst log = require('./module/log')\r\nconst { hook } = require('./module/mw')\r\n\r\nmw.loader.using(\r\n  ['mediawiki.api', 'mediawiki.util', 'mediawiki.user'],\r\n  function() {\r\n    // init global variable\r\n    const Core = {\r\n      parser: require('./module/parser'),\r\n      renderer: require('./module/renderer'),\r\n      updater: require('./module/updater'),\r\n    }\r\n\r\n    window.WikiForum = $.extend({}, window.WikiForum, Core)\r\n    hook('WikiForum').fire(Core)\r\n    log.log('Ready!')\r\n  }\r\n)\r\n"],"sourceRoot":""}