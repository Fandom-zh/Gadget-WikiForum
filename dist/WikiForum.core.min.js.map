{"version":3,"sources":["webpack://mediawiki-wikiforum/./module/actionGet.js","webpack://mediawiki-wikiforum/./module/log.js","webpack://mediawiki-wikiforum/./module/mw.js","webpack://mediawiki-wikiforum/./module/parser.js","webpack://mediawiki-wikiforum/./module/renderer.js","webpack://mediawiki-wikiforum/./module/updater.js","webpack://mediawiki-wikiforum/webpack/bootstrap","webpack://mediawiki-wikiforum/./index.js"],"names":["require","api","conf","module","exports","page","wgPageName","$","get","format","action","prop","log","data","console","info","error","warn","err","mw","util","wikiScript","config","editToken","user","tokens","hook","parseForums","code","title","$root","forums","hasClass","find","each","index","forum","push","id","String","meta","threads","parseThreads","prefix","$forum","$threads","getThreads","thread","threadObj","content","getContent","getMeta","length","html","fromApi","parse","wikitext","text","$wikitext","$html","Obj","window","WikiForum","cache","pages","fromHtml","actionGet","getThread","forumEl","forumid","threadid","Number","split","item","_","renderAllForums","theme","allForumsContainer","append","renderForum","_forum","ctx","forumContainer","newThreadArea","$textArea","class","$submitBtn","click","val","newThread","JSON","stringify","getNewThreadArea","$thread","firstThread","fn","newReplyArea","getNewReplyArea","normalThread","ctx1","$replyBtn","href","$modifyBtn","$deleteBtn","toPage","target","fire","toHtml","fromPage","then","addReply","addThread","Date","toISOString","updateThread","findAndUpdate","base","allThreads","userLast","wgUserName","timeModify","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","loader","using","Core","parser","renderer","updater","extend"],"mappings":"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","file":"WikiForum.core.min.js","sourcesContent":["const { api, conf } = require('./mw')\n\nmodule.exports = (page = conf.wgPageName) => {\n  return $.get(api, {\n    format: 'json',\n    action: 'parse',\n    prop: 'text|wikitext',\n    page,\n  })\n}\n","function log(...data) {\r\n  console.info('[WikiForum] [INFO]', ...data)\r\n}\r\n\r\nfunction warn(...data) {\r\n  console.warn('[WikiForum] [WARN]', ...data)\r\n}\r\n\r\nfunction error(...data) {\r\n  console.error('[WikiForum] [ERR]', ...data)\r\n}\r\n\r\nmodule.exports = {\r\n  log,\r\n  info: log,\r\n  warn,\r\n  error,\r\n  err: error,\r\n}\r\n","module.exports = {\r\n  api: mw.util.wikiScript('api'),\r\n  conf: mw.config.get(),\r\n  editToken: mw.user.tokens.get('editToken'),\r\n  hook: mw.hook,\r\n  util: mw.util,\r\n}\r\n","/**\r\n * @function parseForums 从源代码解析可能存在的全部主题\r\n * @param {Element} code\r\n * @param {String} title\r\n */\r\nfunction parseForums(code, title) {\r\n  var $root = $(code)\r\n  var forums = []\r\n\r\n  if (!$root.hasClass('wiki-forum')) {\r\n    $root = $root.find('.wiki-forum')\r\n  }\r\n  $root.each((index, forum) => {\r\n    forums.push({\r\n      id: String(index + 1),\r\n      meta: $(forum).data(),\r\n      threads: parseThreads(forum),\r\n    })\r\n  })\r\n  return forums\r\n}\r\n\r\n/**\r\n * @function parseThreads 递归全部的帖子\r\n * @param {Element} forum\r\n * @param {String} prefix\r\n */\r\nfunction parseThreads(forum, prefix = '') {\r\n  var $forum = $(forum)\r\n  if (prefix) prefix += '-'\r\n  var threads = []\r\n  $threads = getThreads($forum)\r\n  $.each($threads, (index, thread) => {\r\n    var threadObj = {\r\n      id: String(prefix + (index + 1)),\r\n      content: getContent(thread),\r\n      meta: getMeta(thread),\r\n    }\r\n    if (getThreads(thread).length > 0) {\r\n      threadObj.threads = parseThreads(thread, threadObj.id)\r\n    }\r\n    threads.push(threadObj)\r\n  })\r\n  return threads\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子可能存在的回复的结构\r\n * @param {Element} thread\r\n */\r\nfunction getThreads(thread) {\r\n  var $thread = $(thread)\r\n  return $thread.find('> .forum-thread')\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子内容\r\n * @param {Element} thread\r\n */\r\nfunction getContent(thread) {\r\n  var $thread = $(thread)\r\n  var $content = $thread.find('> .forum-content').html() || ''\r\n  return $content\r\n}\r\n\r\n/**\r\n * @function getMeta 获取帖子的源信息\r\n * @param {Element} thread\r\n */\r\nfunction getMeta(thread) {\r\n  var $thread = $(thread)\r\n  var $data = $thread.data()\r\n\r\n  return $data\r\n}\r\n\r\n/**\r\n * @function getUser 获取帖子发帖者信息\r\n * @param {Element} thread\r\n */\r\nfunction getUser(thread) {\r\n  var $thread = $(thread)\r\n  var author = $thread.data('userAuthor') || ''\r\n  var last = $thread.data('userLast') || author\r\n  return { author, last }\r\n}\r\n\r\n/**\r\n * @function getTime 获取帖子发帖时间信息\r\n * @param {Element} thread\r\n */\r\nfunction getTime(thread) {\r\n  var $thread = $(thread)\r\n  var publish = $thread.data('timePublish') || ''\r\n  var modify = $thread.data('timeModify') || publish\r\n  return { publish, modify }\r\n}\r\n\r\n/**\r\n * @module fromApi 解析 MediaWiki API 返回的信息\r\n * @param {Object} data 来自 API 的结果：api.php?action=parse&prop=wikitext|text&page=<pageName>\r\n */\r\nfunction fromApi(data) {\r\n  var title = data.parse.title\r\n  var wikitext = data.parse.wikitext['*']\r\n  var html = data.parse.text['*']\r\n\r\n  // 防止输出没有根元素\r\n  var $wikitext = $('<div>' + wikitext + '</div>')\r\n  var $html = $('<div>' + html + '</div>')\r\n\r\n  // 高版本输出自带根元素，低版本没有\r\n  if ($html.find('> .mw-parser-output').length > 0) {\r\n    $html = $html.find('> .mw-parser-output')\r\n  }\r\n\r\n  var Obj = {\r\n    wikitext: parseForums($wikitext, title),\r\n    html: parseForums($html, title),\r\n  }\r\n\r\n  // 缓存全部forum\r\n  window.WikiForum = window.WikiForum || {}\r\n  window.WikiForum.cache = window.WikiForum.cache || {}\r\n  window.WikiForum.cache.pages = window.WikiForum.cache.pages || {}\r\n  window.WikiForum.cache.pages[title] = Obj\r\n  return Obj\r\n}\r\n\r\n/**\r\n * @module fromHtml 从 HTML 源代码解析\r\n * @param {String|Element} code\r\n */\r\nfunction fromHtml(code, title = '') {\r\n  var $code = $(code)\r\n  return parseForums($code)\r\n}\r\n\r\nmodule.exports = {\r\n  fromApi,\r\n  fromHtml,\r\n}\r\n","const { fromApi } = require('./parser')\nconst actionGet = require('./actionGet')\nconst { util } = require('./mw')\nconst log = require('./log')\n\n// 获取帖子元素\nfunction getThread({ forumEl, forumid = '1', threadid }) {\n  // 将 id 调整为程序可读的 index\n  forumid = Number(forumid)\n  forumid--\n  var forum = forumEl[forumid]\n\n  threadid = threadid.split('-')\n  $.each(threadid, (index, item) => {\n    item = Number(item)\n    item--\n    threadid[index] = item\n  })\n\n  // 开始递归 threads\n  var thread = forum\n  $.each(threadid, (_, id) => {\n    log.log('thread', thread.threads[id])\n    thread = thread.threads[id]\n  })\n\n  return thread\n}\n\n// 获取帖子内容\nfunction getContent(ctx) {\n  var thread = getThread(ctx)\n  return thread.content\n}\n\n// 获取帖子元信息\nfunction getMeta(ctx) {\n  var thread = getThread(ctx)\n  return thread.meta\n}\n\n// 递归全部主题\nfunction renderAllForums({ forumEl, theme }) {\n  $root = theme.allForumsContainer()\n  $.each(forumEl, (index, forum) => {\n    $root.append(\n      renderForum({ _forum: forumEl, forumid: forum.id, forumEl: forum, theme })\n    )\n  })\n  return $root\n}\n\n// 渲染单个主题\nfunction renderForum(ctx, $root) {\n  var { _forum, forumEl, forumid, theme } = ctx\n  var threads = forumEl.threads\n  $root = $root || $(theme.forumContainer({ meta: forumEl.meta }))\n\n  var newThreadArea = getNewThreadArea({\n    forumEl: _forum,\n    forumid: _forum.meta.id,\n  })\n\n  $.each(threads, (index, item) => {\n    // 缓存帖子对象\n    var $thread\n\n    if (index === 0 && forumEl.title) {\n      // 楼主\n      $thread = theme.firstThread({\n        meta: item.meta,\n        content: item.content,\n        fn: {\n          newThreadArea,\n          newReplyArea: getNewReplyArea({\n            forumEl: _forum,\n            forumid,\n            threadid: item.id,\n          }),\n        },\n      })\n    } else {\n      // 一般楼层\n      $thread = theme.normalThread({\n        meta: item.meta,\n        content: item.content,\n        fn: {\n          newThreadArea,\n          newReplyArea: getNewReplyArea({\n            forumEl: _forum,\n            forumid,\n            threadid: item.id,\n          }),\n        },\n      })\n    }\n\n    // 如果有回复，处理回复\n    if (item.threads && item.threads.length > 0) {\n      var ctx1 = ctx\n      ctx1.forumEl = item\n      $thread.append(renderForum(ctx1, $thread))\n    }\n\n    $root.append($thread)\n  })\n\n  return $root\n}\n\n// 生成回复框\nfunction getNewReplyArea({ forumEl, forumid, threadid }) {\n  var $replyBtn = $('<a>', { text: '回复', href: 'javascript:;' })\n  var $modifyBtn = $('<a>', { text: '编辑', href: 'javascript:;' })\n  var $deleteBtn = $('<a>', { text: '删除', href: 'javascript:;' })\n  var $textArea = $('<textarea>', { class: 'forum-textarea' })\n  var $submitBtn = $('<button>', {\n    text: '提交',\n    class: 'forum-submit-btn',\n  })\n\n  var $container = $('<div>', {\n    class: 'forum-new-reply-area',\n    'data-debug': JSON.stringify({\n      forumid,\n      threadid,\n    }),\n  }).append(\n    $('<div>', { class: 'forum-modify-container' }).append(\n      $replyBtn,\n      $modifyBtn,\n      $deleteBtn\n    ),\n    $('<label>', { class: 'forum-input-container' }).append(\n      $('<div>').append($textArea),\n      $('<div>').append($submitBtn)\n    )\n  )\n\n  return $container\n}\n\n// 生成新楼框\nfunction getNewThreadArea({ forumEl, forumid }) {\n  var $textArea = $('<textarea>', { class: 'forum-textarea' })\n  var $submitBtn = $('<button>', {\n    text: '提交',\n    class: 'forum-submit-btn',\n  }).click(function() {\n    var content = $textArea.val()\n    if (!content) return\n    newThread({\n      forumEl,\n      forumid,\n      content,\n    })\n  })\n\n  var $container = $('<div>', {\n    class: 'forum-new-thread-area',\n    'data-debug': JSON.stringify({\n      forumid,\n    }),\n  }).append(\n    $('<label>', { class: 'forum-input-container' }).append(\n      $('<div>').append($textArea),\n      $('<div>').append($submitBtn)\n    )\n  )\n\n  return $container\n}\n\n// 从页面加载内容，并渲染到根元素\nfunction fromPage(page = util.wgPageName, target = '#mw-content-text') {\n  log.info('Strat to load page data', page)\n  actionGet(page).then(\n    data => {\n      log.info('Page data ready', page)\n      var obj = fromApi(data)\n      toPage(obj.html, target)\n    },\n    err => {\n      log.err('Failed to load page data', err)\n    }\n  )\n}\n\n// 渲染返回HTML对象\nfunction toHtml(forumEl) {\n  log.log('renderHTML')\n  mw.hook('WikiForum.theme').fire(theme => {\n    return renderAllForums({ forumEl, theme })\n  })\n}\n\n/**\n * @module toPage 从 WikiForum-Element 渲染到根元素\n * @param {Object} forumEl WikiForum-Element\n * @param {String|Element} target 渲染的根元素\n */\nfunction toPage(forumEl, target = '#mw-content-text') {\n  /**\n   * 触发主题函数\n   * @param {Object} ctx 传入的上下文\n   * @param {Functon} next 返回的主题渲染器\n   */\n  mw.hook('WikiForum.theme').fire(theme => {\n    $(target).html(renderAllForums({ forumEl, theme }))\n  })\n}\n\nmodule.exports = {\n  toPage,\n  toHtml,\n  fromPage,\n  getContent,\n  getMeta,\n}\n","const { conf } = require('./mw')\n\nfunction newThreadStruc({ meta, content }) {\n  // 将 fooBar 转换为 foo-bar 的形式\n  var meta1 = {}\n  $.each(meta, (key, val) => {\n    key = 'data-' + key.replace(/(.*)([A-Z])(.*)/g, '$1-$2$3').toLowerCase()\n    meta1[key] = val\n  })\n  meta = meta1\n\n  return $('<div>', { class: 'forum-thread' })\n    .attr(meta)\n    .append($('<div>', { class: 'forum-content', html: content }))\n}\n\nfunction hasThread(thread, id) {\n  var res = false\n  if (thread.id === id) ret = true\n  return res\n}\n\nfunction isComplex() {}\n\nfunction makeWikitext(obj) {}\n\nfunction updateThread({ forumEl, forumid = '1', threadid, content }) {\n  // 将 id 调整为程序可读的 index\n  forumid = Number(forumid)\n  forumid--\n  var forum = forumEl[forumid]\n\n  function findAndUpdate({ threadid, content }, base) {\n    base = base || forum\n    var allThreads = base.threads\n    $.each(allThreads, (index, item) => {\n      if (item.id === threadid) {\n        item.content = content\n        item.meta.userLast = conf.wgUserName\n        item.meta.timeModify = new Date().toISOString()\n      } else if (item.threads) {\n        findAndUpdate({ threadid, content }, item)\n      }\n    })\n  }\n\n  findAndUpdate({ threadid, content })\n\n  return forumEl\n}\n\nfunction addThread({ forumEl, forumid }) {\n  forumid = Number(forumid)\n  forumid--\n\n  var now = new Date()\n  var timestamp = now.toISOString()\n\n  forumEl[forumid].threads.push({\n    meta: {},\n  })\n}\n\nfunction addReply({ forumEl, forumid = '1', threadid }) {}\n\nmodule.exports = {\n  addReply,\n  addThread,\n  updateThread,\n  // deleteThread,\n}\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\r\n * @name WikiForum.core\r\n * @author 机智的小鱼君 <dragon-fish@qq.com>\r\n * @url https://github.com/Wjghj-Project/Gadget-WikiForum\r\n */\r\n'use strict'\r\n\r\nconst log = require('./module/log')\r\nconst { hook } = require('./module/mw')\r\n\r\nmw.loader.using(\r\n  ['mediawiki.api', 'mediawiki.util', 'mediawiki.user'],\r\n  function() {\r\n    // init global variable\r\n    const Core = {\r\n      parser: require('./module/parser'),\r\n      renderer: require('./module/renderer'),\r\n      updater: require('./module/updater'),\r\n    }\r\n\r\n    window.WikiForum = $.extend({}, window.WikiForum, Core)\r\n    hook('WikiForum').fire(Core)\r\n    log.log('Ready!')\r\n  }\r\n)\r\n"],"sourceRoot":""}