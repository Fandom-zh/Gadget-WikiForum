{"version":3,"sources":["webpack://mediawiki-wikiforum/./theme/default/default.js"],"names":["mw","hook","add","next","allForumsContainer","ctx","$","forumContainer","meta","id","threadContainer","String","content","timePublish","timeRelease","release","timeModify","userAuthor","user","userLast","$idLink","text","$userLink","append","href","util","getUrl","$content","html","$timeArea","dateFormat","Date","forumMeta","title","forumid","$replyArea","newReplyArea","click","e","show","hide","$textArea","$submitBtn","val","console","info","$container","newThreadArea","newForumContainer","noForumContainer","afterForum","afterAllForums","fmt","date","o","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","test","replace","RegExp","$1","getFullYear","substr","length","k"],"mappings":"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","file":"WikiForum.theme.default.js","sourcesContent":["/**\r\n * @function theme.default 标准的官方主题\r\n * @param {Object} ctx\r\n * @param {Object} ctx.meta Metadata\r\n *\r\n * @param {Function} next\r\n */\r\nmw.hook('WikiForum.theme').add(next => {\r\n  // 全论坛容器\r\n  var allForumsContainer = ctx => {\r\n    return $('<div>', { class: 'wiki-forum-all-container' })\r\n  }\r\n\r\n  // 单论坛容器\r\n  var forumContainer = ctx => {\r\n    return $('<div>', {\r\n      class: 'wiki-forum',\r\n      'data-forumid': ctx.meta.id,\r\n    })\r\n  }\r\n\r\n  // 帖子容器\r\n  var threadContainer = ctx => {\r\n    // 处理 meta\r\n    const id = String(ctx.id)\r\n    const content = ctx.content\r\n    const timePublish =\r\n      ctx.meta.timePublish || ctx.meta.timeRelease || ctx.meta.release || ''\r\n    const timeModify = ctx.meta.timeModify || timePublish\r\n    const userAuthor = ctx.meta.userAuthor || ctx.meta.user || 'unsigned'\r\n    const userLast = ctx.meta.userLast || userAuthor\r\n\r\n    // 缓存组件\r\n    var $idLink = $('<span>', { class: 'forum-id-link', text: '#' + id })\r\n    var $userLink = $('<div>', { class: 'forum-user' }).append(\r\n      $('<span>', { class: 'forum-user-link' }).append(\r\n        $('<a>', {\r\n          class: 'mw-userlink userAuthor',\r\n          text: userAuthor,\r\n          href: mw.util.getUrl('User:' + userAuthor),\r\n        }),\r\n        userLast === userAuthor\r\n          ? ''\r\n          : $('<i>', { text: '（修改者：' + userLast + '）' })\r\n      )\r\n    )\r\n    var $content = $('<div>', { class: 'forum-content', html: content })\r\n    var $timeArea = $('<div>', { class: 'post-time' }).append(\r\n      $('<i>', {\r\n        class: 'post-date timePublish',\r\n        text: dateFormat('yyyy年M月d日 hh:mm:ss', new Date(timePublish)),\r\n      })\r\n    )\r\n\r\n    // 判断是否为楼主，并返回帖子容器\r\n    if (id === '1') {\r\n      // 楼主\r\n      return $('<div>', {\r\n        class: 'forum-thread forum-first',\r\n      }).append(\r\n        $('<div>', { class: 'forum-before' }).append(\r\n          $('<h3>', {\r\n            class: 'forum-title',\r\n            text: ctx.forumMeta.title || '[UNTITLED] Forum Topic #' + forumid,\r\n          }),\r\n          $idLink,\r\n          $userLink\r\n        ),\r\n        $content,\r\n        $('<div>', { class: 'forum-after' }).append($timeArea)\r\n      )\r\n    } else {\r\n      // 普通帖子\r\n      var $replyArea = newReplyArea()\r\n\r\n      return $('<div>', { class: 'forum-thread' }).append(\r\n        $('<div>', { class: 'forum-before' }).append($idLink, $userLink),\r\n        $content,\r\n        $('<div>', { class: 'forum-after' }).append(\r\n          $timeArea,\r\n          $('<div>', { class: 'new-reply-container' }).append(\r\n            $('<div>', { class: 'modify-buttons-group' }).append(\r\n              $('<a>', {\r\n                class: 'reply-btn',\r\n                href: 'javascript:;',\r\n                text: '回复',\r\n              }).click(function(e) {\r\n                $replyArea.show()\r\n                $(this).hide()\r\n              })\r\n            ),\r\n            $replyArea\r\n          )\r\n        )\r\n      )\r\n    }\r\n  }\r\n\r\n  // 新回复容器\r\n  var newReplyArea = ctx => {\r\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\r\n    var $submitBtn = $('<button>', {\r\n      text: '回复',\r\n      class: 'forum-submit-btn',\r\n    }).click(function() {\r\n      var content = $textArea.val()\r\n      if (!content) return\r\n      console.info('New reply', content)\r\n    })\r\n\r\n    var $container = $('<div>', {\r\n      class: 'forum-new-reply-area',\r\n    }).append(\r\n      $('<label>', { class: 'forum-input-container' }).append(\r\n        $('<div>').append($textArea),\r\n        $('<div>').append($submitBtn)\r\n      )\r\n    )\r\n\r\n    return $container\r\n  }\r\n\r\n  // 新帖子容器\r\n  var newThreadArea = ctx => {\r\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\r\n    var $submitBtn = $('<button>', {\r\n      text: '发送',\r\n      class: 'forum-submit-btn',\r\n    }).click(function() {\r\n      var content = $textArea.val()\r\n      if (!content) return\r\n      console.info('New thread', content)\r\n    })\r\n\r\n    var $container = $('<div>', {\r\n      class: 'forum-new-thread-area',\r\n    }).append(\r\n      $('<label>', { class: 'forum-input-container' }).append(\r\n        $('<div>').append($textArea),\r\n        $('<div>').append($submitBtn)\r\n      )\r\n    )\r\n\r\n    return $container\r\n  }\r\n\r\n  // 新论坛容器\r\n  var newForumContainer = ctx => {\r\n    return $('<div>').append($('<p>', { text: 'newForumContainer' }))\r\n  }\r\n\r\n  // 无论坛容器\r\n  var noForumContainer = ctx => {}\r\n\r\n  var afterForum = ctx => {\r\n    return $('<div>', { class: 'forum-thread forum-add-thread' }).append(\r\n      newThreadArea(ctx)\r\n    )\r\n  }\r\n\r\n  var afterAllForums = ctx => {\r\n    return newForumContainer(ctx)\r\n  }\r\n\r\n  // @function dateFormat\r\n  function dateFormat(fmt, date) {\r\n    date = date || new Date()\r\n    var o = {\r\n      'M+': date.getMonth() + 1, //月份\r\n      'd+': date.getDate(), //日\r\n      'h+': date.getHours(), //小时\r\n      'm+': date.getMinutes(), //分\r\n      's+': date.getSeconds(), //秒\r\n      'q+': Math.floor((date.getMonth() + 3) / 3), //季度\r\n      S: date.getMilliseconds(), //毫秒\r\n    }\r\n    if (/(y+)/.test(fmt)) {\r\n      fmt = fmt.replace(\r\n        RegExp.$1,\r\n        (date.getFullYear() + '').substr(4 - RegExp.$1.length)\r\n      )\r\n    }\r\n    for (var k in o)\r\n      if (new RegExp('(' + k + ')').test(fmt)) {\r\n        fmt = fmt.replace(\r\n          RegExp.$1,\r\n          RegExp.$1.length == 1\r\n            ? o[k]\r\n            : ('00' + o[k]).substr(('' + o[k]).length)\r\n        )\r\n      }\r\n    return fmt\r\n  }\r\n\r\n  next &&\r\n    next({\r\n      allForumsContainer,\r\n      forumContainer,\r\n      threadContainer,\r\n      afterAllForums,\r\n      afterForum,\r\n      noForumContainer,\r\n    })\r\n})\r\n"],"sourceRoot":""}