{"version":3,"sources":["webpack://mediawiki-wikiforum/./theme/default/default.js"],"names":["mw","hook","add","next","dateFormat","fmt","date","o","Date","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","k","test","replace","RegExp","$1","getFullYear","substr","length","allForumsContainer","ctx","$","class","forumContainer","meta","id","threadContainer","String","content","timePublish","timeRelease","release","userAuthor","timeModify","user","userLast","$idLink","text","$userLink","append","href","util","getUrl","$content","html","$timeArea","forumMeta","title","forumid","$textArea","$submitBtn","$replyArea","click","val","console","info","e","show","this","hide","afterAllForums","afterForum","noForumContainer"],"mappings":"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","file":"WikiForum.theme.default.min.js","sourcesContent":["/**\r\n * @function theme.default 标准的官方主题\r\n * @param {Object} ctx\r\n * @param {Object} ctx.meta Metadata\r\n *\r\n * @param {Function} next\r\n */\r\nmw.hook('WikiForum.theme').add(next => {\r\n  // 全论坛容器\r\n  var allForumsContainer = ctx => {\r\n    return $('<div>', { class: 'wiki-forum-all-container' })\r\n  }\r\n\r\n  // 单论坛容器\r\n  var forumContainer = ctx => {\r\n    return $('<div>', {\r\n      class: 'wiki-forum',\r\n      'data-forumid': ctx.meta.id,\r\n    })\r\n  }\r\n\r\n  // 帖子容器\r\n  var threadContainer = ctx => {\r\n    // 处理 meta\r\n    const id = String(ctx.id)\r\n    const content = ctx.content\r\n    const timePublish =\r\n      ctx.meta.timePublish || ctx.meta.timeRelease || ctx.meta.release || ''\r\n    const timeModify = ctx.meta.timeModify || timePublish\r\n    const userAuthor = ctx.meta.userAuthor || ctx.meta.user || 'unsigned'\r\n    const userLast = ctx.meta.userLast || userAuthor\r\n\r\n    // 缓存组件\r\n    var $idLink = $('<span>', { class: 'forum-id-link', text: '#' + id })\r\n    var $userLink = $('<div>', { class: 'forum-user' }).append(\r\n      $('<span>', { class: 'forum-user-link' }).append(\r\n        $('<a>', {\r\n          class: 'mw-userlink userAuthor',\r\n          text: userAuthor,\r\n          href: mw.util.getUrl('User:' + userAuthor),\r\n        }),\r\n        userLast === userAuthor\r\n          ? ''\r\n          : $('<i>', { text: '（修改者：' + userLast + '）' })\r\n      )\r\n    )\r\n    var $content = $('<div>', { class: 'forum-content', html: content })\r\n    var $timeArea = $('<div>', { class: 'post-time' }).append(\r\n      $('<i>', {\r\n        class: 'post-date timePublish',\r\n        text: dateFormat('yyyy年M月d日 hh:mm:ss', new Date(timePublish)),\r\n      })\r\n    )\r\n\r\n    // 判断是否为楼主，并返回帖子容器\r\n    if (id === '1') {\r\n      // 楼主\r\n      return $('<div>', {\r\n        class: 'forum-thread forum-first',\r\n      }).append(\r\n        $('<div>', { class: 'forum-before' }).append(\r\n          $('<h3>', {\r\n            class: 'forum-title',\r\n            text: ctx.forumMeta.title || '[UNTITLED] Forum Topic #' + forumid,\r\n          }),\r\n          $idLink,\r\n          $userLink\r\n        ),\r\n        $content,\r\n        $('<div>', { class: 'forum-after' }).append($timeArea)\r\n      )\r\n    } else {\r\n      // 普通帖子\r\n      var $replyArea = newReplyArea()\r\n\r\n      return $('<div>', { class: 'forum-thread' }).append(\r\n        $('<div>', { class: 'forum-before' }).append($idLink, $userLink),\r\n        $content,\r\n        $('<div>', { class: 'forum-after' }).append(\r\n          $timeArea,\r\n          $('<div>', { class: 'new-reply-container' }).append(\r\n            $('<div>', { class: 'modify-buttons-group' }).append(\r\n              $('<a>', {\r\n                class: 'reply-btn',\r\n                href: 'javascript:;',\r\n                text: '回复',\r\n              }).click(function(e) {\r\n                $replyArea.show()\r\n                $(this).hide()\r\n              })\r\n            ),\r\n            $replyArea\r\n          )\r\n        )\r\n      )\r\n    }\r\n  }\r\n\r\n  // 新回复容器\r\n  var newReplyArea = ctx => {\r\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\r\n    var $submitBtn = $('<button>', {\r\n      text: '回复',\r\n      class: 'forum-submit-btn',\r\n    }).click(function() {\r\n      var content = $textArea.val()\r\n      if (!content) return\r\n      console.info('New reply', content)\r\n    })\r\n\r\n    var $container = $('<div>', {\r\n      class: 'forum-new-reply-area',\r\n    }).append(\r\n      $('<label>', { class: 'forum-input-container' }).append(\r\n        $('<div>').append($textArea),\r\n        $('<div>').append($submitBtn)\r\n      )\r\n    )\r\n\r\n    return $container\r\n  }\r\n\r\n  // 新帖子容器\r\n  var newThreadArea = ctx => {\r\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\r\n    var $submitBtn = $('<button>', {\r\n      text: '发送',\r\n      class: 'forum-submit-btn',\r\n    }).click(function() {\r\n      var content = $textArea.val()\r\n      if (!content) return\r\n      console.info('New thread', content)\r\n    })\r\n\r\n    var $container = $('<div>', {\r\n      class: 'forum-new-thread-area',\r\n    }).append(\r\n      $('<label>', { class: 'forum-input-container' }).append(\r\n        $('<div>').append($textArea),\r\n        $('<div>').append($submitBtn)\r\n      )\r\n    )\r\n\r\n    return $container\r\n  }\r\n\r\n  // 新论坛容器\r\n  var newForumContainer = ctx => {\r\n    return $('<div>').append($('<p>', { text: 'newForumContainer' }))\r\n  }\r\n\r\n  // 无论坛容器\r\n  var noForumContainer = ctx => {}\r\n\r\n  var afterForum = ctx => {\r\n    return $('<div>', { class: 'forum-thread forum-add-thread' }).append(\r\n      newThreadArea(ctx)\r\n    )\r\n  }\r\n\r\n  var afterAllForums = ctx => {\r\n    return newForumContainer(ctx)\r\n  }\r\n\r\n  // @function dateFormat\r\n  function dateFormat(fmt, date) {\r\n    date = date || new Date()\r\n    var o = {\r\n      'M+': date.getMonth() + 1, //月份\r\n      'd+': date.getDate(), //日\r\n      'h+': date.getHours(), //小时\r\n      'm+': date.getMinutes(), //分\r\n      's+': date.getSeconds(), //秒\r\n      'q+': Math.floor((date.getMonth() + 3) / 3), //季度\r\n      S: date.getMilliseconds(), //毫秒\r\n    }\r\n    if (/(y+)/.test(fmt)) {\r\n      fmt = fmt.replace(\r\n        RegExp.$1,\r\n        (date.getFullYear() + '').substr(4 - RegExp.$1.length)\r\n      )\r\n    }\r\n    for (var k in o)\r\n      if (new RegExp('(' + k + ')').test(fmt)) {\r\n        fmt = fmt.replace(\r\n          RegExp.$1,\r\n          RegExp.$1.length == 1\r\n            ? o[k]\r\n            : ('00' + o[k]).substr(('' + o[k]).length)\r\n        )\r\n      }\r\n    return fmt\r\n  }\r\n\r\n  next &&\r\n    next({\r\n      allForumsContainer,\r\n      forumContainer,\r\n      threadContainer,\r\n      afterAllForums,\r\n      afterForum,\r\n      noForumContainer,\r\n    })\r\n})\r\n"],"sourceRoot":""}