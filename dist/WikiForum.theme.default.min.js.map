{"version":3,"sources":["webpack://mediawiki-wikiforum/./theme/default.js"],"names":["mw","hook","add","next","newReplyArea","ctx","$container","$","class","$textArea","$submitBtn","text","click","content","val","addClass","forumEl","forumid","threadid","fn","updater","addReply","append","dateFormat","fmt","date","o","Date","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","k","test","replace","RegExp","$1","getFullYear","substr","length","allForumsContainer","forumContainer","meta","id","threadContainer","timePublish","timeRelease","release","userAuthor","timeModify","user","userLast","htmlId","$idLink","href","e","preventDefault","window","history","pushState","location","split","$block","animate","scrollTop","offset","top","$userLink","util","getUrl","$content","html","$timeArea","forumMeta","title","_forum","$replyArea","show","this","hide","afterAllForums","afterForum","addThread","newThreadArea","noForumContainer","handleLoading","container","WikiForumDefaultThemeStyle","loader","load"],"mappings":"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","file":"WikiForum.theme.default.min.js","sourcesContent":["/**\n * @function theme.default 标准的官方主题\n * @param {Object} ctx\n * @param {Object} ctx.meta Metadata\n *\n * @param {Function} next\n */\nmw.hook('WikiForum.theme').add(next => {\n  // 全论坛容器\n  var allForumsContainer = ctx => {\n    return $('<div>', { class: 'wiki-forum-all-container' })\n  }\n\n  // 单论坛容器\n  var forumContainer = ctx => {\n    return $('<div>', {\n      class: 'wiki-forum',\n      'data-forumid': ctx.meta.id,\n    })\n  }\n\n  // 帖子容器\n  var threadContainer = ctx => {\n    // 处理 meta\n    const { forumid, threadid, content } = ctx\n    const timePublish =\n      ctx.meta.timePublish || ctx.meta.timeRelease || ctx.meta.release || ''\n    const timeModify = ctx.meta.timeModify || timePublish\n    const userAuthor = ctx.meta.userAuthor || ctx.meta.user || 'unsigned'\n    const userLast = ctx.meta.userLast || userAuthor\n    const htmlId = `forum-${forumid}_thread-${threadid}`\n\n    // 缓存组件\n    var $idLink = $('<a>', {\n      class: 'forum-id-link',\n      text: '#' + threadid,\n      href: `#${htmlId}`,\n    }).click(function(e) {\n      e.preventDefault()\n      window.history.pushState(\n        null,\n        null,\n        window.location.href.split('#')[0] + '#' + htmlId\n      )\n      const $block = $('#' + htmlId)\n      $('html,body').animate({ scrollTop: $block.offset().top - 100 }, 500)\n    })\n    var $userLink = $('<div>', { class: 'forum-user' }).append(\n      $('<span>', { class: 'forum-user-link' }).append(\n        $('<a>', {\n          class: 'mw-userlink userAuthor',\n          text: userAuthor,\n          href: mw.util.getUrl('User:' + userAuthor),\n        }),\n        userLast === userAuthor\n          ? ''\n          : $('<i>', { text: '（修改者：' + userLast + '）' })\n      )\n    )\n    var $content = $('<div>', { class: 'forum-content', html: content })\n    var $timeArea = $('<div>', { class: 'post-time' }).append(\n      $('<i>', {\n        class: 'post-date timePublish',\n        text: dateFormat('yyyy年M月d日 hh:mm:ss', new Date(timePublish)),\n      })\n    )\n\n    // 判断是否为楼主，并返回帖子容器\n    if (threadid === '1') {\n      // 楼主\n      return $('<div>', {\n        id: htmlId,\n        class: 'forum-thread forum-first',\n      }).append(\n        $('<div>', { class: 'forum-before' }).append(\n          $('<h3>', {\n            class: 'forum-title',\n            text: ctx.forumMeta.title || '[UNTITLED] Forum Topic #' + forumid,\n          }),\n          $idLink,\n          $userLink\n        ),\n        $content,\n        $('<div>', { class: 'forum-after' }).append($timeArea)\n      )\n    } else {\n      // 普通帖子\n      const { forumid, _forum, fn } = ctx\n      var $replyArea = newReplyArea({\n        forumEl: _forum,\n        forumid,\n        threadid,\n        fn,\n      })\n\n      return $('<div>', { class: 'forum-thread', id: htmlId }).append(\n        $('<div>', { class: 'forum-before' }).append($idLink, $userLink),\n        $content,\n        $('<div>', { class: 'forum-after' }).append(\n          $timeArea,\n          $('<div>', { class: 'new-reply-container' }).append(\n            $('<div>', { class: 'modify-buttons-group' }).append(\n              $('<a>', {\n                class: 'reply-btn',\n                href: 'javascript:;',\n                text: '回复',\n              }).click(function(e) {\n                $replyArea.show()\n                $(this).hide()\n              })\n            ),\n            $replyArea\n          )\n        )\n      )\n    }\n  }\n\n  // 新回复容器\n  var newReplyArea = ctx => {\n    var $container = $('<div>', {\n      class: 'forum-new-reply-area',\n    })\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\n    var $submitBtn = $('<button>', {\n      text: '回复',\n      class: 'forum-submit-btn',\n    }).click(function() {\n      var content = $textArea.val()\n      if (!content) return\n\n      $container.addClass('forum-loading')\n      const { forumEl, forumid, threadid } = ctx\n      ctx.fn.updater.addReply({\n        forumEl,\n        content,\n        forumid,\n        threadid,\n      })\n    })\n\n    $container.append(\n      $('<label>', { class: 'forum-input-container' }).append(\n        $('<div>').append($textArea),\n        $('<div>').append($submitBtn)\n      )\n    )\n\n    return $container\n  }\n\n  // 新帖子容器\n  var newThreadArea = ctx => {\n    const { _forum, forumid } = ctx\n\n    var $container = $('<div>', {\n      class: 'forum-new-thread-area',\n    })\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\n    var $submitBtn = $('<button>', {\n      text: '发送',\n      class: 'forum-submit-btn',\n    }).click(function() {\n      var content = $textArea.val()\n      if (!content) return\n\n      $container.addClass('forum-loading')\n      ctx.fn.updater.addThread({\n        forumEl: _forum,\n        forumid,\n        content,\n      })\n    })\n\n    $container.append(\n      $('<strong>', { text: '回复楼主' }),\n      $('<label>', { class: 'forum-input-container' }).append(\n        $('<div>').append($textArea),\n        $('<div>').append($submitBtn)\n      )\n    )\n\n    return $container\n  }\n\n  // 新论坛容器\n  var newForumContainer = ctx => {\n    return $('<div>').append($('<p>', { text: 'newForumContainer' }))\n  }\n\n  // 无论坛容器\n  var noForumContainer = ctx => {}\n\n  var afterForum = ctx => {\n    return $('<div>', { class: 'forum-thread forum-add-thread' }).append(\n      newThreadArea(ctx)\n    )\n  }\n\n  var afterAllForums = ctx => {\n    return newForumContainer(ctx)\n  }\n\n  var handleLoading = container => {\n    $(container).addClass('forum-loading')\n  }\n\n  // @function dateFormat\n  function dateFormat(fmt, date) {\n    date = date || new Date()\n    var o = {\n      'M+': date.getMonth() + 1, //月份\n      'd+': date.getDate(), //日\n      'h+': date.getHours(), //小时\n      'm+': date.getMinutes(), //分\n      's+': date.getSeconds(), //秒\n      'q+': Math.floor((date.getMonth() + 3) / 3), //季度\n      S: date.getMilliseconds(), //毫秒\n    }\n    if (/(y+)/.test(fmt)) {\n      fmt = fmt.replace(\n        RegExp.$1,\n        (date.getFullYear() + '').substr(4 - RegExp.$1.length)\n      )\n    }\n    for (var k in o)\n      if (new RegExp('(' + k + ')').test(fmt)) {\n        fmt = fmt.replace(\n          RegExp.$1,\n          RegExp.$1.length == 1\n            ? o[k]\n            : ('00' + o[k]).substr(('' + o[k]).length)\n        )\n      }\n    return fmt\n  }\n\n  next &&\n    next({\n      allForumsContainer,\n      forumContainer,\n      threadContainer,\n      afterAllForums,\n      afterForum,\n      noForumContainer,\n      handleLoading,\n    })\n})\n\n// Import style\nif (window.WikiForumDefaultThemeStyle !== false) {\n  mw.loader.load(\n    'https://proj.wjghj.cn/Gadget-WikiForum/dist/WikiForum.theme.default.css',\n    'text/css'\n  )\n}\n"],"sourceRoot":""}