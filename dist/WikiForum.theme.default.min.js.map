{"version":3,"sources":["webpack://mediawiki-wikiforum/./theme/default.js"],"names":["$","extend","loadStyle","adminGroup","adminUser","depthMax","enableNewForum","enableModify","enableDelete","window","WikiForumDefaultTheme","mw","loader","load","hook","add","next","_msg","i","conf","config","get","newReplyArea","ctx","$root","forumEl","forumid","threadid","$container","class","$textArea","$submitBtn","text","click","content","val","addClass","fn","updater","addReply","append","reactionContainer","_forum","meta","likeList","reactionLike","likeTotal","split","length","isLike","includes","wgUserName","$likeBtn","href","title","index","indexOf","splice","push","sort","join","updateThread","dateFormat","fmt","date","o","Date","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","k","test","replace","RegExp","$1","getFullYear","substr","allForumsContainer","forumContainer","id","threadContainer","timePublish","timeRelease","release","userAuthor","timeModify","user","userLast","htmlId","$idLink","e","preventDefault","history","pushState","$block","animate","scrollTop","offset","top","$userLink","util","getUrl","$content","html","$timeArea","forumMeta","$replyArea","show","this","hide","afterAllForums","afterForum","addThread","newThreadArea","noForumContainer"],"mappings":"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","file":"WikiForum.theme.default.min.js","sourcesContent":["// Theme settings\nconst settings = $.extend(\n  {},\n  {\n    loadStyle: true,\n    adminGroup: ['sysop'],\n    adminUser: [],\n    depthMax: 3,\n    enableNewForum: false,\n    enableModify: true,\n    enableDelete: true,\n  },\n  window.WikiForumDefaultTheme\n)\n\n// Import style\nif (settings.loadStyle !== false) {\n  mw.loader.load(\n    'https://proj.wjghj.cn/Gadget-WikiForum/dist/WikiForum.theme.default.css',\n    'text/css'\n  )\n}\n\n/**\n * @function theme.default 标准的官方主题\n * @param {Object} ctx\n * @param {Object} ctx.meta Metadata\n *\n * @param {Function} next\n */\nmw.hook('WikiForum.theme').add(next => {\n  // function _msg(...params) {\n  //   return i18n.msg(...params).parse()\n  // }\n  function _msg(i) {\n    const list = {\n      'add-thread-label': '回复楼主',\n      'date-format': 'yyyy年M月d日 hh:mm:ss',\n      'reaction-like-add': '给这个帖子点赞',\n      'reaction-like-remove': '取消点赞这个帖子',\n      'reaction-like-total': '有$1名用户赞了这个帖子',\n      'reply-btn': '回复',\n      'submit-btn': '发送',\n      'user-last': '修改者',\n    }\n    return list[i] || `{WikiForum-${i}}`\n  }\n\n  const conf = mw.config.get()\n\n  // 全论坛容器\n  var allForumsContainer = ctx => {\n    return $('<div>', { class: 'wiki-forum-all-container' })\n  }\n\n  // 单论坛容器\n  var forumContainer = ctx => {\n    return $('<div>', {\n      class: 'wiki-forum',\n      'data-forumid': ctx.meta.id,\n    })\n  }\n\n  // 帖子容器\n  var threadContainer = ctx => {\n    // 处理 meta\n    const { forumid, threadid, content } = ctx\n    const timePublish =\n      ctx.meta.timePublish || ctx.meta.timeRelease || ctx.meta.release || ''\n    const timeModify = ctx.meta.timeModify || timePublish\n    const userAuthor = ctx.meta.userAuthor || ctx.meta.user || 'unsigned'\n    const userLast = ctx.meta.userLast || userAuthor\n    const htmlId = `forum-${forumid}_thread-${threadid}`\n\n    // 缓存组件\n    var $idLink = $('<a>', {\n      class: 'forum-id-link',\n      text: '#' + threadid,\n      href: `#${htmlId}`,\n    }).click(function (e) {\n      e.preventDefault()\n      window.history.pushState(null, null, '#' + htmlId)\n      const $block = $('#' + htmlId)\n      $('html,body').animate({ scrollTop: $block.offset().top - 100 }, 500)\n    })\n    var $userLink = $('<div>', { class: 'forum-user' }).append(\n      $('<span>', { class: 'forum-user-link' }).append(\n        $('<a>', {\n          class: 'mw-userlink userAuthor',\n          text: userAuthor,\n          href: mw.util.getUrl('User:' + userAuthor),\n        }),\n        userLast === userAuthor\n          ? ''\n          : $('<i>', { text: ` (${_msg('user-last')}: ${userLast})` })\n      )\n    )\n    var $content = $('<div>', { class: 'forum-content', html: content })\n    var $timeArea = $('<div>', { class: 'post-time' }).append(\n      $('<i>', {\n        class: 'post-date timePublish',\n        text: dateFormat(_msg('date-format'), new Date(timePublish)),\n      })\n    )\n\n    // 判断是否为楼主，并返回帖子容器\n    if (threadid === '1') {\n      // 楼主\n      return $('<div>', {\n        id: htmlId,\n        class: 'forum-thread forum-first',\n      }).append(\n        $('<div>', { class: 'forum-before' }).append(\n          $('<h3>', {\n            class: 'forum-title',\n            text: ctx.forumMeta.title || '[UNTITLED] Forum Topic #' + forumid,\n          }),\n          $idLink,\n          $userLink\n        ),\n        $content,\n        $('<div>', { class: 'forum-after' }).append(\n          $timeArea,\n          reactionContainer(ctx)\n        )\n      )\n    } else {\n      // 普通帖子\n      const { $root, $container, forumid, _forum, fn } = ctx\n      var $replyArea = newReplyArea({\n        $root,\n        $container,\n        forumEl: _forum,\n        forumid,\n        threadid,\n        fn,\n      })\n\n      return $('<div>', { class: 'forum-thread', id: htmlId }).append(\n        $('<div>', { class: 'forum-before' }).append($idLink, $userLink),\n        $content,\n        $('<div>', { class: 'forum-after' }).append(\n          $timeArea,\n          $('<div>', { class: 'new-reply-container' }).append(\n            $('<div>', { class: 'modify-buttons-group' }).append(\n              $('<a>', {\n                class: 'reply-btn',\n                href: 'javascript:;',\n                text: _msg('reply-btn'),\n              }).click(function (e) {\n                $replyArea.show()\n                $(this).hide()\n              })\n            ),\n            $replyArea\n          ),\n          reactionContainer(ctx)\n        )\n      )\n    }\n  }\n\n  // 新回复容器\n  var newReplyArea = ctx => {\n    const { $root, forumEl, forumid, threadid } = ctx\n\n    var $container = $('<div>', {\n      class: 'forum-new-reply-area',\n    })\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\n    var $submitBtn = $('<button>', {\n      text: _msg('reply-btn'),\n      class: 'forum-submit-btn',\n    }).click(function () {\n      var content = $textArea.val()\n      if (!content) return\n\n      $container.addClass('forum-loading')\n      ctx.fn.updater.addReply({\n        $root,\n        forumEl,\n        content,\n        forumid,\n        threadid,\n      })\n    })\n\n    $container.append(\n      $('<label>', { class: 'forum-input-container' }).append(\n        $('<div>').append($textArea),\n        $('<div>').append($submitBtn)\n      )\n    )\n\n    return $container\n  }\n\n  // 新帖子容器\n  var newThreadArea = ctx => {\n    const { $root, _forum, forumid } = ctx\n\n    var $container = $('<div>', {\n      class: 'forum-new-thread-area',\n    })\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\n    var $submitBtn = $('<button>', {\n      text: _msg('submit-btn'),\n      class: 'forum-submit-btn',\n    }).click(function () {\n      var content = $textArea.val()\n      if (!content) return\n\n      $container.addClass('forum-loading')\n      ctx.fn.updater.addThread({ $root, forumEl: _forum, forumid, content })\n    })\n\n    $container.append(\n      $('<strong>', { text: _msg('add-thread-label') }),\n      $('<label>', { class: 'forum-input-container' }).append(\n        $('<div>').append($textArea),\n        $('<div>').append($submitBtn)\n      )\n    )\n\n    return $container\n  }\n\n  // 点赞容器\n  var reactionContainer = ctx => {\n    const { _forum, forumid, threadid, meta, fn } = ctx\n\n    const $container = $('<div>', { class: 'forum-reaction' })\n\n    // Like btn\n    let likeList = meta.reactionLike || ''\n    if (likeList) {\n      likeList = likeList.split('|')\n    } else {\n      likeList = []\n    }\n    let likeTotal = likeList.length\n    let isLike = likeList.includes(conf.wgUserName)\n\n    $likeBtn = $('<a>', {\n      href: 'javascript:;',\n      class: 'reaction-like',\n      text: `👍(${likeTotal})`,\n      title: isLike ? _msg('reaction-like-remove') : _msg('reaction-like-add'),\n    })\n      .addClass(isLike ? 'is-like' : 'not-like')\n      .click(function () {\n        $container.addClass('forum-loading')\n        if (isLike) {\n          let index = likeList.indexOf(conf.wgUserName)\n          if (index > -1) likeList.splice(index, 1)\n        } else {\n          likeList.push(conf.wgUserName)\n        }\n        likeList.sort()\n        likeList = likeList.join('|')\n        fn.updater.updateThread({\n          forumEl: _forum,\n          forumid,\n          threadid,\n          meta: { reactionLike: likeList },\n        })\n      })\n\n    $container.append($likeBtn)\n\n    return $container\n  }\n\n  // 新论坛容器\n  var newForumContainer = ctx => {\n    return $('<div>').append($('<p>', { text: 'newForumContainer' }))\n  }\n\n  // 无论坛容器\n  var noForumContainer = ctx => {}\n\n  var afterForum = ctx => {\n    return $('<div>', { class: 'forum-thread forum-add-thread' }).append(\n      newThreadArea(ctx)\n    )\n  }\n\n  var afterAllForums = ctx => {\n    return $('<div>', { class: 'after-all-forums' }).append(\n      newForumContainer(ctx)\n    )\n  }\n\n  // @function dateFormat\n  function dateFormat(fmt, date) {\n    date = date || new Date()\n    var o = {\n      'M+': date.getMonth() + 1, //月份\n      'd+': date.getDate(), //日\n      'h+': date.getHours(), //小时\n      'm+': date.getMinutes(), //分\n      's+': date.getSeconds(), //秒\n      'q+': Math.floor((date.getMonth() + 3) / 3), //季度\n      S: date.getMilliseconds(), //毫秒\n    }\n    if (/(y+)/.test(fmt)) {\n      fmt = fmt.replace(\n        RegExp.$1,\n        (date.getFullYear() + '').substr(4 - RegExp.$1.length)\n      )\n    }\n    for (var k in o)\n      if (new RegExp('(' + k + ')').test(fmt)) {\n        fmt = fmt.replace(\n          RegExp.$1,\n          RegExp.$1.length == 1\n            ? o[k]\n            : ('00' + o[k]).substr(('' + o[k]).length)\n        )\n      }\n    return fmt\n  }\n\n  next &&\n    next({\n      allForumsContainer,\n      forumContainer,\n      threadContainer,\n      afterAllForums,\n      afterForum,\n      noForumContainer,\n    })\n})\n"],"sourceRoot":""}