{"version":3,"sources":["webpack://mediawiki-wikiforum/./module/mw.js","webpack://mediawiki-wikiforum/webpack/bootstrap","webpack://mediawiki-wikiforum/./theme/default.js"],"names":["module","exports","api","mw","util","wikiScript","conf","config","get","editToken","user","tokens","hook","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","require","add","next","newReplyArea","ctx","$textArea","$","class","$submitBtn","text","click","content","val","console","info","append","dateFormat","fmt","date","o","Date","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","k","test","replace","RegExp","$1","getFullYear","substr","length","allForumsContainer","forumContainer","meta","id","threadContainer","String","timePublish","timeRelease","release","userAuthor","timeModify","userLast","$idLink","$userLink","href","getUrl","$content","html","$timeArea","forumMeta","title","forumid","$replyArea","e","show","this","hide","afterAllForums","afterForum","noForumContainer","loader","load"],"mappings":"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","file":"WikiForum.theme.default.min.js","sourcesContent":["module.exports = {\r\n  api: mw.util.wikiScript('api'),\r\n  conf: mw.config.get(),\r\n  editToken: mw.user.tokens.get('editToken'),\r\n  hook: mw.hook,\r\n  util: mw.util,\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const mw = require(\"../module/mw\")\n\n/**\n * @function theme.default 标准的官方主题\n * @param {Object} ctx\n * @param {Object} ctx.meta Metadata\n *\n * @param {Function} next\n */\nmw.hook('WikiForum.theme').add(next => {\n  // 全论坛容器\n  var allForumsContainer = ctx => {\n    return $('<div>', { class: 'wiki-forum-all-container' })\n  }\n\n  // 单论坛容器\n  var forumContainer = ctx => {\n    return $('<div>', {\n      class: 'wiki-forum',\n      'data-forumid': ctx.meta.id,\n    })\n  }\n\n  // 帖子容器\n  var threadContainer = ctx => {\n    // 处理 meta\n    const id = String(ctx.id)\n    const content = ctx.content\n    const timePublish =\n      ctx.meta.timePublish || ctx.meta.timeRelease || ctx.meta.release || ''\n    const timeModify = ctx.meta.timeModify || timePublish\n    const userAuthor = ctx.meta.userAuthor || ctx.meta.user || 'unsigned'\n    const userLast = ctx.meta.userLast || userAuthor\n\n    // 缓存组件\n    var $idLink = $('<span>', { class: 'forum-id-link', text: '#' + id })\n    var $userLink = $('<div>', { class: 'forum-user' }).append(\n      $('<span>', { class: 'forum-user-link' }).append(\n        $('<a>', {\n          class: 'mw-userlink userAuthor',\n          text: userAuthor,\n          href: mw.util.getUrl('User:' + userAuthor),\n        }),\n        userLast === userAuthor\n          ? ''\n          : $('<i>', { text: '（修改者：' + userLast + '）' })\n      )\n    )\n    var $content = $('<div>', { class: 'forum-content', html: content })\n    var $timeArea = $('<div>', { class: 'post-time' }).append(\n      $('<i>', {\n        class: 'post-date timePublish',\n        text: dateFormat('yyyy年M月d日 hh:mm:ss', new Date(timePublish)),\n      })\n    )\n\n    // 判断是否为楼主，并返回帖子容器\n    if (id === '1') {\n      // 楼主\n      return $('<div>', {\n        class: 'forum-thread forum-first',\n      }).append(\n        $('<div>', { class: 'forum-before' }).append(\n          $('<h3>', {\n            class: 'forum-title',\n            text: ctx.forumMeta.title || '[UNTITLED] Forum Topic #' + forumid,\n          }),\n          $idLink,\n          $userLink\n        ),\n        $content,\n        $('<div>', { class: 'forum-after' }).append($timeArea)\n      )\n    } else {\n      // 普通帖子\n      var $replyArea = newReplyArea()\n\n      return $('<div>', { class: 'forum-thread' }).append(\n        $('<div>', { class: 'forum-before' }).append($idLink, $userLink),\n        $content,\n        $('<div>', { class: 'forum-after' }).append(\n          $timeArea,\n          $('<div>', { class: 'new-reply-container' }).append(\n            $('<div>', { class: 'modify-buttons-group' }).append(\n              $('<a>', {\n                class: 'reply-btn',\n                href: 'javascript:;',\n                text: '回复',\n              }).click(function(e) {\n                $replyArea.show()\n                $(this).hide()\n              })\n            ),\n            $replyArea\n          )\n        )\n      )\n    }\n  }\n\n  // 新回复容器\n  var newReplyArea = ctx => {\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\n    var $submitBtn = $('<button>', {\n      text: '回复',\n      class: 'forum-submit-btn',\n    }).click(function() {\n      var content = $textArea.val()\n      if (!content) return\n      console.info('New reply', content)\n    })\n\n    var $container = $('<div>', {\n      class: 'forum-new-reply-area',\n    }).append(\n      $('<label>', { class: 'forum-input-container' }).append(\n        $('<div>').append($textArea),\n        $('<div>').append($submitBtn)\n      )\n    )\n\n    return $container\n  }\n\n  // 新帖子容器\n  var newThreadArea = ctx => {\n    var $textArea = $('<textarea>', { class: 'forum-textarea' })\n    var $submitBtn = $('<button>', {\n      text: '发送',\n      class: 'forum-submit-btn',\n    }).click(function() {\n      var content = $textArea.val()\n      if (!content) return\n      console.info('New thread', content)\n    })\n\n    var $container = $('<div>', {\n      class: 'forum-new-thread-area',\n    }).append(\n      $('<label>', { class: 'forum-input-container' }).append(\n        $('<div>').append($textArea),\n        $('<div>').append($submitBtn)\n      )\n    )\n\n    return $container\n  }\n\n  // 新论坛容器\n  var newForumContainer = ctx => {\n    return $('<div>').append($('<p>', { text: 'newForumContainer' }))\n  }\n\n  // 无论坛容器\n  var noForumContainer = ctx => {}\n\n  var afterForum = ctx => {\n    return $('<div>', { class: 'forum-thread forum-add-thread' }).append(\n      newThreadArea(ctx)\n    )\n  }\n\n  var afterAllForums = ctx => {\n    return newForumContainer(ctx)\n  }\n\n  // @function dateFormat\n  function dateFormat(fmt, date) {\n    date = date || new Date()\n    var o = {\n      'M+': date.getMonth() + 1, //月份\n      'd+': date.getDate(), //日\n      'h+': date.getHours(), //小时\n      'm+': date.getMinutes(), //分\n      's+': date.getSeconds(), //秒\n      'q+': Math.floor((date.getMonth() + 3) / 3), //季度\n      S: date.getMilliseconds(), //毫秒\n    }\n    if (/(y+)/.test(fmt)) {\n      fmt = fmt.replace(\n        RegExp.$1,\n        (date.getFullYear() + '').substr(4 - RegExp.$1.length)\n      )\n    }\n    for (var k in o)\n      if (new RegExp('(' + k + ')').test(fmt)) {\n        fmt = fmt.replace(\n          RegExp.$1,\n          RegExp.$1.length == 1\n            ? o[k]\n            : ('00' + o[k]).substr(('' + o[k]).length)\n        )\n      }\n    return fmt\n  }\n\n  next &&\n    next({\n      allForumsContainer,\n      forumContainer,\n      threadContainer,\n      afterAllForums,\n      afterForum,\n      noForumContainer,\n    })\n})\n\n// Import style\nmw.loader.load('https://proj.wjghj.cn/Gadget-WikiForum/dist/WikiForum.theme.default.css')"],"sourceRoot":""}