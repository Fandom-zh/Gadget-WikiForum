{"version":3,"sources":["webpack://mediawiki-wikiforum/./theme/fandom.js"],"names":["main","i18n","mw","hook","add","next","_msg","msg","parse","conf","config","get","newReplyArea","ctx","$root","forumEl","forumid","threadid","$container","$","class","$textArea","$submitBtn","text","click","content","val","addClass","fn","updater","addReply","append","reactionContainer","_forum","meta","likeList","reactionLike","likeTotal","split","length","isLike","includes","wgUserName","$likeBtn","href","title","index","indexOf","splice","push","sort","join","updateThread","dateFormat","fmt","date","o","Date","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","S","getMilliseconds","k","test","replace","RegExp","$1","getFullYear","substr","allForumsContainer","forumContainer","id","threadContainer","timePublish","timeRelease","release","userAuthor","timeModify","user","userLast","htmlId","$idLink","e","preventDefault","window","history","pushState","$block","animate","scrollTop","offset","top","$userLink","util","getUrl","$content","html","$timeArea","forumMeta","$replyArea","show","this","hide","afterAllForums","afterForum","addThread","newThreadArea","noForumContainer","extend","loadStyle","adminGroup","adminUser","depthMax","enableNewForum","enableModify","enableDelete","WikiForumDefaultTheme","importArticle","type","articles","article","i18no","loadMessages","then"],"mappings":";YAiCA,SAASA,EAAKC,GAQZC,GAAGC,KAAK,mBAAmBC,KAAI,SAAAC,GAC7B,SAASC,IACP,OAAOL,EAAKM,IAAL,MAAAN,EAAI,WAAgBO,QAG7B,IAAMC,EAAOP,GAAGQ,OAAOC,MAmHnBC,EAAe,SAAAC,GAAO,IAChBC,EAAsCD,EAAtCC,MAAOC,EAA+BF,EAA/BE,QAASC,EAAsBH,EAAtBG,QAASC,EAAaJ,EAAbI,SAE7BC,EAAaC,EAAE,QAAS,CAC1BC,MAAO,yBAELC,EAAYF,EAAE,aAAc,CAAEC,MAAO,mBACrCE,EAAaH,EAAE,WAAY,CAC7BI,KAAMjB,EAAK,aACXc,MAAO,qBACNI,OAAM,WACP,IAAIC,EAAUJ,EAAUK,MACnBD,IAELP,EAAWS,SAAS,iBACpBd,EAAIe,GAAGC,QAAQC,SAAS,CACtBhB,QACAC,UACAU,UACAT,UACAC,iBAWJ,OAPAC,EAAWa,OACTZ,EAAE,UAAW,CAAEC,MAAO,0BAA2BW,OAC/CZ,EAAE,SAASY,OAAOV,GAClBF,EAAE,SAASY,OAAOT,KAIfJ,GAkCLc,EAAoB,SAAAnB,GAAO,IACrBoB,EAAwCpB,EAAxCoB,OAAQjB,EAAgCH,EAAhCG,QAASC,EAAuBJ,EAAvBI,SAAUiB,EAAarB,EAAbqB,KAAMN,EAAOf,EAAPe,GAEnCV,EAAaC,EAAE,QAAS,CAAEC,MAAO,mBAGnCe,EAAWD,EAAKE,cAAgB,GAMhCC,GAJFF,EADEA,EACSA,EAASG,MAAM,KAEf,IAEYC,OACrBC,EAASL,EAASM,SAAShC,EAAKiC,YA+BpC,OA7BAC,SAAWxB,EAAE,MAAO,CAClByB,KAAM,eACNxB,MAAO,gBACPG,KAAM,MAAF,OAAQc,EAAR,KACJQ,MACIvC,EADGkC,EACE,uBACA,uBAERb,SAASa,EAAS,UAAY,YAC9BhB,OAAM,WAEL,GADAN,EAAWS,SAAS,iBAChBa,EAAQ,CACV,IAAIM,EAAQX,EAASY,QAAQtC,EAAKiC,YAC9BI,GAAS,GAAGX,EAASa,OAAOF,EAAO,QAEvCX,EAASc,KAAKxC,EAAKiC,YAErBP,EAASe,OACTf,EAAWA,EAASgB,KAAK,KACzBvB,EAAGC,QAAQuB,aAAa,CACtBrC,QAASkB,EACTjB,UACAC,WACAiB,KAAM,CAAEE,aAAcD,QAI5BjB,EAAWa,OAAOY,UAEXzB,GAwBT,SAASmC,EAAWC,EAAKC,GAEvB,IAAIC,EAAI,CACN,MAFFD,EAAOA,GAAQ,IAAIE,MAENC,WAAa,EACxB,KAAMH,EAAKI,UACX,KAAMJ,EAAKK,WACX,KAAML,EAAKM,aACX,KAAMN,EAAKO,aACX,KAAMC,KAAKC,OAAOT,EAAKG,WAAa,GAAK,GACzCO,EAAGV,EAAKW,mBAQV,IAAK,IAAIC,IANL,OAAOC,KAAKd,KACdA,EAAMA,EAAIe,QACRC,OAAOC,IACNhB,EAAKiB,cAAgB,IAAIC,OAAO,EAAIH,OAAOC,GAAGhC,UAGrCiB,EACR,IAAIc,OAAO,IAAMH,EAAI,KAAKC,KAAKd,KACjCA,EAAMA,EAAIe,QACRC,OAAOC,GACa,GAApBD,OAAOC,GAAGhC,OACNiB,EAAEW,IACD,KAAOX,EAAEW,IAAIM,QAAQ,GAAKjB,EAAEW,IAAI5B,UAG3C,OAAOe,EAGTjD,GACEA,EAAK,CACHqE,mBApRqB,SAAA7D,GACvB,OAAOM,EAAE,QAAS,CAAEC,MAAO,8BAoRzBuD,eAhRiB,SAAA9D,GACnB,OAAOM,EAAE,QAAS,CAChBC,MAAO,aACP,eAAgBP,EAAIqB,KAAK0C,MA8QzBC,gBAzQkB,SAAAhE,GAAO,IAEnBG,EAA+BH,EAA/BG,QAASC,EAAsBJ,EAAtBI,SAAUQ,EAAYZ,EAAZY,QACrBqD,EACJjE,EAAIqB,KAAK4C,aAAejE,EAAIqB,KAAK6C,aAAelE,EAAIqB,KAAK8C,SAAW,GAEhEC,GADapE,EAAIqB,KAAKgD,WACTrE,EAAIqB,KAAK+C,YAAcpE,EAAIqB,KAAKiD,MAAQ,YACrDC,EAAWvE,EAAIqB,KAAKkD,UAAYH,EAChCI,EAAS,SAAH,OAAYrE,EAAZ,mBAA8BC,GAGtCqE,EAAUnE,EAAE,MAAO,CACrBC,MAAO,gBACPG,KAAM,IAAMN,EACZ2B,KAAM,IAAF,OAAMyC,KACT7D,OAAM,SAAU+D,GACjBA,EAAEC,iBACFC,OAAOC,QAAQC,UAAU,KAAM,KAAM,IAAMN,GAC3C,IAAMO,EAASzE,EAAE,IAAMkE,GACvBlE,EAAE,aAAa0E,QAAQ,CAAEC,UAAWF,EAAOG,SAASC,IAAM,KAAO,QAE/DC,EAAY9E,EAAE,QAAS,CAAEC,MAAO,eAAgBW,OAClDZ,EAAE,SAAU,CAAEC,MAAO,oBAAqBW,OACxCZ,EAAE,MAAO,CACPC,MAAO,yBACPG,KAAM0D,EACNrC,KAAM1C,GAAGgG,KAAKC,OAAO,QAAUlB,KAEjCG,IAAaH,EACT,GACA9D,EAAE,MAAO,CAAEI,KAAM,KAAF,OAAOjB,EAAK,aAAZ,aAA6B8E,EAA7B,SAGnBgB,EAAWjF,EAAE,QAAS,CAAEC,MAAO,gBAAiBiF,KAAM5E,IACtD6E,EAAYnF,EAAE,QAAS,CAAEC,MAAO,cAAeW,OACjDZ,EAAE,MAAO,CACPC,MAAO,wBACPG,KAAM8B,EAAW/C,EAAK,eAAgB,IAAImD,KAAKqB,OAKnD,GAAiB,MAAb7D,EAEF,OAAOE,EAAE,QAAS,CAChByD,GAAIS,EACJjE,MAAO,6BACNW,OACDZ,EAAE,QAAS,CAAEC,MAAO,iBAAkBW,OACpCZ,EAAE,OAAQ,CACRC,MAAO,cACPG,KAAMV,EAAI0F,UAAU1D,OAAS,2BAA6B7B,IAE5DsE,EACAW,GAEFG,EACAjF,EAAE,QAAS,CAAEC,MAAO,gBAAiBW,OACnCuE,EACAtE,EAAkBnB,KAGjB,IAEGC,EAA2CD,EAA3CC,MAAOI,EAAoCL,EAApCK,WAAYF,EAAwBH,EAAxBG,QAASiB,EAAepB,EAAfoB,OAAQL,EAAOf,EAAPe,GACxC4E,EAAa5F,EAAa,CAC5BE,QACAI,aACAH,QAASkB,EACTjB,UACAC,WACAW,OAGF,OAAOT,EAAE,QAAS,CAAEC,MAAO,eAAgBwD,GAAIS,IAAUtD,OACvDZ,EAAE,QAAS,CAAEC,MAAO,iBAAkBW,OAAOuD,EAASW,GACtDG,EACAjF,EAAE,QAAS,CAAEC,MAAO,gBAAiBW,OACnCuE,EACAnF,EAAE,QAAS,CAAEC,MAAO,wBAAyBW,OAC3CZ,EAAE,QAAS,CAAEC,MAAO,yBAA0BW,OAC5CZ,EAAE,MAAO,CACPC,MAAO,YACPwB,KAAM,eACNrB,KAAMjB,EAAK,eACVkB,OAAM,SAAU+D,GACjBiB,EAAWC,OACXtF,EAAEuF,MAAMC,WAGZH,GAEFxE,EAAkBnB,MA8KtB+F,eAzCiB,SAAA/F,GACnB,OAAOM,EAAE,QAAS,CAAEC,MAAO,qBAAsBW,OAb1CZ,EAAE,SAASY,OAAOZ,EAAE,MAAO,CAAEI,KAAM,yBAsDxCsF,WAhDa,SAAAhG,GACf,OAAOM,EAAE,QAAS,CAAEC,MAAO,kCAAmCW,OAtF5C,SAAAlB,GAAO,IACjBC,EAA2BD,EAA3BC,MAAOmB,EAAoBpB,EAApBoB,OAAQjB,EAAYH,EAAZG,QAEnBE,EAAaC,EAAE,QAAS,CAC1BC,MAAO,0BAELC,EAAYF,EAAE,aAAc,CAAEC,MAAO,mBACrCE,EAAaH,EAAE,WAAY,CAC7BI,KAAMjB,EAAK,cACXc,MAAO,qBACNI,OAAM,WACP,IAAIC,EAAUJ,EAAUK,MACnBD,IAELP,EAAWS,SAAS,iBACpBd,EAAIe,GAAGC,QAAQiF,UAAU,CAAEhG,QAAOC,QAASkB,EAAQjB,UAASS,gBAW9D,OARAP,EAAWa,OACTZ,EAAE,WAAY,CAAEI,KAAMjB,EAAK,sBAC3Ba,EAAE,UAAW,CAAEC,MAAO,0BAA2BW,OAC/CZ,EAAE,SAASY,OAAOV,GAClBF,EAAE,SAASY,OAAOT,KAIfJ,EA6DL6F,CAAclG,KA+CdmG,iBAnDmB,SAAAnG,WAvQA,IAfVM,EAAE8F,OACjB,GACA,CACEC,WAAW,EACXC,WAAY,CAAC,SACbC,UAAW,GACXC,SAAU,EACVC,gBAAgB,EAChBC,cAAc,EACdC,cAAc,GAEhB/B,OAAOgC,uBAIIP,WACXQ,cAAc,CACZC,KAAM,QACNC,SAAU,CAAC,iDAKfF,cAAc,CACZC,KAAM,SACNE,QAAS,oCAEX3H,GAAGC,KAAK,YAAYC,KAAI,SAAU0H,GAChCA,EAAMC,aAAa,2BAA2BC,KAAKhI,M","file":"WikiForum.theme.fandom.min.js","sourcesContent":["// Theme settings\nconst settings = $.extend(\n  {},\n  {\n    loadStyle: true,\n    adminGroup: ['sysop'],\n    adminUser: [],\n    depthMax: 3,\n    enableNewForum: false,\n    enableModify: true,\n    enableDelete: true,\n  },\n  window.WikiForumDefaultTheme\n)\n\n// Import style\nif (settings.loadStyle !== false) {\n  importArticle({\n    type: 'style',\n    articles: ['u:dev:MediaWiki:WikiForum/theme/default.css'],\n  })\n}\n\n// Wait i18n-js\nimportArticle({\n  type: 'script',\n  article: 'u:dev:MediaWiki:I18n-js/code.js',\n})\nmw.hook('dev.i18n').add(function (i18no) {\n  i18no.loadMessages('WikiForum-theme-default').then(main)\n})\n\n// function main\nfunction main(i18n) {\n  /**\n   * @function theme.default 标准的官方主题\n   * @param {Object} ctx\n   * @param {Object} ctx.meta Metadata\n   *\n   * @param {Function} next\n   */\n  mw.hook('WikiForum.theme').add(next => {\n    function _msg(...params) {\n      return i18n.msg(...params).parse()\n    }\n\n    const conf = mw.config.get()\n\n    // 全论坛容器\n    var allForumsContainer = ctx => {\n      return $('<div>', { class: 'wiki-forum-all-container' })\n    }\n\n    // 单论坛容器\n    var forumContainer = ctx => {\n      return $('<div>', {\n        class: 'wiki-forum',\n        'data-forumid': ctx.meta.id,\n      })\n    }\n\n    // 帖子容器\n    var threadContainer = ctx => {\n      // 处理 meta\n      const { forumid, threadid, content } = ctx\n      const timePublish =\n        ctx.meta.timePublish || ctx.meta.timeRelease || ctx.meta.release || ''\n      const timeModify = ctx.meta.timeModify || timePublish\n      const userAuthor = ctx.meta.userAuthor || ctx.meta.user || 'unsigned'\n      const userLast = ctx.meta.userLast || userAuthor\n      const htmlId = `forum-${forumid}_thread-${threadid}`\n\n      // 缓存组件\n      var $idLink = $('<a>', {\n        class: 'forum-id-link',\n        text: '#' + threadid,\n        href: `#${htmlId}`,\n      }).click(function (e) {\n        e.preventDefault()\n        window.history.pushState(null, null, '#' + htmlId)\n        const $block = $('#' + htmlId)\n        $('html,body').animate({ scrollTop: $block.offset().top - 100 }, 500)\n      })\n      var $userLink = $('<div>', { class: 'forum-user' }).append(\n        $('<span>', { class: 'forum-user-link' }).append(\n          $('<a>', {\n            class: 'mw-userlink userAuthor',\n            text: userAuthor,\n            href: mw.util.getUrl('User:' + userAuthor),\n          }),\n          userLast === userAuthor\n            ? ''\n            : $('<i>', { text: ` (${_msg('user-last')}: ${userLast})` })\n        )\n      )\n      var $content = $('<div>', { class: 'forum-content', html: content })\n      var $timeArea = $('<div>', { class: 'post-time' }).append(\n        $('<i>', {\n          class: 'post-date timePublish',\n          text: dateFormat(_msg('date-format'), new Date(timePublish)),\n        })\n      )\n\n      // 判断是否为楼主，并返回帖子容器\n      if (threadid === '1') {\n        // 楼主\n        return $('<div>', {\n          id: htmlId,\n          class: 'forum-thread forum-first',\n        }).append(\n          $('<div>', { class: 'forum-before' }).append(\n            $('<h3>', {\n              class: 'forum-title',\n              text: ctx.forumMeta.title || '[UNTITLED] Forum Topic #' + forumid,\n            }),\n            $idLink,\n            $userLink\n          ),\n          $content,\n          $('<div>', { class: 'forum-after' }).append(\n            $timeArea,\n            reactionContainer(ctx)\n          )\n        )\n      } else {\n        // 普通帖子\n        const { $root, $container, forumid, _forum, fn } = ctx\n        var $replyArea = newReplyArea({\n          $root,\n          $container,\n          forumEl: _forum,\n          forumid,\n          threadid,\n          fn,\n        })\n\n        return $('<div>', { class: 'forum-thread', id: htmlId }).append(\n          $('<div>', { class: 'forum-before' }).append($idLink, $userLink),\n          $content,\n          $('<div>', { class: 'forum-after' }).append(\n            $timeArea,\n            $('<div>', { class: 'new-reply-container' }).append(\n              $('<div>', { class: 'modify-buttons-group' }).append(\n                $('<a>', {\n                  class: 'reply-btn',\n                  href: 'javascript:;',\n                  text: _msg('reply-btn'),\n                }).click(function (e) {\n                  $replyArea.show()\n                  $(this).hide()\n                })\n              ),\n              $replyArea\n            ),\n            reactionContainer(ctx)\n          )\n        )\n      }\n    }\n\n    // 新回复容器\n    var newReplyArea = ctx => {\n      const { $root, forumEl, forumid, threadid } = ctx\n\n      var $container = $('<div>', {\n        class: 'forum-new-reply-area',\n      })\n      var $textArea = $('<textarea>', { class: 'forum-textarea' })\n      var $submitBtn = $('<button>', {\n        text: _msg('reply-btn'),\n        class: 'forum-submit-btn',\n      }).click(function () {\n        var content = $textArea.val()\n        if (!content) return\n\n        $container.addClass('forum-loading')\n        ctx.fn.updater.addReply({\n          $root,\n          forumEl,\n          content,\n          forumid,\n          threadid,\n        })\n      })\n\n      $container.append(\n        $('<label>', { class: 'forum-input-container' }).append(\n          $('<div>').append($textArea),\n          $('<div>').append($submitBtn)\n        )\n      )\n\n      return $container\n    }\n\n    // 新帖子容器\n    var newThreadArea = ctx => {\n      const { $root, _forum, forumid } = ctx\n\n      var $container = $('<div>', {\n        class: 'forum-new-thread-area',\n      })\n      var $textArea = $('<textarea>', { class: 'forum-textarea' })\n      var $submitBtn = $('<button>', {\n        text: _msg('submit-btn'),\n        class: 'forum-submit-btn',\n      }).click(function () {\n        var content = $textArea.val()\n        if (!content) return\n\n        $container.addClass('forum-loading')\n        ctx.fn.updater.addThread({ $root, forumEl: _forum, forumid, content })\n      })\n\n      $container.append(\n        $('<strong>', { text: _msg('add-thread-label') }),\n        $('<label>', { class: 'forum-input-container' }).append(\n          $('<div>').append($textArea),\n          $('<div>').append($submitBtn)\n        )\n      )\n\n      return $container\n    }\n\n    // 点赞容器\n    var reactionContainer = ctx => {\n      const { _forum, forumid, threadid, meta, fn } = ctx\n\n      const $container = $('<div>', { class: 'forum-reaction' })\n\n      // Like btn\n      let likeList = meta.reactionLike || ''\n      if (likeList) {\n        likeList = likeList.split('|')\n      } else {\n        likeList = []\n      }\n      let likeTotal = likeList.length\n      let isLike = likeList.includes(conf.wgUserName)\n\n      $likeBtn = $('<a>', {\n        href: 'javascript:;',\n        class: 'reaction-like',\n        text: `👍(${likeTotal})`,\n        title: isLike\n          ? _msg('reaction-like-remove')\n          : _msg('reaction-like-add'),\n      })\n        .addClass(isLike ? 'is-like' : 'not-like')\n        .click(function () {\n          $container.addClass('forum-loading')\n          if (isLike) {\n            let index = likeList.indexOf(conf.wgUserName)\n            if (index > -1) likeList.splice(index, 1)\n          } else {\n            likeList.push(conf.wgUserName)\n          }\n          likeList.sort()\n          likeList = likeList.join('|')\n          fn.updater.updateThread({\n            forumEl: _forum,\n            forumid,\n            threadid,\n            meta: { reactionLike: likeList },\n          })\n        })\n\n      $container.append($likeBtn)\n\n      return $container\n    }\n\n    // 新论坛容器\n    var newForumContainer = ctx => {\n      return $('<div>').append($('<p>', { text: 'newForumContainer' }))\n    }\n\n    // 无论坛容器\n    var noForumContainer = ctx => {}\n\n    var afterForum = ctx => {\n      return $('<div>', { class: 'forum-thread forum-add-thread' }).append(\n        newThreadArea(ctx)\n      )\n    }\n\n    var afterAllForums = ctx => {\n      return $('<div>', { class: 'after-all-forums' }).append(\n        newForumContainer(ctx)\n      )\n    }\n\n    // @function dateFormat\n    function dateFormat(fmt, date) {\n      date = date || new Date()\n      var o = {\n        'M+': date.getMonth() + 1, //月份\n        'd+': date.getDate(), //日\n        'h+': date.getHours(), //小时\n        'm+': date.getMinutes(), //分\n        's+': date.getSeconds(), //秒\n        'q+': Math.floor((date.getMonth() + 3) / 3), //季度\n        S: date.getMilliseconds(), //毫秒\n      }\n      if (/(y+)/.test(fmt)) {\n        fmt = fmt.replace(\n          RegExp.$1,\n          (date.getFullYear() + '').substr(4 - RegExp.$1.length)\n        )\n      }\n      for (var k in o)\n        if (new RegExp('(' + k + ')').test(fmt)) {\n          fmt = fmt.replace(\n            RegExp.$1,\n            RegExp.$1.length == 1\n              ? o[k]\n              : ('00' + o[k]).substr(('' + o[k]).length)\n          )\n        }\n      return fmt\n    }\n\n    next &&\n      next({\n        allForumsContainer,\n        forumContainer,\n        threadContainer,\n        afterAllForums,\n        afterForum,\n        noForumContainer,\n      })\n  })\n}\n"],"sourceRoot":""}