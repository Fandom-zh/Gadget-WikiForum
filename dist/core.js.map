{"version":3,"sources":["webpack://mediawiki-wikiforum/./src/module/actionEdit.js","webpack://mediawiki-wikiforum/./src/module/actionGet.js","webpack://mediawiki-wikiforum/./src/module/log.js","webpack://mediawiki-wikiforum/./src/module/mw.js","webpack://mediawiki-wikiforum/./src/module/parser.js","webpack://mediawiki-wikiforum/./src/module/renderer.js","webpack://mediawiki-wikiforum/./src/module/updater.js","webpack://mediawiki-wikiforum/webpack/bootstrap","webpack://mediawiki-wikiforum/./src/index.js"],"names":["require","api","conf","editToken","module","exports","title","text","summary","$","post","format","action","token","page","wgPageName","get","prop","disabletoc","disableeditsection","log","data","console","info","warn","error","err","mw","util","wikiScript","config","user","tokens","hook","parseForums","code","$root","forums","hasClass","find","each","index","forum","push","forumid","String","meta","extend","pageName","threads","parseThreads","prefix","$forum","$threads","getThreads","thread","threadObj","threadid","content","getContent","getMeta","length","$thread","html","trim","replace","$data","getUser","author","last","getTime","publish","modify","fromApi","parse","wikitext","$wikitext","$html","Obj","window","WikiForum","cache","pages","fromHtml","$code","forumEl","actionGet","getThread","Number","split","item","_","id","ctx","renderAllForums","theme","$allForums","allForumsContainer","noForumContainer","append","renderForum","_forum","forumMeta","afterAllForums","$container","fn","forumContainer","renderThread","afterForum","threadContainer","parser","updater","fromPage","target","then","toPage","toHtml","fire","actionEdit","contentValidator","str","openTable","match","closeTable","i","div","document","createElement","innerHTML","handleEdit","parseAllForums","ret","errors","parseForum","timeStamp","wgUserName","metaList","threadList","parseThread","indent","indentStr","reply","key","val","newKey","toLowerCase","metaList1","metaListKeys","Object","keys","a","sort","join","Date","toISOString","isComplex","depthMax","updateThread","findAndUpdate","base","allThreads","userLast","timeModify","addThread","userAuthor","timePublish","addReply","newReply","newThread","loader","using","Core","renderer"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,eAAiCA,mBAAO,CAAC,gCAAD,CAAxC;AAAA,IAAQC,GAAR,YAAQA,GAAR;AAAA,IAAaC,IAAb,YAAaA,IAAb;AAAA,IAAmBC,SAAnB,YAAmBA,SAAnB;;AAEAC,MAAM,CAACC,OAAP,GAAiB,gBAA8B;AAAA,MAA3BC,KAA2B,QAA3BA,KAA2B;AAAA,MAApBC,IAAoB,QAApBA,IAAoB;AAAA,MAAdC,OAAc,QAAdA,OAAc;AAC7C,SAAOC,CAAC,CAACC,IAAF,CAAOT,GAAP,EAAY;AACjBU,UAAM,EAAE,MADS;AAEjBC,UAAM,EAAE,MAFS;AAGjBC,SAAK,EAAEV,SAHU;AAIjBG,SAAK,EAALA,KAJiB;AAKjBC,QAAI,EAAJA,IALiB;AAMjBC,WAAO,EAAPA;AANiB,GAAZ,CAAP;AAQD,CATD,C;;;;;;;;;;ACFA,eAAsBR,mBAAO,CAAC,gCAAD,CAA7B;AAAA,IAAQC,GAAR,YAAQA,GAAR;AAAA,IAAaC,IAAb,YAAaA,IAAb;;AAEAE,MAAM,CAACC,OAAP,GAAiB,YAA4B;AAAA,MAA3BS,IAA2B,uEAApBZ,IAAI,CAACa,UAAe;AAC3C,SAAON,CAAC,CAACO,GAAF,CAAMf,GAAN,EAAW;AAChBU,UAAM,EAAE,MADQ;AAEhBC,UAAM,EAAE,OAFQ;AAGhBK,QAAI,EAAE,eAHU;AAIhBC,cAAU,EAAE,CAJI;AAKhBC,sBAAkB,EAAE,CALJ;AAMhBL,QAAI,EAAJA;AANgB,GAAX,CAAP;AAQD,CATD,C;;;;;;;;;;ACFA,SAASM,GAAT,GAAsB;AAAA;;AAAA,oCAANC,IAAM;AAANA,QAAM;AAAA;;AACpB,cAAAC,OAAO,EAACC,IAAR,kBAAa,oBAAb,SAAsCF,IAAtC;AACD;;AAED,SAASG,IAAT,GAAuB;AAAA;;AAAA,qCAANH,IAAM;AAANA,QAAM;AAAA;;AACrB,eAAAC,OAAO,EAACE,IAAR,mBAAa,oBAAb,SAAsCH,IAAtC;AACD;;AAED,SAASI,KAAT,GAAwB;AAAA;;AAAA,qCAANJ,IAAM;AAANA,QAAM;AAAA;;AACtB,eAAAC,OAAO,EAACG,KAAR,mBAAc,mBAAd,SAAsCJ,IAAtC;AACD;;AAEDjB,MAAM,CAACC,OAAP,GAAiB;AACfe,KAAG,EAAHA,GADe;AAEfG,MAAI,EAAEH,GAFS;AAGfI,MAAI,EAAJA,IAHe;AAIfC,OAAK,EAALA,KAJe;AAKfC,KAAG,EAAED;AALU,CAAjB,C;;;;;;;;;;ACZArB,MAAM,CAACC,OAAP,GAAiB;AACfJ,KAAG,EAAE0B,EAAE,CAACC,IAAH,CAAQC,UAAR,CAAmB,KAAnB,CADU;AAEf3B,MAAI,EAAEyB,EAAE,CAACG,MAAH,CAAUd,GAAV,EAFS;AAGfb,WAAS,EAAEwB,EAAE,CAACI,IAAH,CAAQC,MAAR,CAAehB,GAAf,CAAmB,WAAnB,KAAmCW,EAAE,CAACI,IAAH,CAAQC,MAAR,CAAehB,GAAf,CAAmB,WAAnB,CAH/B;AAIfiB,MAAI,EAAEN,EAAE,CAACM,IAJM;AAKfL,MAAI,EAAED,EAAE,CAACC;AALM,CAAjB,C;;;;;;;;;;ACAA,eAAgB5B,mBAAO,CAAC,kCAAD,CAAvB;AAAA,IAAQoB,GAAR,YAAQA,GAAR;AAEA;AACA;AACA;AACA;AACA;;;AACA,SAASc,WAAT,CAAqBC,IAArB,EAA2B7B,KAA3B,EAAkC;AAChC,MAAI8B,KAAK,GAAG3B,CAAC,CAAC0B,IAAD,CAAb;AACA,MAAIE,MAAM,GAAG,EAAb;;AAEA,MAAI,CAACD,KAAK,CAACE,QAAN,CAAe,YAAf,CAAL,EAAmC;AACjCF,SAAK,GAAGA,KAAK,CAACG,IAAN,CAAW,aAAX,CAAR;AACD;;AAEDH,OAAK,CAACI,IAAN,CAAW,UAACC,KAAD,EAAQC,KAAR,EAAkB;AAC3BL,UAAM,CAACM,IAAP,CAAY;AACVC,aAAO,EAAEC,MAAM,CAACJ,KAAK,GAAG,CAAT,CADL;AAEVK,UAAI,EAAErC,CAAC,CAACsC,MAAF,CAAS,EAAT,EAAatC,CAAC,CAACiC,KAAD,CAAD,CAASrB,IAAT,EAAb,EAA8B;AAAE2B,gBAAQ,EAAE1C;AAAZ,OAA9B,CAFI;AAGV2C,aAAO,EAAEC,YAAY,CAACR,KAAD;AAHX,KAAZ;AAKD,GAND;AAOA,SAAOL,MAAP;AACD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASa,YAAT,CAAsBR,KAAtB,EAA0C;AAAA,MAAbS,MAAa,uEAAJ,EAAI;AACxC,MAAIC,MAAM,GAAG3C,CAAC,CAACiC,KAAD,CAAd;AACA,MAAIS,MAAJ,EAAYA,MAAM,IAAI,GAAV;AACZ,MAAIF,OAAO,GAAG,EAAd;AACAI,UAAQ,GAAGC,UAAU,CAACF,MAAD,CAArB;AACA3C,GAAC,CAAC+B,IAAF,CAAOa,QAAP,EAAiB,UAACZ,KAAD,EAAQc,MAAR,EAAmB;AAClC,QAAIC,SAAS,GAAG;AACdC,cAAQ,EAAEZ,MAAM,CAACM,MAAM,IAAIV,KAAK,GAAG,CAAZ,CAAP,CADF;AAEdiB,aAAO,EAAEC,UAAU,CAACJ,MAAD,CAFL;AAGdT,UAAI,EAAEc,OAAO,CAACL,MAAD;AAHC,KAAhB;;AAKA,QAAID,UAAU,CAACC,MAAD,CAAV,CAAmBM,MAAnB,GAA4B,CAAhC,EAAmC;AACjCL,eAAS,CAACP,OAAV,GAAoBC,YAAY,CAACK,MAAD,EAASC,SAAS,CAACC,QAAnB,CAAhC;AACD;;AACDR,WAAO,CAACN,IAAR,CAAaa,SAAb;AACD,GAVD;AAWA,SAAOP,OAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASK,UAAT,CAAoBC,MAApB,EAA4B;AAC1B,MAAIO,OAAO,GAAGrD,CAAC,CAAC8C,MAAD,CAAf;AACA,SAAOO,OAAO,CAACvB,IAAR,CAAa,iBAAb,CAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASoB,UAAT,CAAoBJ,MAApB,EAA4B;AAC1B,MAAIO,OAAO,GAAGrD,CAAC,CAAC8C,MAAD,CAAf;AACA,MAAIG,OAAO,GAAGI,OAAO,CAACvB,IAAR,CAAa,kBAAb,EAAiCwB,IAAjC,MAA2C,EAAzD;AACAL,SAAO,GAAGA,OAAO,CACdM,IADO,GAEPC,OAFO,CAEC,kCAFD,EAEqC,EAFrC,EAGPA,OAHO,CAGC,gCAHD,EAGmC,EAHnC,EAIPA,OAJO,CAIC,KAJD,EAIQ,EAJR,EAKPA,OALO,CAKC,KALD,EAKQ,EALR,CAAV;AAOA,SAAOP,OAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASE,OAAT,CAAiBL,MAAjB,EAAyB;AACvB,MAAIO,OAAO,GAAGrD,CAAC,CAAC8C,MAAD,CAAf;AACA,MAAIW,KAAK,GAAGJ,OAAO,CAACzC,IAAR,EAAZ;AAEA,SAAO6C,KAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASC,OAAT,CAAiBZ,MAAjB,EAAyB;AACvB,MAAIO,OAAO,GAAGrD,CAAC,CAAC8C,MAAD,CAAf;AACA,MAAIa,MAAM,GAAGN,OAAO,CAACzC,IAAR,CAAa,YAAb,KAA8B,EAA3C;AACA,MAAIgD,IAAI,GAAGP,OAAO,CAACzC,IAAR,CAAa,UAAb,KAA4B+C,MAAvC;AACA,SAAO;AAAEA,UAAM,EAANA,MAAF;AAAUC,QAAI,EAAJA;AAAV,GAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASC,OAAT,CAAiBf,MAAjB,EAAyB;AACvB,MAAIO,OAAO,GAAGrD,CAAC,CAAC8C,MAAD,CAAf;AACA,MAAIgB,OAAO,GAAGT,OAAO,CAACzC,IAAR,CAAa,aAAb,KAA+B,EAA7C;AACA,MAAImD,MAAM,GAAGV,OAAO,CAACzC,IAAR,CAAa,YAAb,KAA8BkD,OAA3C;AACA,SAAO;AAAEA,WAAO,EAAPA,OAAF;AAAWC,UAAM,EAANA;AAAX,GAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASC,OAAT,CAAiBpD,IAAjB,EAAuB;AACrB,MAAIf,KAAK,GAAGe,IAAI,CAACqD,KAAL,CAAWpE,KAAvB;AACA,MAAIqE,QAAQ,GAAGtD,IAAI,CAACqD,KAAL,CAAWC,QAAX,CAAoB,GAApB,CAAf;AACA,MAAIZ,IAAI,GAAG1C,IAAI,CAACqD,KAAL,CAAWnE,IAAX,CAAgB,GAAhB,CAAX,CAHqB,CAKrB;;AACA,MAAIqE,SAAS,GAAGnE,CAAC,CAAC,UAAUkE,QAAV,GAAqB,QAAtB,CAAjB;AACA,MAAIE,KAAK,GAAGpE,CAAC,CAAC,UAAUsD,IAAV,GAAiB,QAAlB,CAAb,CAPqB,CASrB;;AACA,MAAIc,KAAK,CAACtC,IAAN,CAAW,qBAAX,EAAkCsB,MAAlC,GAA2C,CAA/C,EAAkD;AAChDgB,SAAK,GAAGA,KAAK,CAACtC,IAAN,CAAW,qBAAX,CAAR;AACD;;AAED,MAAIuC,GAAG,GAAG;AACRH,YAAQ,EAAEzC,WAAW,CAAC0C,SAAD,EAAYtE,KAAZ,CADb;AAERyD,QAAI,EAAE7B,WAAW,CAAC2C,KAAD,EAAQvE,KAAR;AAFT,GAAV,CAdqB,CAmBrB;;AACAyE,QAAM,CAACC,SAAP,GAAmBD,MAAM,CAACC,SAAP,IAAoB,EAAvC;AACAD,QAAM,CAACC,SAAP,CAAiBC,KAAjB,GAAyBF,MAAM,CAACC,SAAP,CAAiBC,KAAjB,IAA0B,EAAnD;AACAF,QAAM,CAACC,SAAP,CAAiBC,KAAjB,CAAuBC,KAAvB,GAA+BH,MAAM,CAACC,SAAP,CAAiBC,KAAjB,CAAuBC,KAAvB,IAAgC,EAA/D;AACAH,QAAM,CAACC,SAAP,CAAiBC,KAAjB,CAAuBC,KAAvB,CAA6B5E,KAA7B,IAAsCwE,GAAtC;AAEA,SAAOA,GAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASK,QAAT,CAAkBhD,IAAlB,EAAoC;AAAA,MAAZ7B,KAAY,uEAAJ,EAAI;AAClC,MAAI8E,KAAK,GAAG3E,CAAC,CAAC0B,IAAD,CAAb;AACA,MAAIkD,OAAO,GAAGnD,WAAW,CAACkD,KAAD,CAAzB;AACA,SAAOC,OAAP;AACD;;AAEDjF,MAAM,CAACC,OAAP,GAAiB;AACfoE,SAAO,EAAPA,OADe;AAEfU,UAAQ,EAARA;AAFe,CAAjB,C;;;;;;;;;;ACtJA,eAAoBnF,mBAAO,CAAC,wCAAD,CAA3B;AAAA,IAAQyE,OAAR,YAAQA,OAAR;;AACA,IAAMa,SAAS,GAAGtF,mBAAO,CAAC,8CAAD,CAAzB;;AACA,gBAA6BA,mBAAO,CAAC,gCAAD,CAApC;AAAA,IAAQ4B,IAAR,aAAQA,IAAR;AAAA,IAAcK,IAAd,aAAcA,IAAd;AAAA,IAAoB/B,IAApB,aAAoBA,IAApB;;AACA,gBAAuBF,mBAAO,CAAC,kCAAD,CAA9B;AAAA,IAAQoB,GAAR,aAAQA,GAAR;AAAA,IAAaK,KAAb,aAAaA,KAAb,C,CAEA;;;AACA,SAAS8D,SAAT,OAAyD;AAAA,MAApCF,OAAoC,QAApCA,OAAoC;AAAA,0BAA3BzC,OAA2B;AAAA,MAA3BA,OAA2B,6BAAjB,GAAiB;AAAA,MAAZa,QAAY,QAAZA,QAAY;AACvD;AACAb,SAAO,GAAG4C,MAAM,CAAC5C,OAAD,CAAhB;AACAA,SAAO;AACP,MAAIF,KAAK,GAAG2C,OAAO,CAACzC,OAAD,CAAnB;AAEAa,UAAQ,GAAGA,QAAQ,CAACgC,KAAT,CAAe,GAAf,CAAX;AACAhF,GAAC,CAAC+B,IAAF,CAAOiB,QAAP,EAAiB,UAAChB,KAAD,EAAQiD,IAAR,EAAiB;AAChCA,QAAI,GAAGF,MAAM,CAACE,IAAD,CAAb;AACAA,QAAI;AACJjC,YAAQ,CAAChB,KAAD,CAAR,GAAkBiD,IAAlB;AACD,GAJD,EAPuD,CAavD;;AACA,MAAInC,MAAM,GAAGb,KAAb;AACAjC,GAAC,CAAC+B,IAAF,CAAOiB,QAAP,EAAiB,UAACkC,CAAD,EAAIC,EAAJ,EAAW;AAC1BxE,OAAG,CAAC,QAAD,EAAWmC,MAAM,CAACN,OAAP,CAAe2C,EAAf,CAAX,CAAH;AACArC,UAAM,GAAGA,MAAM,CAACN,OAAP,CAAe2C,EAAf,CAAT;AACD,GAHD;AAKA,SAAOrC,MAAP;AACD,C,CAED;;;AACA,SAASI,UAAT,CAAoBkC,GAApB,EAAyB;AACvB,MAAItC,MAAM,GAAGgC,SAAS,CAACM,GAAD,CAAtB;AACA,SAAOtC,MAAM,CAACG,OAAd;AACD,C,CAED;;;AACA,SAASE,OAAT,CAAiBiC,GAAjB,EAAsB;AACpB,MAAItC,MAAM,GAAGgC,SAAS,CAACM,GAAD,CAAtB;AACA,SAAOtC,MAAM,CAACT,IAAd;AACD,C,CAED;;;AACA,SAASgD,eAAT,QAAoD;AAAA,MAAzBT,OAAyB,SAAzBA,OAAyB;AAAA,MAAhBU,KAAgB,SAAhBA,KAAgB;AAAA,MAAT3D,KAAS,SAATA,KAAS;AAClDhB,KAAG,CAAC,UAAD,CAAH;AACA,MAAQ2C,IAAR,GAAiBsB,OAAjB,CAAQtB,IAAR;AACA,MAAIiC,UAAU,GAAGD,KAAK,CAACE,kBAAN,EAAjB;;AAEA,MAAIlC,IAAI,CAACF,MAAL,GAAc,CAAlB,EAAqB;AACnB,QAAIkC,KAAK,CAACG,gBAAV,EAA4B;AAC1BF,gBAAU,CAACG,MAAX,CAAkBJ,KAAK,CAACG,gBAAN,EAAlB;AACD;AACF,GAJD,MAIO;AACLzF,KAAC,CAAC+B,IAAF,CAAOuB,IAAP,EAAa,UAACtB,KAAD,EAAQC,KAAR,EAAkB;AAC7BtB,SAAG,CAAC,QAAD,YAAcqB,KAAK,GAAG,CAAtB,cAA2BsB,IAAI,CAACF,MAAhC,EAAH;AACAmC,gBAAU,CAACG,MAAX,CACEC,WAAW,CAAC;AACVhE,aAAK,EAALA,KADU;AAEViE,cAAM,EAAEhB,OAFE;AAGViB,iBAAS,EAAE5D,KAAK,CAACI,IAHP;AAIVF,eAAO,EAAEF,KAAK,CAACE,OAJL;AAKVF,aAAK,EAALA,KALU;AAMVqD,aAAK,EAALA;AANU,OAAD,CADb,EASEA,KAAK,CAACQ,cAAN,GACIR,KAAK,CAACQ,cAAN,CAAqB;AACnBnE,aAAK,EAALA,KADmB;AAEnBoE,kBAAU,EAAER,UAFO;AAGnBK,cAAM,EAAEhB,OAHW;AAInBiB,iBAAS,EAAE5D,KAAK,CAACI,IAJE;AAKnBF,eAAO,EAAEF,KAAK,CAACE,OALI;AAMnB6D,UAAE,EAAFA;AANmB,OAArB,CADJ,GASI,EAlBN;AAoBD,KAtBD;AAuBD;;AAED,SAAOT,UAAP;AACD,C,CAED;;;AACA,SAASI,WAAT,CAAqBP,GAArB,EAA0B;AACxB,MAAQzD,KAAR,GAAwEyD,GAAxE,CAAQzD,KAAR;AAAA,MAAeoE,UAAf,GAAwEX,GAAxE,CAAeW,UAAf;AAAA,MAA2BH,MAA3B,GAAwER,GAAxE,CAA2BQ,MAA3B;AAAA,MAAmC3D,KAAnC,GAAwEmD,GAAxE,CAAmCnD,KAAnC;AAAA,MAA0C4D,SAA1C,GAAwET,GAAxE,CAA0CS,SAA1C;AAAA,MAAqD1D,OAArD,GAAwEiD,GAAxE,CAAqDjD,OAArD;AAAA,MAA8DmD,KAA9D,GAAwEF,GAAxE,CAA8DE,KAA9D;AAEA,MAAI3C,MAAM,GAAG2C,KAAK,CAACW,cAAN,CAAqB;AAAE5D,QAAI,EAAEwD;AAAR,GAArB,CAAb;AAEA7F,GAAC,CAAC+B,IAAF,CAAOE,KAAK,CAACO,OAAb,EAAsB,UAACR,KAAD,EAAQc,MAAR,EAAmB;AACvCH,UAAM,CAAC+C,MAAP,CACEQ,YAAY,CAAC;AACXvE,WAAK,EAALA,KADW;AAEXoE,gBAAU,EAAEpD,MAFD;AAGXiD,YAAM,EAANA,MAHW;AAIXN,WAAK,EAALA,KAJW;AAKXxC,YAAM,EAANA,MALW;AAMX+C,eAAS,EAATA,SANW;AAOX1D,aAAO,EAAPA;AAPW,KAAD,CADd;AAWD,GAZD;;AAcA,MAAImD,KAAK,CAACa,UAAV,EAAsB;AACpBxD,UAAM,CAAC+C,MAAP,CACEJ,KAAK,CAACa,UAAN,CAAiB;AACfxE,WAAK,EAALA,KADe;AAEfoE,gBAAU,EAAVA,UAFe;AAGfH,YAAM,EAANA,MAHe;AAIfC,eAAS,EAATA,SAJe;AAKf1D,aAAO,EAAPA,OALe;AAMf6D,QAAE,EAAFA;AANe,KAAjB,CADF;AAUD;;AAED,SAAOrD,MAAP;AACD,C,CAED;;;AACA,SAASuD,YAAT,CAAsBd,GAAtB,EAA2B;AACzB,MAAQzD,KAAR,GAAyEyD,GAAzE,CAAQzD,KAAR;AAAA,MAAeoE,UAAf,GAAyEX,GAAzE,CAAeW,UAAf;AAAA,MAA2BH,MAA3B,GAAyER,GAAzE,CAA2BQ,MAA3B;AAAA,MAAmCN,KAAnC,GAAyEF,GAAzE,CAAmCE,KAAnC;AAAA,MAA0CxC,MAA1C,GAAyEsC,GAAzE,CAA0CtC,MAA1C;AAAA,MAAkD+C,SAAlD,GAAyET,GAAzE,CAAkDS,SAAlD;AAAA,MAA6D1D,OAA7D,GAAyEiD,GAAzE,CAA6DjD,OAA7D;AACA,MAAQc,OAAR,GAAoCH,MAApC,CAAQG,OAAR;AAAA,MAAiBZ,IAAjB,GAAoCS,MAApC,CAAiBT,IAAjB;AAAA,MAAuBW,QAAvB,GAAoCF,MAApC,CAAuBE,QAAvB;AAEArC,KAAG,CAAC,MAAD,EAAS;AAAEwB,WAAO,EAAPA,OAAF;AAAWa,YAAQ,EAARA;AAAX,GAAT,CAAH,CAJyB,CAMzB;;AACA,MAAIK,OAAO,GAAGiC,KAAK,CAACc,eAAN,CAAsB;AAClCzE,SAAK,EAALA,KADkC;AAElCoE,cAAU,EAAVA,UAFkC;AAGlCH,UAAM,EAANA,MAHkC;AAIlCC,aAAS,EAATA,SAJkC;AAKlC1D,WAAO,EAAPA,OALkC;AAMlCa,YAAQ,EAARA,QANkC;AAOlCX,QAAI,EAAJA,IAPkC;AAQlCY,WAAO,EAAPA,OARkC;AASlC+C,MAAE,EAAFA;AATkC,GAAtB,CAAd,CAPyB,CAmBzB;;AACA,MAAIlD,MAAM,CAACN,OAAP,IAAkBM,MAAM,CAACN,OAAP,CAAeY,MAAf,GAAwB,CAA9C,EAAiD;AAC/CpD,KAAC,CAAC+B,IAAF,CAAOe,MAAM,CAACN,OAAd,EAAuB,UAACR,KAAD,EAAQc,MAAR,EAAmB;AACxCsC,SAAG,CAACtC,MAAJ,GAAaA,MAAb;AACAO,aAAO,CAACqC,MAAR,CAAeQ,YAAY,CAACd,GAAD,CAA3B;AACD,KAHD;AAID;;AAED,SAAO/B,OAAP;AACD;;AAED,IAAM2C,EAAE,GAAG;AACTK,QAAM,EAAE9G,mBAAO,CAAC,wCAAD,CADN;AAET+G,SAAO,EAAE/G,mBAAO,CAAC,0CAAD;AAFP,CAAX,C,CAKA;;AACA,SAASgH,QAAT,GAAuE;AAAA,MAArDlG,IAAqD,uEAA9CZ,IAAI,CAACa,UAAyC;AAAA,MAA7BkG,MAA6B,uEAApB,kBAAoB;AACrE3B,WAAS,CAACxE,IAAD,CAAT,CAAgBoG,IAAhB,CACE,UAAA7F,IAAI,EAAI;AACND,OAAG,CAAC,eAAD,EAAkBN,IAAlB,CAAH;AACA,QAAIgE,GAAG,GAAGL,OAAO,CAACpD,IAAD,CAAjB;AACA8F,UAAM,CAACrC,GAAD,EAAMmC,MAAN,CAAN;AACD,GALH,EAME,UAAAvF,GAAG,EAAI;AACLD,SAAK,CAAC,eAAD,EAAkB;AAAEX,UAAI,EAAJA,IAAF;AAAQY,SAAG,EAAHA;AAAR,KAAlB,CAAL;AACD,GARH;AAUD,C,CAED;;;AACA,SAAS0F,MAAT,CAAgB/B,OAAhB,EAAyB;AACvBjE,KAAG,CAAC,YAAD,CAAH;AACAO,IAAE,CAACM,IAAH,CAAQ,iBAAR,EAA2BoF,IAA3B,CAAgC,UAAAtB,KAAK,EAAI;AACvC,WAAOD,eAAe,CAAC;AAAET,aAAO,EAAPA,OAAF;AAAWU,WAAK,EAALA;AAAX,KAAD,CAAtB;AACD,GAFD;AAGD;AAED;AACA;AACA;AACA;AACA;;;AACA,SAASoB,MAAT,QAA0D;AAAA,MAAxC9B,OAAwC,SAAxCA,OAAwC;AAAA,2BAA/B4B,MAA+B;AAAA,MAA/BA,MAA+B,6BAAtB,kBAAsB;AACxD7F,KAAG,CAAC,kBAAD,CAAH;AACA;AACF;AACA;AACA;;AACEa,MAAI,CAAC,iBAAD,CAAJ,CAAwBoF,IAAxB,CAA6B,UAAAtB,KAAK,EAAI;AACpC,QAAM3D,KAAK,GAAG3B,CAAC,CAACwG,MAAD,CAAf;AACA7E,SAAK,CAAC2B,IAAN,CAAW+B,eAAe,CAAC;AAAET,aAAO,EAAPA,OAAF;AAAWU,WAAK,EAALA,KAAX;AAAkB3D,WAAK,EAALA;AAAlB,KAAD,CAA1B;AACAhB,OAAG,CAAC,QAAD,CAAH;AACAa,QAAI,CAAC,oBAAD,CAAJ,CAA2BoF,IAA3B;AACD,GALD;AAMD;;AAEDjH,MAAM,CAACC,OAAP,GAAiB;AACf8G,QAAM,EAANA,MADe;AAEfC,QAAM,EAANA,MAFe;AAGfJ,UAAQ,EAARA,QAHe;AAIfrD,YAAU,EAAVA,UAJe;AAKfC,SAAO,EAAPA;AALe,CAAjB,C;;;;;;;;;;;;;;;;ACjMA,eAAiB5D,mBAAO,CAAC,gCAAD,CAAxB;AAAA,IAAQE,IAAR,YAAQA,IAAR;;AACA,gBAAuBF,mBAAO,CAAC,kCAAD,CAA9B;AAAA,IAAQoB,GAAR,aAAQA,GAAR;AAAA,IAAaK,KAAb,aAAaA,KAAb;;AACA,IAAM6F,UAAU,GAAGtH,mBAAO,CAAC,gDAAD,CAA1B;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;AACA,SAASuH,gBAAT,CAA0BC,GAA1B,EAA+B;AAC7B;AACA,MAAIC,SAAS,GAAG,CAACD,GAAG,CAACE,KAAJ,CAAU,OAAV,KAAsB,EAAvB,EAA2B7D,MAA3C;AACA,MAAI8D,UAAU,GAAG,CAACH,GAAG,CAACE,KAAJ,CAAU,SAAV,KAAwB,EAAzB,EAA6B7D,MAA9C;;AAEA,OAAK,IAAI+D,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,SAAS,GAAGE,UAAhC,EAA4CC,CAAC,EAA7C,EAAiD;AAC/CJ,OAAG,IAAI,MAAP;AACD,GAP4B,CAS7B;;;AACA,MAAMK,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,WAAvB,CAAZ;AACAF,KAAG,CAACG,SAAJ,GAAgBR,GAAhB;AACAA,KAAG,GAAGK,GAAG,CAACG,SAAV;AACA,SAAOR,GAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASS,UAAT,OAAiD;AAAA,MAA3B7F,KAA2B,QAA3BA,KAA2B;AAAA,MAApBiD,OAAoB,QAApBA,OAAoB;AAAA,MAAX7E,OAAW,QAAXA,OAAW;AAC/C,MAAMwC,QAAQ,GAAGqC,OAAO,CAAC,CAAD,CAAP,CAAWvC,IAAX,CAAgBE,QAAjC;AACA,MAAM2B,QAAQ,GAAGuD,cAAc,CAAC7C,OAAD,CAA/B;AAEAiC,YAAU,CAAC;AACThH,SAAK,EAAE0C,QADE;AAETzC,QAAI,EAAEoE,QAFG;AAGTnE,WAAO,EAAPA;AAHS,GAAD,CAAV,CAIG0G,IAJH,CAKE,UAAAiB,GAAG,EAAI;AACL,QAAIA,GAAG,CAAC1G,KAAJ,IAAa0G,GAAG,CAACC,MAArB,EAA6B;AAC3B3G,WAAK,CAAC0G,GAAG,CAAC1G,KAAJ,IAAa0G,GAAG,CAACC,MAAlB,CAAL;AACA;AACD;;AACDhH,OAAG,CAAC,QAAD,EAAW+G,GAAX,CAAH;;AACA,oBAAqBnI,mBAAO,CAAC,4CAAD,CAA5B;AAAA,QAAQgH,QAAR,aAAQA,QAAR;;AACAA,YAAQ,CAAChE,QAAD,EAAWZ,KAAX,CAAR;AACD,GAbH,EAcE,UAAAV,GAAG;AAAA,WAAID,KAAK,CAACC,GAAD,CAAT;AAAA,GAdL;AAgBD;AAED;AACA;AACA;;;AACA,SAASwG,cAAT,CAAwB7C,OAAxB,EAAiC;AAC/B,MAAItB,IAAI,GAAG,EAAX;AACAtD,GAAC,CAAC+B,IAAF,CAAO6C,OAAP,EAAgB,UAAC5C,KAAD,EAAQC,KAAR,EAAkB;AAChCqB,QAAI,IAAIsE,UAAU,CAAC3F,KAAD,CAAlB;AACD,GAFD;AAIAqB,MAAI,iEAGasB,OAAO,CAACxB,MAHrB,kCAIeyE,SAAS,EAJxB,6BAKUpI,IAAI,CAACqI,UALf,kDASJxE,IATI,+BAAJ;AAaA,SAAOA,IAAP;AACD;;AAED,SAASsE,UAAT,CAAoB3F,KAApB,EAA2B;AACzB,MAAQE,OAAR,GAAmCF,KAAnC,CAAQE,OAAR;AAAA,MAAiBE,IAAjB,GAAmCJ,KAAnC,CAAiBI,IAAjB;AAAA,MAAuBG,OAAvB,GAAmCP,KAAnC,CAAuBO,OAAvB;AACA,MAAMuF,QAAQ,GAAG5E,OAAO,CAACd,IAAD,CAAxB;AAEA,MAAI2F,UAAU,GAAG,EAAjB;AACAhI,GAAC,CAAC+B,IAAF,CAAOS,OAAP,EAAgB,UAACR,KAAD,EAAQc,MAAR,EAAmB;AACjCkF,cAAU,IAAIC,WAAW,CAACnF,MAAD,CAAzB;AACD,GAFD;AAIA,MAAMQ,IAAI,gCACOnB,OAAO,IAAI,QADlB,6CAEc4F,QAFd,gBAGVC,UAHU,sCAKK7F,OAAO,IAAI,QALhB,SAAV;AAOA,SAAOmB,IAAP;AACD;;AAED,SAAS2E,WAAT,CAAqBnF,MAArB,EAAyC;AAAA,MAAZoF,MAAY,uEAAH,CAAG;AACvC,MAAQlF,QAAR,GAA6CF,MAA7C,CAAQE,QAAR;AAAA,MAAkBX,IAAlB,GAA6CS,MAA7C,CAAkBT,IAAlB;AAAA,MAAwBG,OAAxB,GAA6CM,MAA7C,CAAwBN,OAAxB;AAAA,MAAiCS,OAAjC,GAA6CH,MAA7C,CAAiCG,OAAjC;AACA,MAAM8E,QAAQ,GAAG5E,OAAO,CAACd,IAAD,CAAxB;AAEA,MAAI8F,SAAS,GAAG,EAAhB;;AACA,OAAK,IAAIhB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGe,MAApB,EAA4Bf,CAAC,EAA7B;AAAiCgB,aAAS,IAAI,IAAb;AAAjC;;AAEA,MAAIC,KAAK,GAAG,EAAZ;;AACA,MAAI5F,OAAO,IAAIA,OAAO,CAACY,MAAR,GAAiB,CAAhC,EAAmC;AACjCpD,KAAC,CAAC+B,IAAF,CAAOS,OAAP,EAAgB,UAACR,KAAD,EAAQc,MAAR,EAAmB;AACjCsF,WAAK,IAAIH,WAAW,CAACnF,MAAD,EAASoF,MAAM,GAAG,CAAlB,CAApB;AACD,KAFD;AAGD;;AAED,MAAI5E,IAAI,eACR6E,SADQ,+BACsBnF,QAAQ,IAAI,QADlC,mBAERmF,SAFQ,wCAE6BJ,QAF7B,gBAGRI,SAHQ,qEAKRrB,gBAAgB,CAAC7D,OAAD,CALR,qCAORkF,SAPQ,oBAOWC,KAPX,eAQRD,SARQ,oBASRA,SATQ,6BASoBnF,QAAQ,IAAI,QAThC,WAAR;AAYA,SAAOM,IAAP;AACD;AAED;AACA;AACA;AACA;;;AACA,SAASH,OAAT,CAAiBd,IAAjB,EAAuB;AACrB;AACA,MAAI0F,QAAQ,GAAG,EAAf;AAEA/H,GAAC,CAAC+B,IAAF,CAAOM,IAAP,EAAa,UAACgG,GAAD,EAAMC,GAAN,EAAc;AACzB,QAAIC,MAAM,GACR,UAAUF,GAAG,CAAC7E,OAAJ,CAAY,kBAAZ,EAAgC,SAAhC,EAA2CgF,WAA3C,EADZ;AAEAT,YAAQ,CAAC7F,IAAT,WAAiBqG,MAAjB,gBAA4BD,GAA5B;AACD,GAJD,EAJqB,CAUrB;;AACA,MAAIG,SAAS,GAAG,EAAhB;AACA,MAAIC,YAAY,GAAGC,MAAM,CAACC,IAAP,CAAYC,CAAZ,EAAeC,IAAf,EAAnB;;AAZqB,6CAaTJ,YAbS;AAAA;;AAAA;AAarB,wDAA0B;AAArBL,SAAqB;AACxBI,eAAS,CAACJ,GAAD,CAAT,GAAiBN,QAAQ,CAACM,GAAD,CAAzB;AACD;AAfoB;AAAA;AAAA;AAAA;AAAA;;AAgBrBN,UAAQ,GAAGU,SAAX;AAEAV,UAAQ,GAAGA,QAAQ,CAACgB,IAAT,CAAc,GAAd,CAAX;AAEA,SAAOhB,QAAP;AACD;;AAED,SAASF,SAAT,GAAqB;AACnB,SAAO,IAAImB,IAAJ,GAAWC,WAAX,EAAP;AACD;;AAED,SAASC,SAAT,CAAmB/D,EAAnB,EAAuBgE,QAAvB,EAAiC;AAC/BhE,IAAE,GAAGA,EAAE,CAACH,KAAH,CAAS,GAAT,CAAL;AACA,MAAIG,EAAE,CAAC/B,MAAH,GAAY+F,QAAhB,EAA0B,OAAO,IAAP;AAC1B,SAAO,KAAP;AACD;AAED;AACA;AACA;;;AACA,SAASC,YAAT,QAOG;AAAA,MANDxE,OAMC,SANDA,OAMC;AAAA,4BALDzC,OAKC;AAAA,MALDA,OAKC,8BALS,GAKT;AAAA,MAJDa,QAIC,SAJDA,QAIC;AAAA,MAHDC,OAGC,SAHDA,OAGC;AAAA,yBAFDZ,IAEC;AAAA,MAFDA,IAEC,2BAFM,EAEN;AAAA,MADDV,KACC,SADDA,KACC;AACD,MAAQuC,QAAR,GAAqBU,OAArB,CAAQV,QAAR,CADC,CAED;;AACA/B,SAAO,GAAG4C,MAAM,CAAC5C,OAAD,CAAhB;AACAA,SAAO;AACP,MAAMF,KAAK,GAAGiC,QAAQ,CAAC/B,OAAD,CAAtB;;AAEA,WAASkH,aAAT,QAAyDC,IAAzD,EAA+D;AAAA,QAAtCtG,QAAsC,SAAtCA,QAAsC;AAAA,QAA5BC,OAA4B,SAA5BA,OAA4B;AAAA,2BAAnBZ,IAAmB;AAAA,QAAnBA,IAAmB,2BAAZ,EAAY;AAC7D,QAAIkH,UAAU,GAAGD,IAAI,CAAC9G,OAAtB;AACAxC,KAAC,CAAC+B,IAAF,CAAOwH,UAAP,EAAmB,UAACvH,KAAD,EAAQiD,IAAR,EAAiB;AAClC,UAAIA,IAAI,CAACjC,QAAL,KAAkBA,QAAtB,EAAgC;AAC9B,YAAIC,OAAJ,EAAa;AACXgC,cAAI,CAAChC,OAAL,GAAeA,OAAf;AACAgC,cAAI,CAAC5C,IAAL,CAAUmH,QAAV,GAAqB/J,IAAI,CAACqI,UAA1B;AACA7C,cAAI,CAAC5C,IAAL,CAAUoH,UAAV,GAAuB5B,SAAS,EAAhC;AACD;;AACD,YAAIxF,IAAJ,EAAU;AACR4C,cAAI,CAAC5C,IAAL,GAAYrC,CAAC,CAACsC,MAAF,CAAS,EAAT,EAAa2C,IAAI,CAAC5C,IAAlB,EAAwBA,IAAxB,CAAZ;AACD;AACF,OATD,MASO,IAAI4C,IAAI,CAACzC,OAAT,EAAkB;AACvB6G,qBAAa,CAAC;AAAErG,kBAAQ,EAARA,QAAF;AAAYC,iBAAO,EAAPA;AAAZ,SAAD,EAAwBgC,IAAxB,CAAb;AACD;AACF,KAbD;AAcD;;AAEDoE,eAAa,CAAC;AAAErG,YAAQ,EAARA,QAAF;AAAYX,QAAI,EAAJA,IAAZ;AAAkBY,WAAO,EAAPA;AAAlB,GAAD,EAA8BhB,KAA9B,CAAb;AAEAtB,KAAG,CAAC,eAAD,EAAkB;AAAEwB,WAAO,EAAPA,OAAF;AAAWa,YAAQ,EAARA,QAAX;AAAqBC,WAAO,EAAPA;AAArB,GAAlB,CAAH;AACAuE,YAAU,CAAC;AACT7F,SAAK,EAALA,KADS;AAETiD,WAAO,EAAEV,QAFA;AAGTnE,WAAO,qCAA8BoC,OAA9B,uBAAkDa,QAAlD;AAHE,GAAD,CAAV;AAKD;AAED;AACA;AACA;;;AACA,SAAS0G,SAAT,QAAyD;AAAA,MAApC9E,OAAoC,SAApCA,OAAoC;AAAA,MAA3BzC,OAA2B,SAA3BA,OAA2B;AAAA,MAAlBc,OAAkB,SAAlBA,OAAkB;AAAA,MAATtB,KAAS,SAATA,KAAS;AACvD,MAAQuC,QAAR,GAAqBU,OAArB,CAAQV,QAAR;AACA/B,SAAO,GAAG4C,MAAM,CAAC5C,OAAD,CAAhB;AACAA,SAAO;AAEP+B,UAAQ,CAAC/B,OAAD,CAAR,CAAkBK,OAAlB,CAA0BN,IAA1B,CAA+B;AAC7BG,QAAI,EAAE;AACJsH,gBAAU,EAAElK,IAAI,CAACqI,UADb;AAEJ0B,cAAQ,EAAE/J,IAAI,CAACqI,UAFX;AAGJ8B,iBAAW,EAAE/B,SAAS,EAHlB;AAIJ4B,gBAAU,EAAE5B,SAAS;AAJjB,KADuB;AAO7B5E,WAAO,EAAPA;AAP6B,GAA/B;AAUAtC,KAAG,CAAC,YAAD,EAAe;AAAEwB,WAAO,EAAPA,OAAF;AAAWc,WAAO,EAAPA;AAAX,GAAf,CAAH;AAEAuE,YAAU,CAAC;AACT7F,SAAK,EAALA,KADS;AAETiD,WAAO,EAAEV,QAFA;AAGTnE,WAAO,4CAAqCoC,OAArC;AAHE,GAAD,CAAV;AAKD;AAED;AACA;AACA;;;AACA,SAAS0H,QAAT,QAAwE;AAAA,MAApDjF,OAAoD,SAApDA,OAAoD;AAAA,4BAA3CzC,OAA2C;AAAA,MAA3CA,OAA2C,8BAAjC,GAAiC;AAAA,MAA5Ba,QAA4B,SAA5BA,QAA4B;AAAA,MAAlBC,OAAkB,SAAlBA,OAAkB;AAAA,MAATtB,KAAS,SAATA,KAAS;AACtE,MAAQuC,QAAR,GAAqBU,OAArB,CAAQV,QAAR,CADsE,CAEtE;;AACA,MAAIlB,QAAQ,KAAK,GAAjB,EAAsB;AACpB,WAAO0G,SAAS,CAAC;AAAE9E,aAAO,EAAPA,OAAF;AAAWzC,aAAO,EAAPA,OAAX;AAAoBc,aAAO,EAAPA;AAApB,KAAD,CAAhB;AACD;;AAEDd,SAAO,GAAG4C,MAAM,CAAC5C,OAAD,CAAhB;AACAA,SAAO;AAEP,MAAMF,KAAK,GAAGiC,QAAQ,CAAC/B,OAAD,CAAtB;;AAEA,WAASkH,aAAT,QAA8CC,IAA9C,EAAoD;AAAA,QAA3BtG,QAA2B,SAA3BA,QAA2B;AAAA,QAAjBC,OAAiB,SAAjBA,OAAiB;AAClD,QAAIsG,UAAU,GAAGD,IAAI,CAAC9G,OAAtB;AACAxC,KAAC,CAAC+B,IAAF,CAAOwH,UAAP,EAAmB,UAACvH,KAAD,EAAQiD,IAAR,EAAiB;AAClC,UAAIA,IAAI,CAACjC,QAAL,KAAkBA,QAAtB,EAAgC;AAC9BiC,YAAI,CAACzC,OAAL,GAAeyC,IAAI,CAACzC,OAAL,IAAgB,EAA/B;AACAyC,YAAI,CAACzC,OAAL,CAAaN,IAAb,CAAkB;AAChBG,cAAI,EAAE;AACJsH,sBAAU,EAAElK,IAAI,CAACqI,UADb;AAEJ0B,oBAAQ,EAAE/J,IAAI,CAACqI,UAFX;AAGJ8B,uBAAW,EAAE/B,SAAS,EAHlB;AAIJ4B,sBAAU,EAAE5B,SAAS;AAJjB,WADU;AAOhB5E,iBAAO,EAAPA;AAPgB,SAAlB;AASD,OAXD,MAWO,IAAIgC,IAAI,CAACzC,OAAT,EAAkB;AACvB6G,qBAAa,CAAC;AAAErG,kBAAQ,EAARA,QAAF;AAAYC,iBAAO,EAAPA;AAAZ,SAAD,EAAwBgC,IAAxB,CAAb;AACD;AACF,KAfD;AAgBD;;AAEDoE,eAAa,CAAC;AAAErG,YAAQ,EAARA,QAAF;AAAYC,WAAO,EAAPA;AAAZ,GAAD,EAAwBhB,KAAxB,CAAb;AAEAtB,KAAG,CAAC,WAAD,EAAc;AAAEwB,WAAO,EAAPA,OAAF;AAAWa,YAAQ,EAARA,QAAX;AAAqBC,WAAO,EAAPA;AAArB,GAAd,CAAH;AAEAuE,YAAU,CAAC;AACT7F,SAAK,EAALA,KADS;AAETiD,WAAO,EAAEV,QAFA;AAGTnE,WAAO,2CAAoCoC,OAApC,uBAAwDa,QAAxD;AAHE,GAAD,CAAV;AAKD;;AAEDrD,MAAM,CAACC,OAAP,GAAiB;AACfiK,UAAQ,EAARA,QADe;AAEfC,UAAQ,EAAED,QAFK;AAGfH,WAAS,EAATA,SAHe;AAIfK,WAAS,EAAEL,SAJI;AAKfN,cAAY,EAAZA,YALe,CAMf;;AANe,CAAjB,C;;;;;;UC9RA;UACA;;UAEA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;UACA;;UAEA;UACA;;UAEA;UACA;UACA;;;;;;;;;;ACtBA;AACA;AACA;AACA;AACA;AACA;;AAEA,IAAMzI,GAAG,GAAGpB,mBAAO,CAAC,yCAAD,CAAnB;;AACA,eAAiBA,mBAAO,CAAC,uCAAD,CAAxB;AAAA,IAAQiC,IAAR,YAAQA,IAAR;;AAEAN,EAAE,CAAC8I,MAAH,CAAUC,KAAV,CACE,CAAC,eAAD,EAAkB,gBAAlB,EAAoC,gBAApC,CADF,EAEE,YAAY;AACV;AACA,MAAMC,IAAI,GAAG;AACX7D,UAAM,EAAE9G,mBAAO,CAAC,+CAAD,CADJ;AAEX4K,YAAQ,EAAE5K,mBAAO,CAAC,mDAAD,CAFN;AAGX+G,WAAO,EAAE/G,mBAAO,CAAC,iDAAD;AAHL,GAAb;AAMA+E,QAAM,CAACC,SAAP,GAAmBvE,CAAC,CAACsC,MAAF,CAAS,EAAT,EAAagC,MAAM,CAACC,SAApB,EAA+B2F,IAA/B,CAAnB;AACA1I,MAAI,CAAC,WAAD,CAAJ,CAAkBoF,IAAlB,CAAuBsD,IAAvB;AACAvJ,KAAG,CAACA,GAAJ,CAAQ,QAAR;AACD,CAbH,E","file":"core.js","sourcesContent":["const { api, conf, editToken } = require('./mw')\r\n\r\nmodule.exports = ({ title, text, summary }) => {\r\n  return $.post(api, {\r\n    format: 'json',\r\n    action: 'edit',\r\n    token: editToken,\r\n    title,\r\n    text,\r\n    summary,\r\n  })\r\n}\r\n","const { api, conf } = require('./mw')\r\n\r\nmodule.exports = (page = conf.wgPageName) => {\r\n  return $.get(api, {\r\n    format: 'json',\r\n    action: 'parse',\r\n    prop: 'text|wikitext',\r\n    disabletoc: 1,\r\n    disableeditsection: 1,\r\n    page,\r\n  })\r\n}\r\n","function log(...data) {\r\n  console.info('[WikiForum] [INFO]', ...data)\r\n}\r\n\r\nfunction warn(...data) {\r\n  console.warn('[WikiForum] [WARN]', ...data)\r\n}\r\n\r\nfunction error(...data) {\r\n  console.error('[WikiForum] [ERR]', ...data)\r\n}\r\n\r\nmodule.exports = {\r\n  log,\r\n  info: log,\r\n  warn,\r\n  error,\r\n  err: error,\r\n}\r\n","module.exports = {\r\n  api: mw.util.wikiScript('api'),\r\n  conf: mw.config.get(),\r\n  editToken: mw.user.tokens.get('csrfToken') || mw.user.tokens.get('editToken'),\r\n  hook: mw.hook,\r\n  util: mw.util,\r\n}\r\n","const { log } = require('./log')\r\n\r\n/**\r\n * @function parseForums 从源代码解析可能存在的全部主题\r\n * @param {Element} code\r\n * @param {String} title\r\n */\r\nfunction parseForums(code, title) {\r\n  var $root = $(code)\r\n  var forums = []\r\n\r\n  if (!$root.hasClass('wiki-forum')) {\r\n    $root = $root.find('.wiki-forum')\r\n  }\r\n\r\n  $root.each((index, forum) => {\r\n    forums.push({\r\n      forumid: String(index + 1),\r\n      meta: $.extend({}, $(forum).data(), { pageName: title }),\r\n      threads: parseThreads(forum),\r\n    })\r\n  })\r\n  return forums\r\n}\r\n\r\n/**\r\n * @function parseThreads 递归全部的帖子\r\n * @param {Element} forum\r\n * @param {String} prefix\r\n */\r\nfunction parseThreads(forum, prefix = '') {\r\n  var $forum = $(forum)\r\n  if (prefix) prefix += '-'\r\n  var threads = []\r\n  $threads = getThreads($forum)\r\n  $.each($threads, (index, thread) => {\r\n    var threadObj = {\r\n      threadid: String(prefix + (index + 1)),\r\n      content: getContent(thread),\r\n      meta: getMeta(thread),\r\n    }\r\n    if (getThreads(thread).length > 0) {\r\n      threadObj.threads = parseThreads(thread, threadObj.threadid)\r\n    }\r\n    threads.push(threadObj)\r\n  })\r\n  return threads\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子可能存在的回复的结构\r\n * @param {Element} thread\r\n */\r\nfunction getThreads(thread) {\r\n  var $thread = $(thread)\r\n  return $thread.find('> .forum-thread')\r\n}\r\n\r\n/**\r\n * @function getContent 获取帖子内容\r\n * @param {Element} thread\r\n */\r\nfunction getContent(thread) {\r\n  var $thread = $(thread)\r\n  var content = $thread.find('> .forum-content').html() || ''\r\n  content = content\r\n    .trim()\r\n    .replace(/^<!--\\s*?start\\s+?content\\s*?-->/, '')\r\n    .replace(/<!--\\s*?end\\s+?content\\s*?-->$/, '')\r\n    .replace(/^\\n/, '')\r\n    .replace(/\\n$/, '')\r\n\r\n  return content\r\n}\r\n\r\n/**\r\n * @function getMeta 获取帖子的源信息\r\n * @param {Element} thread\r\n */\r\nfunction getMeta(thread) {\r\n  var $thread = $(thread)\r\n  var $data = $thread.data()\r\n\r\n  return $data\r\n}\r\n\r\n/**\r\n * @function getUser 获取帖子发帖者信息\r\n * @param {Element} thread\r\n */\r\nfunction getUser(thread) {\r\n  var $thread = $(thread)\r\n  var author = $thread.data('userAuthor') || ''\r\n  var last = $thread.data('userLast') || author\r\n  return { author, last }\r\n}\r\n\r\n/**\r\n * @function getTime 获取帖子发帖时间信息\r\n * @param {Element} thread\r\n */\r\nfunction getTime(thread) {\r\n  var $thread = $(thread)\r\n  var publish = $thread.data('timePublish') || ''\r\n  var modify = $thread.data('timeModify') || publish\r\n  return { publish, modify }\r\n}\r\n\r\n/**\r\n * @module fromApi 解析 MediaWiki API 返回的信息\r\n * @param {Object} data 来自 API 的结果：api.php?action=parse&prop=wikitext|text&page=<pageName>\r\n */\r\nfunction fromApi(data) {\r\n  var title = data.parse.title\r\n  var wikitext = data.parse.wikitext['*']\r\n  var html = data.parse.text['*']\r\n\r\n  // 防止输出没有根元素\r\n  var $wikitext = $('<div>' + wikitext + '</div>')\r\n  var $html = $('<div>' + html + '</div>')\r\n\r\n  // 高版本输出自带根元素，低版本没有\r\n  if ($html.find('> .mw-parser-output').length > 0) {\r\n    $html = $html.find('> .mw-parser-output')\r\n  }\r\n\r\n  var Obj = {\r\n    wikitext: parseForums($wikitext, title),\r\n    html: parseForums($html, title),\r\n  }\r\n\r\n  // 缓存全部forum\r\n  window.WikiForum = window.WikiForum || {}\r\n  window.WikiForum.cache = window.WikiForum.cache || {}\r\n  window.WikiForum.cache.pages = window.WikiForum.cache.pages || {}\r\n  window.WikiForum.cache.pages[title] = Obj\r\n\r\n  return Obj\r\n}\r\n\r\n/**\r\n * @module fromHtml 从 HTML 源代码解析\r\n * @param {String|Element} code\r\n */\r\nfunction fromHtml(code, title = '') {\r\n  var $code = $(code)\r\n  var forumEl = parseForums($code)\r\n  return forumEl\r\n}\r\n\r\nmodule.exports = {\r\n  fromApi,\r\n  fromHtml,\r\n}\r\n","const { fromApi } = require('./parser')\r\nconst actionGet = require('./actionGet')\r\nconst { util, hook, conf } = require('./mw')\r\nconst { log, error } = require('./log')\r\n\r\n// 获取帖子元素\r\nfunction getThread({ forumEl, forumid = '1', threadid }) {\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  var forum = forumEl[forumid]\r\n\r\n  threadid = threadid.split('-')\r\n  $.each(threadid, (index, item) => {\r\n    item = Number(item)\r\n    item--\r\n    threadid[index] = item\r\n  })\r\n\r\n  // 开始递归 threads\r\n  var thread = forum\r\n  $.each(threadid, (_, id) => {\r\n    log('thread', thread.threads[id])\r\n    thread = thread.threads[id]\r\n  })\r\n\r\n  return thread\r\n}\r\n\r\n// 获取帖子内容\r\nfunction getContent(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.content\r\n}\r\n\r\n// 获取帖子元信息\r\nfunction getMeta(ctx) {\r\n  var thread = getThread(ctx)\r\n  return thread.meta\r\n}\r\n\r\n// 递归全部主题\r\nfunction renderAllForums({ forumEl, theme, $root }) {\r\n  log('开始渲染全部论坛')\r\n  const { html } = forumEl\r\n  let $allForums = theme.allForumsContainer()\r\n\r\n  if (html.length < 1) {\r\n    if (theme.noForumContainer) {\r\n      $allForums.append(theme.noForumContainer())\r\n    }\r\n  } else {\r\n    $.each(html, (index, forum) => {\r\n      log('递归渲染主题', `${index + 1}/${html.length}`)\r\n      $allForums.append(\r\n        renderForum({\r\n          $root,\r\n          _forum: forumEl,\r\n          forumMeta: forum.meta,\r\n          forumid: forum.forumid,\r\n          forum,\r\n          theme,\r\n        }),\r\n        theme.afterAllForums\r\n          ? theme.afterAllForums({\r\n              $root,\r\n              $container: $allForums,\r\n              _forum: forumEl,\r\n              forumMeta: forum.meta,\r\n              forumid: forum.forumid,\r\n              fn,\r\n            })\r\n          : ''\r\n      )\r\n    })\r\n  }\r\n\r\n  return $allForums\r\n}\r\n\r\n// 渲染单个主题\r\nfunction renderForum(ctx) {\r\n  const { $root, $container, _forum, forum, forumMeta, forumid, theme } = ctx\r\n\r\n  let $forum = theme.forumContainer({ meta: forumMeta })\r\n\r\n  $.each(forum.threads, (index, thread) => {\r\n    $forum.append(\r\n      renderThread({\r\n        $root,\r\n        $container: $forum,\r\n        _forum,\r\n        theme,\r\n        thread,\r\n        forumMeta,\r\n        forumid,\r\n      })\r\n    )\r\n  })\r\n\r\n  if (theme.afterForum) {\r\n    $forum.append(\r\n      theme.afterForum({\r\n        $root,\r\n        $container,\r\n        _forum,\r\n        forumMeta,\r\n        forumid,\r\n        fn,\r\n      })\r\n    )\r\n  }\r\n\r\n  return $forum\r\n}\r\n\r\n// 渲染单个帖子\r\nfunction renderThread(ctx) {\r\n  const { $root, $container, _forum, theme, thread, forumMeta, forumid } = ctx\r\n  const { content, meta, threadid } = thread\r\n\r\n  log('渲染贴子', { forumid, threadid })\r\n\r\n  // 缓存帖子对象\r\n  let $thread = theme.threadContainer({\r\n    $root,\r\n    $container,\r\n    _forum,\r\n    forumMeta,\r\n    forumid,\r\n    threadid,\r\n    meta,\r\n    content,\r\n    fn,\r\n  })\r\n\r\n  // 如果有回复，处理回复\r\n  if (thread.threads && thread.threads.length > 0) {\r\n    $.each(thread.threads, (index, thread) => {\r\n      ctx.thread = thread\r\n      $thread.append(renderThread(ctx))\r\n    })\r\n  }\r\n\r\n  return $thread\r\n}\r\n\r\nconst fn = {\r\n  parser: require('./parser'),\r\n  updater: require('./updater'),\r\n}\r\n\r\n// 从页面加载内容，并渲染到根元素\r\nfunction fromPage(page = conf.wgPageName, target = '#mw-content-text') {\r\n  actionGet(page).then(\r\n    data => {\r\n      log('成功从 API 获取源代码', page)\r\n      var Obj = fromApi(data)\r\n      toPage(Obj, target)\r\n    },\r\n    err => {\r\n      error('从 API 获取源代码失败', { page, err })\r\n    }\r\n  )\r\n}\r\n\r\n// 渲染返回HTML对象\r\nfunction toHtml(forumEl) {\r\n  log('渲染并返回 HTML')\r\n  mw.hook('WikiForum.theme').fire(theme => {\r\n    return renderAllForums({ forumEl, theme })\r\n  })\r\n}\r\n\r\n/**\r\n * @module toPage 从 WikiForum-Element 渲染到根元素\r\n * @param {Object} forumEl WikiForum-Element\r\n * @param {String|Element} target 渲染的根元素\r\n */\r\nfunction toPage({ forumEl, target = '#mw-content-text' }) {\r\n  log('准备渲染到页面，等待主题文件……')\r\n  /**\r\n   * 触发主题函数\r\n   * @param {Functon} theme 返回的主题渲染器\r\n   */\r\n  hook('WikiForum.theme').fire(theme => {\r\n    const $root = $(target)\r\n    $root.html(renderAllForums({ forumEl, theme, $root }))\r\n    log('页面渲染完毕')\r\n    hook('WikiForum.renderer').fire()\r\n  })\r\n}\r\n\r\nmodule.exports = {\r\n  toPage,\r\n  toHtml,\r\n  fromPage,\r\n  getContent,\r\n  getMeta,\r\n}\r\n","const { conf } = require('./mw')\r\nconst { log, error } = require('./log')\r\nconst actionEdit = require('./actionEdit')\r\n\r\n/**\r\n * @module updater 更新器\r\n *\r\n * @description\r\n * 为了避免老版本jQuery的XSS漏洞\r\n * forumEl->wikitext的过程采用String拼接的方式\r\n */\r\n\r\n/**\r\n * @function contentValidator 检查字符串的HTML标签是否匹配，wikitext是否闭合\r\n * @param {String} str\r\n */\r\nfunction contentValidator(str) {\r\n  // Trying to fix wikitext\r\n  var openTable = (str.match(/\\{\\|/g) || []).length\r\n  var closeTable = (str.match(/\\n\\|\\}/g) || []).length\r\n\r\n  for (let i = 0; i < openTable - closeTable; i++) {\r\n    str += '\\n|}'\r\n  }\r\n\r\n  // fix HTML\r\n  const div = document.createElement('container')\r\n  div.innerHTML = str\r\n  str = div.innerHTML\r\n  return str\r\n}\r\n\r\n/**\r\n * @function handleEdit 处理forumEl并发布\r\n * @param {Object} forumEl\r\n */\r\nfunction handleEdit({ $root, forumEl, summary }) {\r\n  const pageName = forumEl[0].meta.pageName\r\n  const wikitext = parseAllForums(forumEl)\r\n\r\n  actionEdit({\r\n    title: pageName,\r\n    text: wikitext,\r\n    summary,\r\n  }).then(\r\n    ret => {\r\n      if (ret.error || ret.errors) {\r\n        error(ret.error || ret.errors)\r\n        return\r\n      }\r\n      log('更新论坛成功', ret)\r\n      const { fromPage } = require('./renderer')\r\n      fromPage(pageName, $root)\r\n    },\r\n    err => error(err)\r\n  )\r\n}\r\n\r\n/**\r\n * @function parseAllForums\r\n */\r\nfunction parseAllForums(forumEl) {\r\n  var html = ''\r\n  $.each(forumEl, (index, forum) => {\r\n    html += parseForum(forum)\r\n  })\r\n\r\n  html = `<!--\r\n - WikiForum Container\r\n - \r\n - Total Forums: ${forumEl.length}\r\n - Last modiflied: ${timeStamp()}\r\n - Last user: ${conf.wgUserName}\r\n -\r\n - DO NOT EDIT DIRECTLY\r\n -->\r\n${html}\r\n\r\n<!-- end WikiForum -->`\r\n\r\n  return html\r\n}\r\n\r\nfunction parseForum(forum) {\r\n  const { forumid, meta, threads } = forum\r\n  const metaList = getMeta(meta)\r\n\r\n  var threadList = ''\r\n  $.each(threads, (index, thread) => {\r\n    threadList += parseThread(thread)\r\n  })\r\n\r\n  const html = `\r\n<!-- start forum#${forumid || 'latest'} -->\r\n<div class=\"wiki-forum\" ${metaList}>\r\n${threadList}\r\n</div>\r\n<!-- end forum#${forumid || 'latest'} -->`\r\n\r\n  return html\r\n}\r\n\r\nfunction parseThread(thread, indent = 0) {\r\n  const { threadid, meta, threads, content } = thread\r\n  const metaList = getMeta(meta)\r\n\r\n  var indentStr = ''\r\n  for (let i = 0; i < indent; i++) indentStr += '  '\r\n\r\n  var reply = ''\r\n  if (threads && threads.length > 0) {\r\n    $.each(threads, (index, thread) => {\r\n      reply += parseThread(thread, indent + 1)\r\n    })\r\n  }\r\n\r\n  var html = `\r\n${indentStr}<!-- start thread#${threadid || 'latest'} -->\r\n${indentStr}<ul class=\"forum-thread\" ${metaList}>\r\n${indentStr}  <li class=\"forum-content\">\r\n<!-- start content -->\r\n${contentValidator(content)}\r\n<!-- end content -->\r\n${indentStr}  </li>${reply}\r\n${indentStr}</ul>\r\n${indentStr}<!-- end thread#${threadid || 'latest'} -->\r\n`\r\n\r\n  return html\r\n}\r\n\r\n/**\r\n * @function getMeta 将meta转换为 data-*=\"\" 字符串\r\n * @param {Object} meta jQuery.data()\r\n */\r\nfunction getMeta(meta) {\r\n  // 将 fooBar 转换为 foo-bar 的形式\r\n  var metaList = []\r\n\r\n  $.each(meta, (key, val) => {\r\n    let newKey =\r\n      'data-' + key.replace(/(.*)([A-Z])(.*)/g, '$1-$2$3').toLowerCase()\r\n    metaList.push(`${newKey}=\"${val}\"`)\r\n  })\r\n\r\n  // 确保data的顺序是固定的\r\n  var metaList1 = {}\r\n  var metaListKeys = Object.keys(a).sort()\r\n  for (key of metaListKeys) {\r\n    metaList1[key] = metaList[key]\r\n  }\r\n  metaList = metaList1\r\n\r\n  metaList = metaList.join(' ')\r\n\r\n  return metaList\r\n}\r\n\r\nfunction timeStamp() {\r\n  return new Date().toISOString()\r\n}\r\n\r\nfunction isComplex(id, depthMax) {\r\n  id = id.split('-')\r\n  if (id.length > depthMax) return true\r\n  return false\r\n}\r\n\r\n/**\r\n * @function updateThread 编辑内容\r\n */\r\nfunction updateThread({\r\n  forumEl,\r\n  forumid = '1',\r\n  threadid,\r\n  content,\r\n  meta = {},\r\n  $root,\r\n}) {\r\n  const { wikitext } = forumEl\r\n  // 将 id 调整为程序可读的 index\r\n  forumid = Number(forumid)\r\n  forumid--\r\n  const forum = wikitext[forumid]\r\n\r\n  function findAndUpdate({ threadid, content, meta = {} }, base) {\r\n    var allThreads = base.threads\r\n    $.each(allThreads, (index, item) => {\r\n      if (item.threadid === threadid) {\r\n        if (content) {\r\n          item.content = content\r\n          item.meta.userLast = conf.wgUserName\r\n          item.meta.timeModify = timeStamp()\r\n        }\r\n        if (meta) {\r\n          item.meta = $.extend({}, item.meta, meta)\r\n        }\r\n      } else if (item.threads) {\r\n        findAndUpdate({ threadid, content }, item)\r\n      }\r\n    })\r\n  }\r\n\r\n  findAndUpdate({ threadid, meta, content }, forum)\r\n\r\n  log('Update thread', { forumid, threadid, content })\r\n  handleEdit({\r\n    $root,\r\n    forumEl: wikitext,\r\n    summary: `[WikiForum] Modify forum#${forumid} > thread#${threadid}`,\r\n  })\r\n}\r\n\r\n/**\r\n * @function addThread 盖新楼，回复楼主\r\n */\r\nfunction addThread({ forumEl, forumid, content, $root }) {\r\n  const { wikitext } = forumEl\r\n  forumid = Number(forumid)\r\n  forumid--\r\n\r\n  wikitext[forumid].threads.push({\r\n    meta: {\r\n      userAuthor: conf.wgUserName,\r\n      userLast: conf.wgUserName,\r\n      timePublish: timeStamp(),\r\n      timeModify: timeStamp(),\r\n    },\r\n    content,\r\n  })\r\n\r\n  log('Add thread', { forumid, content })\r\n\r\n  handleEdit({\r\n    $root,\r\n    forumEl: wikitext,\r\n    summary: `[WikiForum] Add thread to forum#${forumid}`,\r\n  })\r\n}\r\n\r\n/**\r\n * @function addReply 新回复，回复层主\r\n */\r\nfunction addReply({ forumEl, forumid = '1', threadid, content, $root }) {\r\n  const { wikitext } = forumEl\r\n  // 给楼主回复其实就是盖新楼\r\n  if (threadid === '1') {\r\n    return addThread({ forumEl, forumid, content })\r\n  }\r\n\r\n  forumid = Number(forumid)\r\n  forumid--\r\n\r\n  const forum = wikitext[forumid]\r\n\r\n  function findAndUpdate({ threadid, content }, base) {\r\n    var allThreads = base.threads\r\n    $.each(allThreads, (index, item) => {\r\n      if (item.threadid === threadid) {\r\n        item.threads = item.threads || []\r\n        item.threads.push({\r\n          meta: {\r\n            userAuthor: conf.wgUserName,\r\n            userLast: conf.wgUserName,\r\n            timePublish: timeStamp(),\r\n            timeModify: timeStamp(),\r\n          },\r\n          content,\r\n        })\r\n      } else if (item.threads) {\r\n        findAndUpdate({ threadid, content }, item)\r\n      }\r\n    })\r\n  }\r\n\r\n  findAndUpdate({ threadid, content }, forum)\r\n\r\n  log('Add reply', { forumid, threadid, content })\r\n\r\n  handleEdit({\r\n    $root,\r\n    forumEl: wikitext,\r\n    summary: `[WikiForum] Add reply to forum#${forumid} > thread#${threadid}`,\r\n  })\r\n}\r\n\r\nmodule.exports = {\r\n  addReply,\r\n  newReply: addReply,\r\n  addThread,\r\n  newThread: addThread,\r\n  updateThread,\r\n  // deleteThread,\r\n}\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","/**\r\n * @name WikiForum.core\r\n * @author 机智的小鱼君 <dragon-fish@qq.com>\r\n * @url https://github.com/Wjghj-Project/Gadget-WikiForum\r\n */\r\n'use strict'\r\n\r\nconst log = require('./module/log')\r\nconst { hook } = require('./module/mw')\r\n\r\nmw.loader.using(\r\n  ['mediawiki.api', 'mediawiki.util', 'mediawiki.user'],\r\n  function () {\r\n    // init global variable\r\n    const Core = {\r\n      parser: require('./module/parser'),\r\n      renderer: require('./module/renderer'),\r\n      updater: require('./module/updater'),\r\n    }\r\n\r\n    window.WikiForum = $.extend({}, window.WikiForum, Core)\r\n    hook('WikiForum').fire(Core)\r\n    log.log('Ready!')\r\n  }\r\n)\r\n"],"sourceRoot":""}